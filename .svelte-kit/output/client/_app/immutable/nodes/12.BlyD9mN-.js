import{S as nt,i as ot,s as lt,d as h,p as V,r as rt,t as Q,h as W,q as j,v as X,a as L,w as c,x as Y,b as f,y as Z,z as k,c as p,l as N,g as U,A as z,B as $,C as O,e as _,D as H,E as it,F as ut,G as tt}from"../chunks/CFjQe0dZ.js";import"../chunks/IHki7fMi.js";import{w as ct,i as ft,a as et,g as dt}from"../chunks/ClpmLFKC.js";import{D as mt}from"../chunks/30YN5PXq.js";import{d as st}from"../chunks/DCInEoFh.js";import{M as pt}from"../chunks/Cm9Mr3-3.js";function _t(r){let a,l=r[1].message+"",t;return{c(){a=_("span"),t=H(l),this.h()},l(e){a=p(e,"SPAN",{class:!0});var o=N(a);t=z(o,l),o.forEach(h),this.h()},h(){f(a,"class","border-l-green-800 border-l-[6px] bg-green-200 w-1/2 p-2")},m(e,o){L(e,a,o),c(a,t)},p(e,o){o&2&&l!==(l=e[1].message+"")&&j(t,l)},d(e){e&&h(a)}}}function ht(r){let a,l=r[1].message+"",t;return{c(){a=_("span"),t=H(l),this.h()},l(e){a=p(e,"SPAN",{class:!0});var o=N(a);t=z(o,l),o.forEach(h),this.h()},h(){f(a,"class","border-l-red-800 border-l-[6px] bg-red-200 w-1/2 p-2")},m(e,o){L(e,a,o),c(a,t)},p(e,o){o&2&&l!==(l=e[1].message+"")&&j(t,l)},d(e){e&&h(a)}}}function bt(r){let a,l,t,e,o,P="Admin",v,b,S=r[0].documents.filter(r[9])[0].slug+"",g,T,C,F,m,s,d="Save",y,w,G="Delete",J,q,x,M,R,I,at={};a=new pt({props:at}),r[8](a);function K(n,i){if(n[1]&&n[1].code)return ht;if(n[1])return _t}let D=K(r),u=D&&D(r);return x=new mt({props:{form:r[4],documentList:r[0].documents}}),{c(){$(a.$$.fragment),l=O(),t=_("form"),e=_("h1"),o=_("span"),o.textContent=P,v=H(` > Edit
        `),b=_("span"),g=H(S),T=O(),C=_("hr"),F=O(),m=_("div"),s=_("button"),s.textContent=d,y=O(),w=_("button"),w.textContent=G,J=O(),u&&u.c(),q=O(),$(x.$$.fragment),this.h()},l(n){Z(a.$$.fragment,n),l=k(n),t=p(n,"FORM",{class:!0,action:!0,method:!0});var i=N(t);e=p(i,"H1",{class:!0});var E=N(e);o=p(E,"SPAN",{class:!0,"data-svelte-h":!0}),U(o)!=="svelte-qs95ec"&&(o.textContent=P),v=z(E,` > Edit
        `),b=p(E,"SPAN",{class:!0});var A=N(b);g=z(A,S),A.forEach(h),E.forEach(h),T=k(i),C=p(i,"HR",{class:!0}),F=k(i),m=p(i,"DIV",{class:!0});var B=N(m);s=p(B,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),U(s)!=="svelte-f5epia"&&(s.textContent=d),y=k(B),w=p(B,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),U(w)!=="svelte-9xjeub"&&(w.textContent=G),B.forEach(h),J=k(i),u&&u.l(i),q=k(i),Z(x.$$.fragment,i),i.forEach(h),this.h()},h(){f(o,"class","text-blue-900"),f(b,"class","span underline decoration-dotted"),f(e,"class","text-3xl font-extrabold"),f(C,"class","border-2 border-blue-500"),f(s,"class","self-start bg-green-700 font-bold text-white text-sm px-3 py-1"),f(s,"type","submit"),f(w,"class","self-start bg-red-700 font-bold text-white text-sm px-3 py-1"),f(w,"type","button"),f(m,"class","flex gap-2"),f(t,"class","flex min-h-full w-1/2 flex-col gap-3 pt-10"),f(t,"action","?/update"),f(t,"method","POST")},m(n,i){X(a,n,i),L(n,l,i),L(n,t,i),c(t,e),c(e,o),c(e,v),c(e,b),c(b,g),c(t,T),c(t,C),c(t,F),c(t,m),c(m,s),c(m,y),c(m,w),c(t,J),u&&u.m(t,null),c(t,q),X(x,t,null),r[10](t),M=!0,R||(I=[Y(w,"click",r[7]),Y(t,"submit",r[6])],R=!0)},p(n,[i]){const E={};a.$set(E),(!M||i&17)&&S!==(S=n[0].documents.filter(n[9])[0].slug+"")&&j(g,S),D===(D=K(n))&&u?u.p(n,i):(u&&u.d(1),u=D&&D(n),u&&(u.c(),u.m(t,q)));const A={};i&16&&(A.form=n[4]),i&1&&(A.documentList=n[0].documents),x.$set(A)},i(n){M||(W(a.$$.fragment,n),W(x.$$.fragment,n),M=!0)},o(n){Q(a.$$.fragment,n),Q(x.$$.fragment,n),M=!1},d(n){n&&(h(l),h(t)),r[8](null),V(a,n),u&&u.d(),V(x),r[10](null),R=!1,rt(I)}}}function gt(r,a,l){let t,{data:e}=a,{form:o}=a;const P=ct({type:"document",form:{title:e.document.title,text:e.document.text,id:e.document.id,parent:e.document.parent}});it(r,P,s=>l(4,t=s));let v;const b=async()=>{var y;const s=await fetch(v.action,{method:"POST",body:JSON.stringify(t)}),d=st(await s.text());console.log(d),d.type=="success"&&((y=d.data)==null?void 0:y.status)=="success"&&await ft(),et(d)};ut(()=>{window.addEventListener("keydown",async s=>{s.ctrlKey&&s.key=="s"&&(s.preventDefault(),await b())})});let S=async s=>{s.preventDefault(),await b()},g,T=async()=>{g.raise(`Are you sure you want to delete '${e.document.slug}'?`,async()=>{var y;const s=await fetch("?/delete",{method:"POST",body:JSON.stringify({idOrSlug:e.document.slug})}),d=st(await s.text());console.log(d),d.type=="success"&&((y=d.data)==null?void 0:y.status)=="success"&&(window.alert("Deleted "+e.document.slug+"."),dt("/auth/admin/",{invalidateAll:!0})),et(d)},()=>{})};function C(s){tt[s?"unshift":"push"](()=>{g=s,l(3,g)})}const F=s=>s.id==t.form.id;function m(s){tt[s?"unshift":"push"](()=>{v=s,l(2,v)})}return r.$$set=s=>{"data"in s&&l(0,e=s.data),"form"in s&&l(1,o=s.form)},[e,o,v,g,t,P,S,T,C,F,m]}class Dt extends nt{constructor(a){super(),ot(this,a,gt,bt,lt,{data:0,form:1})}}export{Dt as component};
