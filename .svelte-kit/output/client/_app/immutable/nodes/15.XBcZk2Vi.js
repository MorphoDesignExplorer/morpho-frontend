import{S as F,i as I,s as O,n as j,d as w,a as M,w as u,x as V,b as d,c as _,l as A,z as L,g as q,e as y,C as N,q as R,A as z,D as C,G as X}from"../chunks/CFjQe0dZ.js";import"../chunks/IHki7fMi.js";import{i as B,g as G,a as J}from"../chunks/ClpmLFKC.js";import{d as Z}from"../chunks/DCInEoFh.js";function K(n,e){return new Promise(async(s,r)=>{const t=await fetch(`/auth/admin/project/new/presign/?mime=${n.type}`);t.ok||r(new Error("Unauthorized. Try logging out and logging back in."));const a=await t.json(),l=new XMLHttpRequest;l.upload.addEventListener("progress",e,!1),l.upload.addEventListener("load",()=>s(a.filename),!1),l.upload.addEventListener("error",h=>{r(h)},!1),l.open("PUT",a.url,!0),l.setRequestHeader("Content-Type",n.type);const v=new FileReader;v.onload=h=>{var m;l.send((m=h.target)==null?void 0:m.result)},v.readAsArrayBuffer(n)})}function Q(n){let e,s=n[0].message+"",r;return{c(){e=y("span"),r=C(s),this.h()},l(t){e=_(t,"SPAN",{class:!0});var a=A(e);r=z(a,s),a.forEach(w),this.h()},h(){d(e,"class","border-l-green-800 border-l-[6px] bg-green-300 w-1/2 p-2")},m(t,a){M(t,e,a),u(e,r)},p(t,a){a&1&&s!==(s=t[0].message+"")&&R(r,s)},d(t){t&&w(e)}}}function W(n){let e,s=n[0].message+"",r;return{c(){e=y("span"),r=C(s),this.h()},l(t){e=_(t,"SPAN",{class:!0});var a=A(e);r=z(a,s),a.forEach(w),this.h()},h(){d(e,"class","border-l-red-800 border-l-[6px] bg-red-300 w-1/2 p-2")},m(t,a){M(t,e,a),u(e,r)},p(t,a){a&1&&s!==(s=t[0].message+"")&&R(r,s)},d(t){t&&w(e)}}}function D(n){let e,s,r;return{c(){e=y("span"),s=C(n[2]),r=C("% uploaded.")},l(t){e=_(t,"SPAN",{});var a=A(e);s=z(a,n[2]),r=z(a,"% uploaded."),a.forEach(w)},m(t,a){M(t,e,a),u(e,s),u(e,r)},p(t,a){a&4&&R(s,t[2])},d(t){t&&w(e)}}}function Y(n){let e,s,r,t='<span class="text-blue-900">Admin</span> &gt; Create Project',a,l,v,h,m='<span class="text-sm">Zip Archive</span> <span class="text-gray-500 font-normal">Upload a compressed zip folder of the project here.</span>',T,x,i,S,g,b,k;function H(o,c){if(o[0]&&o[0].code)return W;if(o[0])return Q}let E=H(n),f=E&&E(n),p=n[2]>0&&D(n);return{c(){e=y("form"),f&&f.c(),s=N(),r=y("h1"),r.innerHTML=t,a=N(),l=y("div"),p&&p.c(),v=N(),h=y("span"),h.innerHTML=m,T=N(),x=y("div"),i=y("input"),S=N(),g=y("input"),this.h()},l(o){e=_(o,"FORM",{class:!0,action:!0,method:!0,enctype:!0});var c=A(e);f&&f.l(c),s=L(c),r=_(c,"H1",{class:!0,"data-svelte-h":!0}),q(r)!=="svelte-ptqgyp"&&(r.innerHTML=t),a=L(c),l=_(c,"DIV",{class:!0});var P=A(l);p&&p.l(P),v=L(P),h=_(P,"SPAN",{class:!0,"data-svelte-h":!0}),q(h)!=="svelte-3xfsfc"&&(h.innerHTML=m),T=L(P),x=_(P,"DIV",{class:!0});var U=A(x);i=_(U,"INPUT",{type:!0,name:!0,id:!0}),U.forEach(w),P.forEach(w),S=L(c),g=_(c,"INPUT",{type:!0,class:!0}),c.forEach(w),this.h()},h(){d(r,"class","text-3xl font-extrabold"),d(h,"class","w-1/4 self-start p-1 font-bold text-black flex flex-col text-xs"),d(i,"type","file"),d(i,"name","upload"),d(i,"id","zipfile"),i.disabled=n[1],d(x,"class","flex w-full"),d(l,"class","flex items-center gap-2 border-l-4 border-gray-500 bg-gray-100 p-2 text-sm mr-[-40%] mb-20"),d(g,"type","submit"),g.value="Submit",d(g,"class","self-start bg-green-700 font-bold text-white text-sm px-3 py-1"),g.disabled=n[1],d(e,"class","flex min-h-full w-1/2 flex-col gap-3 pt-10 items-start"),d(e,"action","?/create"),d(e,"method","POST"),d(e,"enctype","multipart/form-data")},m(o,c){M(o,e,c),f&&f.m(e,null),u(e,s),u(e,r),u(e,a),u(e,l),p&&p.m(l,null),u(l,v),u(l,h),u(l,T),u(l,x),u(x,i),n[5](i),u(e,S),u(e,g),b||(k=V(e,"submit",n[4]),b=!0)},p(o,[c]){E===(E=H(o))&&f?f.p(o,c):(f&&f.d(1),f=E&&E(o),f&&(f.c(),f.m(e,s))),o[2]>0?p?p.p(o,c):(p=D(o),p.c(),p.m(l,v)):p&&(p.d(1),p=null),c&2&&(i.disabled=o[1]),c&2&&(g.disabled=o[1])},i:j,o:j,d(o){o&&w(e),f&&f.d(),p&&p.d(),n[5](null),b=!1,k()}}}function $(n,e,s){let{form:r}=e,t=!1,a=0,l;async function v(m){var T,x;if(m.preventDefault(),!t){s(1,t=!0),s(0,r=null);try{const i=(T=l.files)==null?void 0:T.item(0);if(i==null)throw new Error("No file was chosen.");const S=await K(i,b=>{if(b.lengthComputable){const k=Math.round(b.loaded*100/b.total);s(2,a=k)}}),g=await fetch(m.target.action,{method:"POST",body:JSON.stringify({s3uri:S})});if(g.ok){const b=await g.text();console.log(b);const k=Z(b);k.type=="success"&&(x=k.data)!=null&&x.project_name&&setTimeout(async()=>{var H;await B(),await G(`/auth/admin/project/${(H=k.data)==null?void 0:H.project_name}`)},1e3),J(k),s(1,t=!1)}}catch(i){i instanceof Error?s(0,r={code:"400",message:i.message}):(console.error(i),s(0,r={code:"400",message:"unknown error"}))}}}function h(m){X[m?"unshift":"push"](()=>{l=m,s(3,l)})}return n.$$set=m=>{"form"in m&&s(0,r=m.form)},[r,t,a,l,v,h]}class re extends F{constructor(e){super(),I(this,e,$,Y,O,{form:0})}}export{re as component};
