var Al=Object.defineProperty;var Ml=(t,e,n)=>e in t?Al(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Su=(t,e,n)=>Ml(t,typeof e!="symbol"?e+"":e,n);import{S as Tl,i as Ol,s as Fl,n as Gn,d as At,a as Zn,b as Au,c as Mu,l as Tu,z as Nl,e as Ou,C as vl,F as Il,G as Fu}from"./CFjQe0dZ.js";import"./IHki7fMi.js";function V(t){this.content=t}V.prototype={constructor:V,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,n){var r=n&&n!=t?this.remove(n):this,u=r.find(t),i=r.content.slice();return u==-1?i.push(n||t,e):(i[u+1]=e,n&&(i[u]=n)),new V(i)},remove:function(t){var e=this.find(t);if(e==-1)return this;var n=this.content.slice();return n.splice(e,2),new V(n)},addToStart:function(t,e){return new V([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new V(n)},addBefore:function(t,e,n){var r=this.remove(e),u=r.content.slice(),i=r.find(t);return u.splice(i==-1?u.length:i,0,e,n),new V(u)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=V.from(t),t.size?new V(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=V.from(t),t.size?new V(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=V.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},toObject:function(){var t={};return this.forEach(function(e,n){t[e]=n}),t},get size(){return this.content.length>>1}};V.from=function(t){if(t instanceof V)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new V(e)};function so(t,e,n){for(let r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;let u=t.child(r),i=e.child(r);if(u==i){n+=u.nodeSize;continue}if(!u.sameMarkup(i))return n;if(u.isText&&u.text!=i.text){for(let o=0;u.text[o]==i.text[o];o++)n++;return n}if(u.content.size||i.content.size){let o=so(u.content,i.content,n+1);if(o!=null)return o}n+=u.nodeSize}}function lo(t,e,n,r){for(let u=t.childCount,i=e.childCount;;){if(u==0||i==0)return u==i?null:{a:n,b:r};let o=t.child(--u),s=e.child(--i),l=o.nodeSize;if(o==s){n-=l,r-=l;continue}if(!o.sameMarkup(s))return{a:n,b:r};if(o.isText&&o.text!=s.text){let a=0,c=Math.min(o.text.length,s.text.length);for(;a<c&&o.text[o.text.length-a-1]==s.text[s.text.length-a-1];)a++,n--,r--;return{a:n,b:r}}if(o.content.size||s.content.size){let a=lo(o.content,s.content,n-1,r-1);if(a)return a}n-=l,r-=l}}class x{constructor(e,n){if(this.content=e,this.size=n||0,n==null)for(let r=0;r<e.length;r++)this.size+=e[r].nodeSize}nodesBetween(e,n,r,u=0,i){for(let o=0,s=0;s<n;o++){let l=this.content[o],a=s+l.nodeSize;if(a>e&&r(l,u+s,i||null,o)!==!1&&l.content.size){let c=s+1;l.nodesBetween(Math.max(0,e-c),Math.min(l.content.size,n-c),r,u+c)}s=a}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,n,r,u){let i="",o=!0;return this.nodesBetween(e,n,(s,l)=>{let a=s.isText?s.text.slice(Math.max(e,l)-l,n-l):s.isLeaf?u?typeof u=="function"?u(s):u:s.type.spec.leafText?s.type.spec.leafText(s):"":"";s.isBlock&&(s.isLeaf&&a||s.isTextblock)&&r&&(o?o=!1:i+=r),i+=a},0),i}append(e){if(!e.size)return this;if(!this.size)return e;let n=this.lastChild,r=e.firstChild,u=this.content.slice(),i=0;for(n.isText&&n.sameMarkup(r)&&(u[u.length-1]=n.withText(n.text+r.text),i=1);i<e.content.length;i++)u.push(e.content[i]);return new x(u,this.size+e.size)}cut(e,n=this.size){if(e==0&&n==this.size)return this;let r=[],u=0;if(n>e)for(let i=0,o=0;o<n;i++){let s=this.content[i],l=o+s.nodeSize;l>e&&((o<e||l>n)&&(s.isText?s=s.cut(Math.max(0,e-o),Math.min(s.text.length,n-o)):s=s.cut(Math.max(0,e-o-1),Math.min(s.content.size,n-o-1))),r.push(s),u+=s.nodeSize),o=l}return new x(r,u)}cutByIndex(e,n){return e==n?x.empty:e==0&&n==this.content.length?this:new x(this.content.slice(e,n))}replaceChild(e,n){let r=this.content[e];if(r==n)return this;let u=this.content.slice(),i=this.size+n.nodeSize-r.nodeSize;return u[e]=n,new x(u,i)}addToStart(e){return new x([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new x(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let n=0;n<this.content.length;n++)if(!this.content[n].eq(e.content[n]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let n=this.content[e];if(!n)throw new RangeError("Index "+e+" out of range for "+this);return n}maybeChild(e){return this.content[e]||null}forEach(e){for(let n=0,r=0;n<this.content.length;n++){let u=this.content[n];e(u,r,n),r+=u.nodeSize}}findDiffStart(e,n=0){return so(this,e,n)}findDiffEnd(e,n=this.size,r=e.size){return lo(this,e,n,r)}findIndex(e,n=-1){if(e==0)return ln(0,e);if(e==this.size)return ln(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let r=0,u=0;;r++){let i=this.child(r),o=u+i.nodeSize;if(o>=e)return o==e||n>0?ln(r+1,o):ln(r,u);u=o}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,n){if(!n)return x.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new x(n.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return x.empty;let n,r=0;for(let u=0;u<e.length;u++){let i=e[u];r+=i.nodeSize,u&&i.isText&&e[u-1].sameMarkup(i)?(n||(n=e.slice(0,u)),n[n.length-1]=i.withText(n[n.length-1].text+i.text)):n&&n.push(i)}return new x(n||e,r)}static from(e){if(!e)return x.empty;if(e instanceof x)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new x([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}x.empty=new x([],0);const Qn={index:0,offset:0};function ln(t,e){return Qn.index=t,Qn.offset=e,Qn}function Cn(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!Cn(t[r],e[r]))return!1}else{for(let r in t)if(!(r in e)||!Cn(t[r],e[r]))return!1;for(let r in e)if(!(r in t))return!1}return!0}class M{constructor(e,n){this.type=e,this.attrs=n}addToSet(e){let n,r=!1;for(let u=0;u<e.length;u++){let i=e[u];if(this.eq(i))return e;if(this.type.excludes(i.type))n||(n=e.slice(0,u));else{if(i.type.excludes(this.type))return e;!r&&i.type.rank>this.type.rank&&(n||(n=e.slice(0,u)),n.push(this),r=!0),n&&n.push(i)}}return n||(n=e.slice()),r||n.push(this),n}removeFromSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return e.slice(0,n).concat(e.slice(n+1));return e}isInSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Cn(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[n.type];if(!r)throw new RangeError(`There is no mark type ${n.type} in this schema`);let u=r.create(n.attrs);return r.checkAttrs(u.attrs),u}static sameSet(e,n){if(e==n)return!0;if(e.length!=n.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(n[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return M.none;if(e instanceof M)return[e];let n=e.slice();return n.sort((r,u)=>r.type.rank-u.type.rank),n}}M.none=[];class Dn extends Error{}class k{constructor(e,n,r){this.content=e,this.openStart=n,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,n){let r=co(this.content,e+this.openStart,n);return r&&new k(r,this.openStart,this.openEnd)}removeBetween(e,n){return new k(ao(this.content,e+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,n){if(!n)return k.empty;let r=n.openStart||0,u=n.openEnd||0;if(typeof r!="number"||typeof u!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new k(x.fromJSON(e,n.content),r,u)}static maxOpen(e,n=!0){let r=0,u=0;for(let i=e.firstChild;i&&!i.isLeaf&&(n||!i.type.spec.isolating);i=i.firstChild)r++;for(let i=e.lastChild;i&&!i.isLeaf&&(n||!i.type.spec.isolating);i=i.lastChild)u++;return new k(e,r,u)}}k.empty=new k(x.empty,0,0);function ao(t,e,n){let{index:r,offset:u}=t.findIndex(e),i=t.maybeChild(r),{index:o,offset:s}=t.findIndex(n);if(u==e||i.isText){if(s!=n&&!t.child(o).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(r!=o)throw new RangeError("Removing non-flat range");return t.replaceChild(r,i.copy(ao(i.content,e-u-1,n-u-1)))}function co(t,e,n,r){let{index:u,offset:i}=t.findIndex(e),o=t.maybeChild(u);if(i==e||o.isText)return t.cut(0,e).append(n).append(t.cut(e));let s=co(o.content,e-i-1,n);return s&&t.replaceChild(u,o.copy(s))}function Rl(t,e,n){if(n.openStart>t.depth)throw new Dn("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new Dn("Inconsistent open depths");return fo(t,e,n,0)}function fo(t,e,n,r){let u=t.index(r),i=t.node(r);if(u==e.index(r)&&r<t.depth-n.openStart){let o=fo(t,e,n,r+1);return i.copy(i.content.replaceChild(u,o))}else if(n.content.size)if(!n.openStart&&!n.openEnd&&t.depth==r&&e.depth==r){let o=t.parent,s=o.content;return Ge(o,s.cut(0,t.parentOffset).append(n.content).append(s.cut(e.parentOffset)))}else{let{start:o,end:s}=Bl(n,t);return Ge(i,po(t,o,s,e,r))}else return Ge(i,wn(t,e,r))}function ho(t,e){if(!e.type.compatibleContent(t.type))throw new Dn("Cannot join "+e.type.name+" onto "+t.type.name)}function Sr(t,e,n){let r=t.node(n);return ho(r,e.node(n)),r}function Ke(t,e){let n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function vt(t,e,n,r){let u=(e||t).node(n),i=0,o=e?e.index(n):u.childCount;t&&(i=t.index(n),t.depth>n?i++:t.textOffset&&(Ke(t.nodeAfter,r),i++));for(let s=i;s<o;s++)Ke(u.child(s),r);e&&e.depth==n&&e.textOffset&&Ke(e.nodeBefore,r)}function Ge(t,e){return t.type.checkContent(e),t.copy(e)}function po(t,e,n,r,u){let i=t.depth>u&&Sr(t,e,u+1),o=r.depth>u&&Sr(n,r,u+1),s=[];return vt(null,t,u,s),i&&o&&e.index(u)==n.index(u)?(ho(i,o),Ke(Ge(i,po(t,e,n,r,u+1)),s)):(i&&Ke(Ge(i,wn(t,e,u+1)),s),vt(e,n,u,s),o&&Ke(Ge(o,wn(n,r,u+1)),s)),vt(r,null,u,s),new x(s)}function wn(t,e,n){let r=[];if(vt(null,t,n,r),t.depth>n){let u=Sr(t,e,n+1);Ke(Ge(u,wn(t,e,n+1)),r)}return vt(e,null,n,r),new x(r)}function Bl(t,e){let n=e.depth-t.openStart,u=e.node(n).copy(t.content);for(let i=n-1;i>=0;i--)u=e.node(i).copy(x.from(u));return{start:u.resolveNoCache(t.openStart+n),end:u.resolveNoCache(u.content.size-t.openEnd-n)}}class qt{constructor(e,n,r){this.pos=e,this.path=n,this.parentOffset=r,this.depth=n.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,n=this.index(this.depth);if(n==e.childCount)return null;let r=this.pos-this.path[this.path.length-1],u=e.child(n);return r?e.child(n).cut(r):u}get nodeBefore(){let e=this.index(this.depth),n=this.pos-this.path[this.path.length-1];return n?this.parent.child(e).cut(0,n):e==0?null:this.parent.child(e-1)}posAtIndex(e,n){n=this.resolveDepth(n);let r=this.path[n*3],u=n==0?0:this.path[n*3-1]+1;for(let i=0;i<e;i++)u+=r.child(i).nodeSize;return u}marks(){let e=this.parent,n=this.index();if(e.content.size==0)return M.none;if(this.textOffset)return e.child(n).marks;let r=e.maybeChild(n-1),u=e.maybeChild(n);if(!r){let s=r;r=u,u=s}let i=r.marks;for(var o=0;o<i.length;o++)i[o].type.spec.inclusive===!1&&(!u||!i[o].isInSet(u.marks))&&(i=i[o--].removeFromSet(i));return i}marksAcross(e){let n=this.parent.maybeChild(this.index());if(!n||!n.isInline)return null;let r=n.marks,u=e.parent.maybeChild(e.index());for(var i=0;i<r.length;i++)r[i].type.spec.inclusive===!1&&(!u||!r[i].isInSet(u.marks))&&(r=r[i--].removeFromSet(r));return r}sharedDepth(e){for(let n=this.depth;n>0;n--)if(this.start(n)<=e&&this.end(n)>=e)return n;return 0}blockRange(e=this,n){if(e.pos<this.pos)return e.blockRange(this);for(let r=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);r>=0;r--)if(e.pos<=this.end(r)&&(!n||n(this.node(r))))return new En(this,e,r);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let n=1;n<=this.depth;n++)e+=(e?"/":"")+this.node(n).type.name+"_"+this.index(n-1);return e+":"+this.parentOffset}static resolve(e,n){if(!(n>=0&&n<=e.content.size))throw new RangeError("Position "+n+" out of range");let r=[],u=0,i=n;for(let o=e;;){let{index:s,offset:l}=o.content.findIndex(i),a=i-l;if(r.push(o,s,u+l),!a||(o=o.child(s),o.isText))break;i=a-1,u+=l+1}return new qt(n,r,i)}static resolveCached(e,n){let r=Nu.get(e);if(r)for(let i=0;i<r.elts.length;i++){let o=r.elts[i];if(o.pos==n)return o}else Nu.set(e,r=new zl);let u=r.elts[r.i]=qt.resolve(e,n);return r.i=(r.i+1)%Pl,u}}class zl{constructor(){this.elts=[],this.i=0}}const Pl=12,Nu=new WeakMap;class En{constructor(e,n,r){this.$from=e,this.$to=n,this.depth=r}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const Ll=Object.create(null);let Ze=class Ar{constructor(e,n,r,u=M.none){this.type=e,this.attrs=n,this.marks=u,this.content=r||x.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,n,r,u=0){this.content.nodesBetween(e,n,r,u,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,n,r,u){return this.content.textBetween(e,n,r,u)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,n,r){return this.type==e&&Cn(this.attrs,n||e.defaultAttrs||Ll)&&M.sameSet(this.marks,r||M.none)}copy(e=null){return e==this.content?this:new Ar(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new Ar(this.type,this.attrs,this.content,e)}cut(e,n=this.content.size){return e==0&&n==this.content.size?this:this.copy(this.content.cut(e,n))}slice(e,n=this.content.size,r=!1){if(e==n)return k.empty;let u=this.resolve(e),i=this.resolve(n),o=r?0:u.sharedDepth(n),s=u.start(o),a=u.node(o).content.cut(u.pos-s,i.pos-s);return new k(a,u.depth-o,i.depth-o)}replace(e,n,r){return Rl(this.resolve(e),this.resolve(n),r)}nodeAt(e){for(let n=this;;){let{index:r,offset:u}=n.content.findIndex(e);if(n=n.maybeChild(r),!n)return null;if(u==e||n.isText)return n;e-=u+1}}childAfter(e){let{index:n,offset:r}=this.content.findIndex(e);return{node:this.content.maybeChild(n),index:n,offset:r}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:n,offset:r}=this.content.findIndex(e);if(r<e)return{node:this.content.child(n),index:n,offset:r};let u=this.content.child(n-1);return{node:u,index:n-1,offset:r-u.nodeSize}}resolve(e){return qt.resolveCached(this,e)}resolveNoCache(e){return qt.resolve(this,e)}rangeHasMark(e,n,r){let u=!1;return n>e&&this.nodesBetween(e,n,i=>(r.isInSet(i.marks)&&(u=!0),!u)),u}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),mo(this.marks,e)}contentMatchAt(e){let n=this.type.contentMatch.matchFragment(this.content,0,e);if(!n)throw new Error("Called contentMatchAt on a node with invalid content");return n}canReplace(e,n,r=x.empty,u=0,i=r.childCount){let o=this.contentMatchAt(e).matchFragment(r,u,i),s=o&&o.matchFragment(this.content,n);if(!s||!s.validEnd)return!1;for(let l=u;l<i;l++)if(!this.type.allowsMarks(r.child(l).marks))return!1;return!0}canReplaceWith(e,n,r,u){if(u&&!this.type.allowsMarks(u))return!1;let i=this.contentMatchAt(e).matchType(r),o=i&&i.matchFragment(this.content,n);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=M.none;for(let n=0;n<this.marks.length;n++){let r=this.marks[n];r.type.checkAttrs(r.attrs),e=r.addToSet(e)}if(!M.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(n=>n.type.name)}`);this.content.forEach(n=>n.check())}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(n=>n.toJSON())),e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Node.fromJSON");let r;if(n.marks){if(!Array.isArray(n.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=n.marks.map(e.markFromJSON)}if(n.type=="text"){if(typeof n.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(n.text,r)}let u=x.fromJSON(e,n.content),i=e.nodeType(n.type).create(n.attrs,u,r);return i.type.checkAttrs(i.attrs),i}};Ze.prototype.text=void 0;class _n extends Ze{constructor(e,n,r,u){if(super(e,n,null,u),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):mo(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,n){return this.text.slice(e,n)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new _n(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new _n(this.type,this.attrs,e,this.marks)}cut(e=0,n=this.text.length){return e==0&&n==this.text.length?this:this.withText(this.text.slice(e,n))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function mo(t,e){for(let n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}class et{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,n){let r=new ql(e,n);if(r.next==null)return et.empty;let u=go(r);r.next&&r.err("Unexpected trailing text");let i=Ul(jl(u));return Kl(i,r),i}matchType(e){for(let n=0;n<this.next.length;n++)if(this.next[n].type==e)return this.next[n].next;return null}matchFragment(e,n=0,r=e.childCount){let u=this;for(let i=n;u&&i<r;i++)u=u.matchType(e.child(i).type);return u}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:n}=this.next[e];if(!(n.isText||n.hasRequiredAttrs()))return n}return null}compatible(e){for(let n=0;n<this.next.length;n++)for(let r=0;r<e.next.length;r++)if(this.next[n].type==e.next[r].type)return!0;return!1}fillBefore(e,n=!1,r=0){let u=[this];function i(o,s){let l=o.matchFragment(e,r);if(l&&(!n||l.validEnd))return x.from(s.map(a=>a.createAndFill()));for(let a=0;a<o.next.length;a++){let{type:c,next:f}=o.next[a];if(!(c.isText||c.hasRequiredAttrs())&&u.indexOf(f)==-1){u.push(f);let d=i(f,s.concat(c));if(d)return d}}return null}return i(this,[])}findWrapping(e){for(let r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];let n=this.computeWrapping(e);return this.wrapCache.push(e,n),n}computeWrapping(e){let n=Object.create(null),r=[{match:this,type:null,via:null}];for(;r.length;){let u=r.shift(),i=u.match;if(i.matchType(e)){let o=[];for(let s=u;s.type;s=s.via)o.push(s.type);return o.reverse()}for(let o=0;o<i.next.length;o++){let{type:s,next:l}=i.next[o];!s.isLeaf&&!s.hasRequiredAttrs()&&!(s.name in n)&&(!u.type||l.validEnd)&&(r.push({match:s.contentMatch,type:s,via:u}),n[s.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function n(r){e.push(r);for(let u=0;u<r.next.length;u++)e.indexOf(r.next[u].next)==-1&&n(r.next[u].next)}return n(this),e.map((r,u)=>{let i=u+(r.validEnd?"*":" ")+" ";for(let o=0;o<r.next.length;o++)i+=(o?", ":"")+r.next[o].type.name+"->"+e.indexOf(r.next[o].next);return i}).join(`
`)}}et.empty=new et(!0);class ql{constructor(e,n){this.string=e,this.nodeTypes=n,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function go(t){let e=[];do e.push(Vl(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function Vl(t){let e=[];do e.push($l(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function $l(t){let e=Jl(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=Hl(t,e);else break;return e}function vu(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function Hl(t,e){let n=vu(t),r=n;return t.eat(",")&&(t.next!="}"?r=vu(t):r=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function Wl(t,e){let n=t.nodeTypes,r=n[e];if(r)return[r];let u=[];for(let i in n){let o=n[i];o.isInGroup(e)&&u.push(o)}return u.length==0&&t.err("No node type or group '"+e+"' found"),u}function Jl(t){if(t.eat("(")){let e=go(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let e=Wl(t,t.next).map(n=>(t.inline==null?t.inline=n.isInline:t.inline!=n.isInline&&t.err("Mixing inline and block content"),{type:"name",value:n}));return t.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function jl(t){let e=[[]];return u(i(t,0),n()),e;function n(){return e.push([])-1}function r(o,s,l){let a={term:l,to:s};return e[o].push(a),a}function u(o,s){o.forEach(l=>l.to=s)}function i(o,s){if(o.type=="choice")return o.exprs.reduce((l,a)=>l.concat(i(a,s)),[]);if(o.type=="seq")for(let l=0;;l++){let a=i(o.exprs[l],s);if(l==o.exprs.length-1)return a;u(a,s=n())}else if(o.type=="star"){let l=n();return r(s,l),u(i(o.expr,l),l),[r(l)]}else if(o.type=="plus"){let l=n();return u(i(o.expr,s),l),u(i(o.expr,l),l),[r(l)]}else{if(o.type=="opt")return[r(s)].concat(i(o.expr,s));if(o.type=="range"){let l=s;for(let a=0;a<o.min;a++){let c=n();u(i(o.expr,l),c),l=c}if(o.max==-1)u(i(o.expr,l),l);else for(let a=o.min;a<o.max;a++){let c=n();r(l,c),u(i(o.expr,l),c),l=c}return[r(l)]}else{if(o.type=="name")return[r(s,void 0,o.value)];throw new Error("Unknown expr type")}}}}function bo(t,e){return e-t}function Iu(t,e){let n=[];return r(e),n.sort(bo);function r(u){let i=t[u];if(i.length==1&&!i[0].term)return r(i[0].to);n.push(u);for(let o=0;o<i.length;o++){let{term:s,to:l}=i[o];!s&&n.indexOf(l)==-1&&r(l)}}}function Ul(t){let e=Object.create(null);return n(Iu(t,0));function n(r){let u=[];r.forEach(o=>{t[o].forEach(({term:s,to:l})=>{if(!s)return;let a;for(let c=0;c<u.length;c++)u[c][0]==s&&(a=u[c][1]);Iu(t,l).forEach(c=>{a||u.push([s,a=[]]),a.indexOf(c)==-1&&a.push(c)})})});let i=e[r.join(",")]=new et(r.indexOf(t.length-1)>-1);for(let o=0;o<u.length;o++){let s=u[o][1].sort(bo);i.next.push({type:u[o][0],next:e[s.join(",")]||n(s)})}return i}}function Kl(t,e){for(let n=0,r=[t];n<r.length;n++){let u=r[n],i=!u.validEnd,o=[];for(let s=0;s<u.next.length;s++){let{type:l,next:a}=u.next[s];o.push(l.name),i&&!(l.isText||l.hasRequiredAttrs())&&(i=!1),r.indexOf(a)==-1&&r.push(a)}i&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function xo(t){let e=Object.create(null);for(let n in t){let r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function yo(t,e){let n=Object.create(null);for(let r in t){let u=e&&e[r];if(u===void 0){let i=t[r];if(i.hasDefault)u=i.default;else throw new RangeError("No value supplied for attribute "+r)}n[r]=u}return n}function ko(t,e,n,r){for(let u in e)if(!(u in t))throw new RangeError(`Unsupported attribute ${u} for ${n} of type ${u}`);for(let u in t){let i=t[u];i.validate&&i.validate(e[u])}}function Co(t,e){let n=Object.create(null);if(e)for(let r in e)n[r]=new Zl(t,r,e[r]);return n}let Ru=class Do{constructor(e,n,r){this.name=e,this.schema=n,this.spec=r,this.markSet=null,this.groups=r.group?r.group.split(" "):[],this.attrs=Co(e,r.attrs),this.defaultAttrs=xo(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(r.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==et.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:yo(this.attrs,e)}create(e=null,n,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Ze(this,this.computeAttrs(e),x.from(n),M.setFrom(r))}createChecked(e=null,n,r){return n=x.from(n),this.checkContent(n),new Ze(this,this.computeAttrs(e),n,M.setFrom(r))}createAndFill(e=null,n,r){if(e=this.computeAttrs(e),n=x.from(n),n.size){let o=this.contentMatch.fillBefore(n);if(!o)return null;n=o.append(n)}let u=this.contentMatch.matchFragment(n),i=u&&u.fillBefore(x.empty,!0);return i?new Ze(this,e,n.append(i),M.setFrom(r)):null}validContent(e){let n=this.contentMatch.matchFragment(e);if(!n||!n.validEnd)return!1;for(let r=0;r<e.childCount;r++)if(!this.allowsMarks(e.child(r).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){ko(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let n=0;n<e.length;n++)if(!this.allowsMarkType(e[n].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let n;for(let r=0;r<e.length;r++)this.allowsMarkType(e[r].type)?n&&n.push(e[r]):n||(n=e.slice(0,r));return n?n.length?n:M.none:e}static compile(e,n){let r=Object.create(null);e.forEach((i,o)=>r[i]=new Do(i,n,o));let u=n.spec.topNode||"doc";if(!r[u])throw new RangeError("Schema is missing its top node type ('"+u+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(let i in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}};function Gl(t,e,n){let r=n.split("|");return u=>{let i=u===null?"null":typeof u;if(r.indexOf(i)<0)throw new RangeError(`Expected value of type ${r} for attribute ${e} on type ${t}, got ${i}`)}}class Zl{constructor(e,n,r){this.hasDefault=Object.prototype.hasOwnProperty.call(r,"default"),this.default=r.default,this.validate=typeof r.validate=="string"?Gl(e,n,r.validate):r.validate}get isRequired(){return!this.hasDefault}}class Ln{constructor(e,n,r,u){this.name=e,this.rank=n,this.schema=r,this.spec=u,this.attrs=Co(e,u.attrs),this.excluded=null;let i=xo(this.attrs);this.instance=i?new M(this,i):null}create(e=null){return!e&&this.instance?this.instance:new M(this,yo(this.attrs,e))}static compile(e,n){let r=Object.create(null),u=0;return e.forEach((i,o)=>r[i]=new Ln(i,u++,n,o)),r}removeFromSet(e){for(var n=0;n<e.length;n++)e[n].type==this&&(e=e.slice(0,n).concat(e.slice(n+1)),n--);return e}isInSet(e){for(let n=0;n<e.length;n++)if(e[n].type==this)return e[n]}checkAttrs(e){ko(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class Ql{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let n=this.spec={};for(let u in e)n[u]=e[u];n.nodes=V.from(e.nodes),n.marks=V.from(e.marks||{}),this.nodes=Ru.compile(this.spec.nodes,this),this.marks=Ln.compile(this.spec.marks,this);let r=Object.create(null);for(let u in this.nodes){if(u in this.marks)throw new RangeError(u+" can not be both a node and a mark");let i=this.nodes[u],o=i.spec.content||"",s=i.spec.marks;if(i.contentMatch=r[o]||(r[o]=et.parse(o,this.nodes)),i.inlineContent=i.contentMatch.inlineContent,i.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!i.isInline||!i.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=i}i.markSet=s=="_"?null:s?Bu(this,s.split(" ")):s==""||!i.inlineContent?[]:null}for(let u in this.marks){let i=this.marks[u],o=i.spec.excludes;i.excluded=o==null?[i]:o==""?[]:Bu(this,o.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,n=null,r,u){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof Ru){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(n,r,u)}text(e,n){let r=this.nodes.text;return new _n(r,r.defaultAttrs,e,M.setFrom(n))}mark(e,n){return typeof e=="string"&&(e=this.marks[e]),e.create(n)}nodeFromJSON(e){return Ze.fromJSON(this,e)}markFromJSON(e){return M.fromJSON(this,e)}nodeType(e){let n=this.nodes[e];if(!n)throw new RangeError("Unknown node type: "+e);return n}}function Bu(t,e){let n=[];for(let r=0;r<e.length;r++){let u=e[r],i=t.marks[u],o=i;if(i)n.push(i);else for(let s in t.marks){let l=t.marks[s];(u=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(u)>-1)&&n.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}function Yl(t){return t.tag!=null}function Xl(t){return t.style!=null}class Vt{constructor(e,n){this.schema=e,this.rules=n,this.tags=[],this.styles=[];let r=this.matchedStyles=[];n.forEach(u=>{if(Yl(u))this.tags.push(u);else if(Xl(u)){let i=/[^=]*/.exec(u.style)[0];r.indexOf(i)<0&&r.push(i),this.styles.push(u)}}),this.normalizeLists=!this.tags.some(u=>{if(!/^(ul|ol)\b/.test(u.tag)||!u.node)return!1;let i=e.nodes[u.node];return i.contentMatch.matchType(i)})}parse(e,n={}){let r=new Pu(this,n,!1);return r.addAll(e,M.none,n.from,n.to),r.finish()}parseSlice(e,n={}){let r=new Pu(this,n,!0);return r.addAll(e,M.none,n.from,n.to),k.maxOpen(r.finish())}matchTag(e,n,r){for(let u=r?this.tags.indexOf(r)+1:0;u<this.tags.length;u++){let i=this.tags[u];if(na(e,i.tag)&&(i.namespace===void 0||e.namespaceURI==i.namespace)&&(!i.context||n.matchesContext(i.context))){if(i.getAttrs){let o=i.getAttrs(e);if(o===!1)continue;i.attrs=o||void 0}return i}}}matchStyle(e,n,r,u){for(let i=u?this.styles.indexOf(u)+1:0;i<this.styles.length;i++){let o=this.styles[i],s=o.style;if(!(s.indexOf(e)!=0||o.context&&!r.matchesContext(o.context)||s.length>e.length&&(s.charCodeAt(e.length)!=61||s.slice(e.length+1)!=n))){if(o.getAttrs){let l=o.getAttrs(n);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let n=[];function r(u){let i=u.priority==null?50:u.priority,o=0;for(;o<n.length;o++){let s=n[o];if((s.priority==null?50:s.priority)<i)break}n.splice(o,0,u)}for(let u in e.marks){let i=e.marks[u].spec.parseDOM;i&&i.forEach(o=>{r(o=Lu(o)),o.mark||o.ignore||o.clearMark||(o.mark=u)})}for(let u in e.nodes){let i=e.nodes[u].spec.parseDOM;i&&i.forEach(o=>{r(o=Lu(o)),o.node||o.ignore||o.mark||(o.node=u)})}return n}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new Vt(e,Vt.schemaRules(e)))}}const wo={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},ea={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Eo={ol:!0,ul:!0},$t=1,Mr=2,It=4;function zu(t,e,n){return e!=null?(e?$t:0)|(e==="full"?Mr:0):t&&t.whitespace=="pre"?$t|Mr:n&~It}class an{constructor(e,n,r,u,i,o){this.type=e,this.attrs=n,this.marks=r,this.solid=u,this.options=o,this.content=[],this.activeMarks=M.none,this.match=i||(o&It?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let n=this.type.contentMatch.fillBefore(x.from(e));if(n)this.match=this.type.contentMatch.matchFragment(n);else{let r=this.type.contentMatch,u;return(u=r.findWrapping(e.type))?(this.match=r,u):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&$t)){let r=this.content[this.content.length-1],u;if(r&&r.isText&&(u=/[ \t\r\n\u000c]+$/.exec(r.text))){let i=r;r.text.length==u[0].length?this.content.pop():this.content[this.content.length-1]=i.withText(i.text.slice(0,i.text.length-u[0].length))}}let n=x.from(this.content);return!e&&this.match&&(n=n.append(this.match.fillBefore(x.empty,!0))),this.type?this.type.create(this.attrs,n,this.marks):n}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!wo.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class Pu{constructor(e,n,r){this.parser=e,this.options=n,this.isOpen=r,this.open=0,this.localPreserveWS=!1;let u=n.topNode,i,o=zu(null,n.preserveWhitespace,0)|(r?It:0);u?i=new an(u.type,u.attrs,M.none,!0,n.topMatch||u.type.contentMatch,o):r?i=new an(null,null,M.none,!0,null,o):i=new an(e.schema.topNodeType,null,M.none,!0,null,o),this.nodes=[i],this.find=n.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,n){e.nodeType==3?this.addTextNode(e,n):e.nodeType==1&&this.addElement(e,n)}addTextNode(e,n){let r=e.nodeValue,u=this.top,i=u.options&Mr?"full":this.localPreserveWS||(u.options&$t)>0;if(i==="full"||u.inlineContext(e)||/[^ \t\r\n\u000c]/.test(r)){if(i)i!=="full"?r=r.replace(/\r?\n|\r/g," "):r=r.replace(/\r\n?/g,`
`);else if(r=r.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){let o=u.content[u.content.length-1],s=e.previousSibling;(!o||s&&s.nodeName=="BR"||o.isText&&/[ \t\r\n\u000c]$/.test(o.text))&&(r=r.slice(1))}r&&this.insertNode(this.parser.schema.text(r),n,!/\S/.test(r)),this.findInText(e)}else this.findInside(e)}addElement(e,n,r){let u=this.localPreserveWS,i=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),s;Eo.hasOwnProperty(o)&&this.parser.normalizeLists&&ta(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(s=this.parser.matchTag(e,this,r));e:if(l?l.ignore:ea.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,n);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let a,c=this.needsBlock;if(wo.hasOwnProperty(o))i.content.length&&i.content[0].isInline&&this.open&&(this.open--,i=this.top),a=!0,i.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,n);break e}let f=l&&l.skip?n:this.readStyles(e,n);f&&this.addAll(e,f),a&&this.sync(i),this.needsBlock=c}else{let a=this.readStyles(e,n);a&&this.addElementByRule(e,l,a,l.consuming===!1?s:void 0)}this.localPreserveWS=u}leafFallback(e,n){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),n)}ignoreFallback(e,n){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),n,!0)}readStyles(e,n){let r=e.style;if(r&&r.length)for(let u=0;u<this.parser.matchedStyles.length;u++){let i=this.parser.matchedStyles[u],o=r.getPropertyValue(i);if(o)for(let s=void 0;;){let l=this.parser.matchStyle(i,o,this,s);if(!l)break;if(l.ignore)return null;if(l.clearMark?n=n.filter(a=>!l.clearMark(a)):n=n.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)s=l;else break}}return n}addElementByRule(e,n,r,u){let i,o;if(n.node)if(o=this.parser.schema.nodes[n.node],o.isLeaf)this.insertNode(o.create(n.attrs),r,e.nodeName=="BR")||this.leafFallback(e,r);else{let l=this.enter(o,n.attrs||null,r,n.preserveWhitespace);l&&(i=!0,r=l)}else{let l=this.parser.schema.marks[n.mark];r=r.concat(l.create(n.attrs))}let s=this.top;if(o&&o.isLeaf)this.findInside(e);else if(u)this.addElement(e,r,u);else if(n.getContent)this.findInside(e),n.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,r,!1));else{let l=e;typeof n.contentElement=="string"?l=e.querySelector(n.contentElement):typeof n.contentElement=="function"?l=n.contentElement(e):n.contentElement&&(l=n.contentElement),this.findAround(e,l,!0),this.addAll(l,r),this.findAround(e,l,!1)}i&&this.sync(s)&&this.open--}addAll(e,n,r,u){let i=r||0;for(let o=r?e.childNodes[r]:e.firstChild,s=u==null?null:e.childNodes[u];o!=s;o=o.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(o,n);this.findAtPoint(e,i)}findPlace(e,n,r){let u,i;for(let o=this.open,s=0;o>=0;o--){let l=this.nodes[o],a=l.findWrapping(e);if(a&&(!u||u.length>a.length+s)&&(u=a,i=l,!a.length))break;if(l.solid){if(r)break;s+=2}}if(!u)return null;this.sync(i);for(let o=0;o<u.length;o++)n=this.enterInner(u[o],null,n,!1);return n}insertNode(e,n,r){if(e.isInline&&this.needsBlock&&!this.top.type){let i=this.textblockFromContext();i&&(n=this.enterInner(i,null,n))}let u=this.findPlace(e,n,r);if(u){this.closeExtra();let i=this.top;i.match&&(i.match=i.match.matchType(e.type));let o=M.none;for(let s of u.concat(e.marks))(i.type?i.type.allowsMarkType(s.type):qu(s.type,e.type))&&(o=s.addToSet(o));return i.content.push(e.mark(o)),!0}return!1}enter(e,n,r,u){let i=this.findPlace(e.create(n),r,!1);return i&&(i=this.enterInner(e,n,r,!0,u)),i}enterInner(e,n,r,u=!1,i){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let s=zu(e,i,o.options);o.options&It&&o.content.length==0&&(s|=It);let l=M.none;return r=r.filter(a=>(o.type?o.type.allowsMarkType(a.type):qu(a.type,e))?(l=a.addToSet(l),!1):!0),this.nodes.push(new an(e,n,l,u,null,s)),this.open++,r}closeExtra(e=!1){let n=this.nodes.length-1;if(n>this.open){for(;n>this.open;n--)this.nodes[n-1].content.push(this.nodes[n].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let n=this.open;n>=0;n--){if(this.nodes[n]==e)return this.open=n,!0;this.localPreserveWS&&(this.nodes[n].options|=$t)}return!1}get currentPos(){this.closeExtra();let e=0;for(let n=this.open;n>=0;n--){let r=this.nodes[n].content;for(let u=r.length-1;u>=0;u--)e+=r[u].nodeSize;n&&e++}return e}findAtPoint(e,n){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==n&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].pos==null&&e.nodeType==1&&e.contains(this.find[n].node)&&(this.find[n].pos=this.currentPos)}findAround(e,n,r){if(e!=n&&this.find)for(let u=0;u<this.find.length;u++)this.find[u].pos==null&&e.nodeType==1&&e.contains(this.find[u].node)&&n.compareDocumentPosition(this.find[u].node)&(r?2:4)&&(this.find[u].pos=this.currentPos)}findInText(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&(this.find[n].pos=this.currentPos-(e.nodeValue.length-this.find[n].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let n=e.split("/"),r=this.options.context,u=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),i=-(r?r.depth+1:0)+(u?0:1),o=(s,l)=>{for(;s>=0;s--){let a=n[s];if(a==""){if(s==n.length-1||s==0)continue;for(;l>=i;l--)if(o(s-1,l))return!0;return!1}else{let c=l>0||l==0&&u?this.nodes[l].type:r&&l>=i?r.node(l-i).type:null;if(!c||c.name!=a&&!c.isInGroup(a))return!1;l--}}return!0};return o(n.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let n=e.depth;n>=0;n--){let r=e.node(n).contentMatchAt(e.indexAfter(n)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let n in this.parser.schema.nodes){let r=this.parser.schema.nodes[n];if(r.isTextblock&&r.defaultAttrs)return r}}}function ta(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let r=e.nodeType==1?e.nodeName.toLowerCase():null;r&&Eo.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):r=="li"?n=e:r&&(n=null)}}function na(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function Lu(t){let e={};for(let n in t)e[n]=t[n];return e}function qu(t,e){let n=e.schema.nodes;for(let r in n){let u=n[r];if(!u.allowsMarkType(t))continue;let i=[],o=s=>{i.push(s);for(let l=0;l<s.edgeCount;l++){let{type:a,next:c}=s.edge(l);if(a==e||i.indexOf(c)<0&&o(c))return!0}};if(o(u.contentMatch))return!0}}class wt{constructor(e,n){this.nodes=e,this.marks=n}serializeFragment(e,n={},r){r||(r=Yn(n).createDocumentFragment());let u=r,i=[];return e.forEach(o=>{if(i.length||o.marks.length){let s=0,l=0;for(;s<i.length&&l<o.marks.length;){let a=o.marks[l];if(!this.marks[a.type.name]){l++;continue}if(!a.eq(i[s][0])||a.type.spec.spanning===!1)break;s++,l++}for(;s<i.length;)u=i.pop()[1];for(;l<o.marks.length;){let a=o.marks[l++],c=this.serializeMark(a,o.isInline,n);c&&(i.push([a,u]),u.appendChild(c.dom),u=c.contentDOM||c.dom)}}u.appendChild(this.serializeNodeInner(o,n))}),r}serializeNodeInner(e,n){let{dom:r,contentDOM:u}=bn(Yn(n),this.nodes[e.type.name](e),null,e.attrs);if(u){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,n,u)}return r}serializeNode(e,n={}){let r=this.serializeNodeInner(e,n);for(let u=e.marks.length-1;u>=0;u--){let i=this.serializeMark(e.marks[u],e.isInline,n);i&&((i.contentDOM||i.dom).appendChild(r),r=i.dom)}return r}serializeMark(e,n,r={}){let u=this.marks[e.type.name];return u&&bn(Yn(r),u(e,n),null,e.attrs)}static renderSpec(e,n,r=null,u){return bn(e,n,r,u)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new wt(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let n=Vu(e.nodes);return n.text||(n.text=r=>r.text),n}static marksFromSchema(e){return Vu(e.marks)}}function Vu(t){let e={};for(let n in t){let r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function Yn(t){return t.document||window.document}const $u=new WeakMap;function ra(t){let e=$u.get(t);return e===void 0&&$u.set(t,e=ua(t)),e}function ua(t){let e=null;function n(r){if(r&&typeof r=="object")if(Array.isArray(r))if(typeof r[0]=="string")e||(e=[]),e.push(r);else for(let u=0;u<r.length;u++)n(r[u]);else for(let u in r)n(r[u])}return n(t),e}function bn(t,e,n,r){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let u=e[0],i;if(typeof u!="string")throw new RangeError("Invalid array passed to renderSpec");if(r&&(i=ra(r))&&i.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o=u.indexOf(" ");o>0&&(n=u.slice(0,o),u=u.slice(o+1));let s,l=n?t.createElementNS(n,u):t.createElement(u),a=e[1],c=1;if(a&&typeof a=="object"&&a.nodeType==null&&!Array.isArray(a)){c=2;for(let f in a)if(a[f]!=null){let d=f.indexOf(" ");d>0?l.setAttributeNS(f.slice(0,d),f.slice(d+1),a[f]):l.setAttribute(f,a[f])}}for(let f=c;f<e.length;f++){let d=e[f];if(d===0){if(f<e.length-1||f>c)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:p,contentDOM:h}=bn(t,d,n,r);if(l.appendChild(p),h){if(s)throw new RangeError("Multiple content holes");s=h}}}return{dom:l,contentDOM:s}}const _o=65535,So=Math.pow(2,16);function ia(t,e){return t+e*So}function Hu(t){return t&_o}function oa(t){return(t-(t&_o))/So}const Ao=1,Mo=2,xn=4,To=8;class Tr{constructor(e,n,r){this.pos=e,this.delInfo=n,this.recover=r}get deleted(){return(this.delInfo&To)>0}get deletedBefore(){return(this.delInfo&(Ao|xn))>0}get deletedAfter(){return(this.delInfo&(Mo|xn))>0}get deletedAcross(){return(this.delInfo&xn)>0}}class ne{constructor(e,n=!1){if(this.ranges=e,this.inverted=n,!e.length&&ne.empty)return ne.empty}recover(e){let n=0,r=Hu(e);if(!this.inverted)for(let u=0;u<r;u++)n+=this.ranges[u*3+2]-this.ranges[u*3+1];return this.ranges[r*3]+n+oa(e)}mapResult(e,n=1){return this._map(e,n,!1)}map(e,n=1){return this._map(e,n,!0)}_map(e,n,r){let u=0,i=this.inverted?2:1,o=this.inverted?1:2;for(let s=0;s<this.ranges.length;s+=3){let l=this.ranges[s]-(this.inverted?u:0);if(l>e)break;let a=this.ranges[s+i],c=this.ranges[s+o],f=l+a;if(e<=f){let d=a?e==l?-1:e==f?1:n:n,p=l+u+(d<0?0:c);if(r)return p;let h=e==(n<0?l:f)?null:ia(s/3,e-l),m=e==l?Mo:e==f?Ao:xn;return(n<0?e!=l:e!=f)&&(m|=To),new Tr(p,m,h)}u+=c-a}return r?e+u:new Tr(e+u,0,null)}touches(e,n){let r=0,u=Hu(n),i=this.inverted?2:1,o=this.inverted?1:2;for(let s=0;s<this.ranges.length;s+=3){let l=this.ranges[s]-(this.inverted?r:0);if(l>e)break;let a=this.ranges[s+i],c=l+a;if(e<=c&&s==u*3)return!0;r+=this.ranges[s+o]-a}return!1}forEach(e){let n=this.inverted?2:1,r=this.inverted?1:2;for(let u=0,i=0;u<this.ranges.length;u+=3){let o=this.ranges[u],s=o-(this.inverted?i:0),l=o+(this.inverted?0:i),a=this.ranges[u+n],c=this.ranges[u+r];e(s,s+a,l,l+c),i+=c-a}}invert(){return new ne(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?ne.empty:new ne(e<0?[0,-e,0]:[0,0,e])}}ne.empty=new ne([]);class Ht{constructor(e,n,r=0,u=e?e.length:0){this.mirror=n,this.from=r,this.to=u,this._maps=e||[],this.ownData=!(e||n)}get maps(){return this._maps}slice(e=0,n=this.maps.length){return new Ht(this._maps,this.mirror,e,n)}appendMap(e,n){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),n!=null&&this.setMirror(this._maps.length-1,n)}appendMapping(e){for(let n=0,r=this._maps.length;n<e._maps.length;n++){let u=e.getMirror(n);this.appendMap(e._maps[n],u!=null&&u<n?r+u:void 0)}}getMirror(e){if(this.mirror){for(let n=0;n<this.mirror.length;n++)if(this.mirror[n]==e)return this.mirror[n+(n%2?-1:1)]}}setMirror(e,n){this.mirror||(this.mirror=[]),this.mirror.push(e,n)}appendMappingInverted(e){for(let n=e.maps.length-1,r=this._maps.length+e._maps.length;n>=0;n--){let u=e.getMirror(n);this.appendMap(e._maps[n].invert(),u!=null&&u>n?r-u-1:void 0)}}invert(){let e=new Ht;return e.appendMappingInverted(this),e}map(e,n=1){if(this.mirror)return this._map(e,n,!0);for(let r=this.from;r<this.to;r++)e=this._maps[r].map(e,n);return e}mapResult(e,n=1){return this._map(e,n,!1)}_map(e,n,r){let u=0;for(let i=this.from;i<this.to;i++){let o=this._maps[i],s=o.mapResult(e,n);if(s.recover!=null){let l=this.getMirror(i);if(l!=null&&l>i&&l<this.to){i=l,e=this._maps[l].recover(s.recover);continue}}u|=s.delInfo,e=s.pos}return r?e:new Tr(e,u,null)}}const Xn=Object.create(null);class K{getMap(){return ne.empty}merge(e){return null}static fromJSON(e,n){if(!n||!n.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=Xn[n.stepType];if(!r)throw new RangeError(`No step type ${n.stepType} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in Xn)throw new RangeError("Duplicate use of step JSON ID "+e);return Xn[e]=n,n.prototype.jsonID=e,n}}class R{constructor(e,n){this.doc=e,this.failed=n}static ok(e){return new R(e,null)}static fail(e){return new R(null,e)}static fromReplace(e,n,r,u){try{return R.ok(e.replace(n,r,u))}catch(i){if(i instanceof Dn)return R.fail(i.message);throw i}}}function Xr(t,e,n){let r=[];for(let u=0;u<t.childCount;u++){let i=t.child(u);i.content.size&&(i=i.copy(Xr(i.content,e,i))),i.isInline&&(i=e(i,n,u)),r.push(i)}return x.fromArray(r)}class Ie extends K{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=e.resolve(this.from),u=r.node(r.sharedDepth(this.to)),i=new k(Xr(n.content,(o,s)=>!o.isAtom||!s.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),u),n.openStart,n.openEnd);return R.fromReplace(e,this.from,this.to,i)}invert(){return new ge(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new Ie(n.pos,r.pos,this.mark)}merge(e){return e instanceof Ie&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Ie(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Ie(n.from,n.to,e.markFromJSON(n.mark))}}K.jsonID("addMark",Ie);class ge extends K{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=new k(Xr(n.content,u=>u.mark(this.mark.removeFromSet(u.marks)),e),n.openStart,n.openEnd);return R.fromReplace(e,this.from,this.to,r)}invert(){return new Ie(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new ge(n.pos,r.pos,this.mark)}merge(e){return e instanceof ge&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new ge(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new ge(n.from,n.to,e.markFromJSON(n.mark))}}K.jsonID("removeMark",ge);class Re extends K{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return R.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.addToSet(n.marks));return R.fromReplace(e,this.pos,this.pos+1,new k(x.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);if(n){let r=this.mark.addToSet(n.marks);if(r.length==n.marks.length){for(let u=0;u<n.marks.length;u++)if(!n.marks[u].isInSet(r))return new Re(this.pos,n.marks[u]);return new Re(this.pos,this.mark)}}return new tt(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Re(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Re(n.pos,e.markFromJSON(n.mark))}}K.jsonID("addNodeMark",Re);class tt extends K{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return R.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.removeFromSet(n.marks));return R.fromReplace(e,this.pos,this.pos+1,new k(x.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);return!n||!this.mark.isInSet(n.marks)?this:new Re(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new tt(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new tt(n.pos,e.markFromJSON(n.mark))}}K.jsonID("removeNodeMark",tt);class j extends K{constructor(e,n,r,u=!1){super(),this.from=e,this.to=n,this.slice=r,this.structure=u}apply(e){return this.structure&&Or(e,this.from,this.to)?R.fail("Structure replace would overwrite content"):R.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new ne([this.from,this.to-this.from,this.slice.size])}invert(e){return new j(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deletedAcross&&r.deletedAcross?null:new j(n.pos,Math.max(n.pos,r.pos),this.slice,this.structure)}merge(e){if(!(e instanceof j)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let n=this.slice.size+e.slice.size==0?k.empty:new k(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new j(this.from,this.to+(e.to-e.from),n,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let n=this.slice.size+e.slice.size==0?k.empty:new k(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new j(e.from,this.to,n,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new j(n.from,n.to,k.fromJSON(e,n.slice),!!n.structure)}}K.jsonID("replace",j);class W extends K{constructor(e,n,r,u,i,o,s=!1){super(),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=u,this.slice=i,this.insert=o,this.structure=s}apply(e){if(this.structure&&(Or(e,this.from,this.gapFrom)||Or(e,this.gapTo,this.to)))return R.fail("Structure gap-replace would overwrite content");let n=e.slice(this.gapFrom,this.gapTo);if(n.openStart||n.openEnd)return R.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,n.content);return r?R.fromReplace(e,this.from,this.to,r):R.fail("Content does not fit in gap")}getMap(){return new ne([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let n=this.gapTo-this.gapFrom;return new W(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),u=this.from==this.gapFrom?n.pos:e.map(this.gapFrom,-1),i=this.to==this.gapTo?r.pos:e.map(this.gapTo,1);return n.deletedAcross&&r.deletedAcross||u<n.pos||i>r.pos?null:new W(n.pos,r.pos,u,i,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new W(n.from,n.to,n.gapFrom,n.gapTo,k.fromJSON(e,n.slice),n.insert,!!n.structure)}}K.jsonID("replaceAround",W);function Or(t,e,n){let r=t.resolve(e),u=n-e,i=r.depth;for(;u>0&&i>0&&r.indexAfter(i)==r.node(i).childCount;)i--,u--;if(u>0){let o=r.node(i).maybeChild(r.indexAfter(i));for(;u>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,u--}}return!1}function sa(t,e,n,r){let u=[],i=[],o,s;t.doc.nodesBetween(e,n,(l,a,c)=>{if(!l.isInline)return;let f=l.marks;if(!r.isInSet(f)&&c.type.allowsMarkType(r.type)){let d=Math.max(a,e),p=Math.min(a+l.nodeSize,n),h=r.addToSet(f);for(let m=0;m<f.length;m++)f[m].isInSet(h)||(o&&o.to==d&&o.mark.eq(f[m])?o.to=p:u.push(o=new ge(d,p,f[m])));s&&s.to==d?s.to=p:i.push(s=new Ie(d,p,r))}}),u.forEach(l=>t.step(l)),i.forEach(l=>t.step(l))}function la(t,e,n,r){let u=[],i=0;t.doc.nodesBetween(e,n,(o,s)=>{if(!o.isInline)return;i++;let l=null;if(r instanceof Ln){let a=o.marks,c;for(;c=r.isInSet(a);)(l||(l=[])).push(c),a=c.removeFromSet(a)}else r?r.isInSet(o.marks)&&(l=[r]):l=o.marks;if(l&&l.length){let a=Math.min(s+o.nodeSize,n);for(let c=0;c<l.length;c++){let f=l[c],d;for(let p=0;p<u.length;p++){let h=u[p];h.step==i-1&&f.eq(u[p].style)&&(d=h)}d?(d.to=a,d.step=i):u.push({style:f,from:Math.max(s,e),to:a,step:i})}}}),u.forEach(o=>t.step(new ge(o.from,o.to,o.style)))}function eu(t,e,n,r=n.contentMatch,u=!0){let i=t.doc.nodeAt(e),o=[],s=e+1;for(let l=0;l<i.childCount;l++){let a=i.child(l),c=s+a.nodeSize,f=r.matchType(a.type);if(!f)o.push(new j(s,c,k.empty));else{r=f;for(let d=0;d<a.marks.length;d++)n.allowsMarkType(a.marks[d].type)||t.step(new ge(s,c,a.marks[d]));if(u&&a.isText&&n.whitespace!="pre"){let d,p=/\r?\n|\r/g,h;for(;d=p.exec(a.text);)h||(h=new k(x.from(n.schema.text(" ",n.allowedMarks(a.marks))),0,0)),o.push(new j(s+d.index,s+d.index+d[0].length,h))}}s=c}if(!r.validEnd){let l=r.fillBefore(x.empty,!0);t.replace(s,s,new k(l,0,0))}for(let l=o.length-1;l>=0;l--)t.step(o[l])}function aa(t,e,n){return(e==0||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function en(t){let n=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let r=t.depth;;--r){let u=t.$from.node(r),i=t.$from.index(r),o=t.$to.indexAfter(r);if(r<t.depth&&u.canReplace(i,o,n))return r;if(r==0||u.type.spec.isolating||!aa(u,i,o))break}return null}function ca(t,e,n){let{$from:r,$to:u,depth:i}=e,o=r.before(i+1),s=u.after(i+1),l=o,a=s,c=x.empty,f=0;for(let h=i,m=!1;h>n;h--)m||r.index(h)>0?(m=!0,c=x.from(r.node(h).copy(c)),f++):l--;let d=x.empty,p=0;for(let h=i,m=!1;h>n;h--)m||u.after(h+1)<u.end(h)?(m=!0,d=x.from(u.node(h).copy(d)),p++):a++;t.step(new W(l,a,o,s,new k(c.append(d),f,p),c.size-f,!0))}function tu(t,e,n=null,r=t){let u=fa(t,e),i=u&&da(r,e);return i?u.map(Wu).concat({type:e,attrs:n}).concat(i.map(Wu)):null}function Wu(t){return{type:t,attrs:null}}function fa(t,e){let{parent:n,startIndex:r,endIndex:u}=t,i=n.contentMatchAt(r).findWrapping(e);if(!i)return null;let o=i.length?i[0]:e;return n.canReplaceWith(r,u,o)?i:null}function da(t,e){let{parent:n,startIndex:r,endIndex:u}=t,i=n.child(r),o=e.contentMatch.findWrapping(i.type);if(!o)return null;let l=(o.length?o[o.length-1]:e).contentMatch;for(let a=r;l&&a<u;a++)l=l.matchType(n.child(a).type);return!l||!l.validEnd?null:o}function ha(t,e,n){let r=x.empty;for(let o=n.length-1;o>=0;o--){if(r.size){let s=n[o].type.contentMatch.matchFragment(r);if(!s||!s.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=x.from(n[o].type.create(n[o].attrs,r))}let u=e.start,i=e.end;t.step(new W(u,i,u,i,new k(r,0,0),n.length,!0))}function pa(t,e,n,r,u){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let i=t.steps.length;t.doc.nodesBetween(e,n,(o,s)=>{let l=typeof u=="function"?u(o):u;if(o.isTextblock&&!o.hasMarkup(r,l)&&ma(t.doc,t.mapping.slice(i).map(s),r)){let a=null;if(r.schema.linebreakReplacement){let p=r.whitespace=="pre",h=!!r.contentMatch.matchType(r.schema.linebreakReplacement);p&&!h?a=!1:!p&&h&&(a=!0)}a===!1&&Fo(t,o,s,i),eu(t,t.mapping.slice(i).map(s,1),r,void 0,a===null);let c=t.mapping.slice(i),f=c.map(s,1),d=c.map(s+o.nodeSize,1);return t.step(new W(f,d,f+1,d-1,new k(x.from(r.create(l,null,o.marks)),0,0),1,!0)),a===!0&&Oo(t,o,s,i),!1}})}function Oo(t,e,n,r){e.forEach((u,i)=>{if(u.isText){let o,s=/\r?\n|\r/g;for(;o=s.exec(u.text);){let l=t.mapping.slice(r).map(n+1+i+o.index);t.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function Fo(t,e,n,r){e.forEach((u,i)=>{if(u.type==u.type.schema.linebreakReplacement){let o=t.mapping.slice(r).map(n+1+i);t.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function ma(t,e,n){let r=t.resolve(e),u=r.index();return r.parent.canReplaceWith(u,u+1,n)}function ga(t,e,n,r,u){let i=t.doc.nodeAt(e);if(!i)throw new RangeError("No node at given position");n||(n=i.type);let o=n.create(r,null,u||i.marks);if(i.isLeaf)return t.replaceWith(e,e+i.nodeSize,o);if(!n.validContent(i.content))throw new RangeError("Invalid content for node type "+n.name);t.step(new W(e,e+i.nodeSize,e+1,e+i.nodeSize-1,new k(x.from(o),0,0),1,!0))}function dt(t,e,n=1,r){let u=t.resolve(e),i=u.depth-n,o=r&&r[r.length-1]||u.parent;if(i<0||u.parent.type.spec.isolating||!u.parent.canReplace(u.index(),u.parent.childCount)||!o.type.validContent(u.parent.content.cutByIndex(u.index(),u.parent.childCount)))return!1;for(let a=u.depth-1,c=n-2;a>i;a--,c--){let f=u.node(a),d=u.index(a);if(f.type.spec.isolating)return!1;let p=f.content.cutByIndex(d,f.childCount),h=r&&r[c+1];h&&(p=p.replaceChild(0,h.type.create(h.attrs)));let m=r&&r[c]||f;if(!f.canReplace(d+1,f.childCount)||!m.type.validContent(p))return!1}let s=u.indexAfter(i),l=r&&r[0];return u.node(i).canReplaceWith(s,s,l?l.type:u.node(i+1).type)}function ba(t,e,n=1,r){let u=t.doc.resolve(e),i=x.empty,o=x.empty;for(let s=u.depth,l=u.depth-n,a=n-1;s>l;s--,a--){i=x.from(u.node(s).copy(i));let c=r&&r[a];o=x.from(c?c.type.create(c.attrs,o):u.node(s).copy(o))}t.step(new j(e,e,new k(i.append(o),n,n),!0))}function Et(t,e){let n=t.resolve(e),r=n.index();return No(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function xa(t,e){e.content.size||t.type.compatibleContent(e.type);let n=t.contentMatchAt(t.childCount),{linebreakReplacement:r}=t.type.schema;for(let u=0;u<e.childCount;u++){let i=e.child(u),o=i.type==r?t.type.schema.nodes.text:i.type;if(n=n.matchType(o),!n||!t.type.allowsMarks(i.marks))return!1}return n.validEnd}function No(t,e){return!!(t&&e&&!t.isLeaf&&xa(t,e))}function vo(t,e,n=-1){let r=t.resolve(e);for(let u=r.depth;;u--){let i,o,s=r.index(u);if(u==r.depth?(i=r.nodeBefore,o=r.nodeAfter):n>0?(i=r.node(u+1),s++,o=r.node(u).maybeChild(s)):(i=r.node(u).maybeChild(s-1),o=r.node(u+1)),i&&!i.isTextblock&&No(i,o)&&r.node(u).canReplace(s,s+1))return e;if(u==0)break;e=n<0?r.before(u):r.after(u)}}function ya(t,e,n){let r=null,{linebreakReplacement:u}=t.doc.type.schema,i=t.doc.resolve(e-n),o=i.node().type;if(u&&o.inlineContent){let c=o.whitespace=="pre",f=!!o.contentMatch.matchType(u);c&&!f?r=!1:!c&&f&&(r=!0)}let s=t.steps.length;if(r===!1){let c=t.doc.resolve(e+n);Fo(t,c.node(),c.before(),s)}o.inlineContent&&eu(t,e+n-1,o,i.node().contentMatchAt(i.index()),r==null);let l=t.mapping.slice(s),a=l.map(e-n);if(t.step(new j(a,l.map(e+n,-1),k.empty,!0)),r===!0){let c=t.doc.resolve(a);Oo(t,c.node(),c.before(),t.steps.length)}return t}function ka(t,e,n){let r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(r.parentOffset==0)for(let u=r.depth-1;u>=0;u--){let i=r.index(u);if(r.node(u).canReplaceWith(i,i,n))return r.before(u+1);if(i>0)return null}if(r.parentOffset==r.parent.content.size)for(let u=r.depth-1;u>=0;u--){let i=r.indexAfter(u);if(r.node(u).canReplaceWith(i,i,n))return r.after(u+1);if(i<r.node(u).childCount)return null}return null}function Io(t,e,n){let r=t.resolve(e);if(!n.content.size)return e;let u=n.content;for(let i=0;i<n.openStart;i++)u=u.firstChild.content;for(let i=1;i<=(n.openStart==0&&n.size?2:1);i++)for(let o=r.depth;o>=0;o--){let s=o==r.depth?0:r.pos<=(r.start(o+1)+r.end(o+1))/2?-1:1,l=r.index(o)+(s>0?1:0),a=r.node(o),c=!1;if(i==1)c=a.canReplace(l,l,u);else{let f=a.contentMatchAt(l).findWrapping(u.firstChild.type);c=f&&a.canReplaceWith(l,l,f[0])}if(c)return s==0?r.pos:s<0?r.before(o+1):r.after(o+1)}return null}function nu(t,e,n=e,r=k.empty){if(e==n&&!r.size)return null;let u=t.resolve(e),i=t.resolve(n);return Ro(u,i,r)?new j(e,n,r):new Ca(u,i,r).fit()}function Ro(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}class Ca{constructor(e,n,r){this.$from=e,this.$to=n,this.unplaced=r,this.frontier=[],this.placed=x.empty;for(let u=0;u<=e.depth;u++){let i=e.node(u);this.frontier.push({type:i.type,match:i.contentMatchAt(e.indexAfter(u))})}for(let u=e.depth;u>0;u--)this.placed=x.from(e.node(u).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let a=this.findFittable();a?this.placeNodes(a):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,r=this.$from,u=this.close(e<0?this.$to:r.doc.resolve(e));if(!u)return null;let i=this.placed,o=r.depth,s=u.depth;for(;o&&s&&i.childCount==1;)i=i.firstChild.content,o--,s--;let l=new k(i,o,s);return e>-1?new W(r.pos,e,this.$to.pos,this.$to.end(),l,n):l.size||r.pos!=this.$to.pos?new j(r.pos,u.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let n=this.unplaced.content,r=0,u=this.unplaced.openEnd;r<e;r++){let i=n.firstChild;if(n.childCount>1&&(u=0),i.type.spec.isolating&&u<=r){e=r;break}n=i.content}for(let n=1;n<=2;n++)for(let r=n==1?e:this.unplaced.openStart;r>=0;r--){let u,i=null;r?(i=er(this.unplaced.content,r-1).firstChild,u=i.content):u=this.unplaced.content;let o=u.firstChild;for(let s=this.depth;s>=0;s--){let{type:l,match:a}=this.frontier[s],c,f=null;if(n==1&&(o?a.matchType(o.type)||(f=a.fillBefore(x.from(o),!1)):i&&l.compatibleContent(i.type)))return{sliceDepth:r,frontierDepth:s,parent:i,inject:f};if(n==2&&o&&(c=a.findWrapping(o.type)))return{sliceDepth:r,frontierDepth:s,parent:i,wrap:c};if(i&&a.matchType(i.type))break}}}openMore(){let{content:e,openStart:n,openEnd:r}=this.unplaced,u=er(e,n);return!u.childCount||u.firstChild.isLeaf?!1:(this.unplaced=new k(e,n+1,Math.max(r,u.size+n>=e.size-r?n+1:0)),!0)}dropNode(){let{content:e,openStart:n,openEnd:r}=this.unplaced,u=er(e,n);if(u.childCount<=1&&n>0){let i=e.size-n<=n+u.size;this.unplaced=new k(Ot(e,n-1,1),n-1,i?n-1:r)}else this.unplaced=new k(Ot(e,n,1),n,r)}placeNodes({sliceDepth:e,frontierDepth:n,parent:r,inject:u,wrap:i}){for(;this.depth>n;)this.closeFrontierNode();if(i)for(let m=0;m<i.length;m++)this.openFrontierNode(i[m]);let o=this.unplaced,s=r?r.content:o.content,l=o.openStart-e,a=0,c=[],{match:f,type:d}=this.frontier[n];if(u){for(let m=0;m<u.childCount;m++)c.push(u.child(m));f=f.matchFragment(u)}let p=s.size+e-(o.content.size-o.openEnd);for(;a<s.childCount;){let m=s.child(a),g=f.matchType(m.type);if(!g)break;a++,(a>1||l==0||m.content.size)&&(f=g,c.push(Bo(m.mark(d.allowedMarks(m.marks)),a==1?l:0,a==s.childCount?p:-1)))}let h=a==s.childCount;h||(p=-1),this.placed=Ft(this.placed,n,x.from(c)),this.frontier[n].match=f,h&&p<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let m=0,g=s;m<p;m++){let b=g.lastChild;this.frontier.push({type:b.type,match:b.contentMatchAt(b.childCount)}),g=b.content}this.unplaced=h?e==0?k.empty:new k(Ot(o.content,e-1,1),e-1,p<0?o.openEnd:e-1):new k(Ot(o.content,e,a),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],n;if(!e.type.isTextblock||!tr(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(n=this.findCloseLevel(this.$to))&&n.depth==this.depth)return-1;let{depth:r}=this.$to,u=this.$to.after(r);for(;r>1&&u==this.$to.end(--r);)++u;return u}findCloseLevel(e){e:for(let n=Math.min(this.depth,e.depth);n>=0;n--){let{match:r,type:u}=this.frontier[n],i=n<e.depth&&e.end(n+1)==e.pos+(e.depth-(n+1)),o=tr(e,n,u,r,i);if(o){for(let s=n-1;s>=0;s--){let{match:l,type:a}=this.frontier[s],c=tr(e,s,a,l,!0);if(!c||c.childCount)continue e}return{depth:n,fit:o,move:i?e.doc.resolve(e.after(n+1)):e}}}}close(e){let n=this.findCloseLevel(e);if(!n)return null;for(;this.depth>n.depth;)this.closeFrontierNode();n.fit.childCount&&(this.placed=Ft(this.placed,n.depth,n.fit)),e=n.move;for(let r=n.depth+1;r<=e.depth;r++){let u=e.node(r),i=u.type.contentMatch.fillBefore(u.content,!0,e.index(r));this.openFrontierNode(u.type,u.attrs,i)}return e}openFrontierNode(e,n=null,r){let u=this.frontier[this.depth];u.match=u.match.matchType(e),this.placed=Ft(this.placed,this.depth,x.from(e.create(n,r))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let n=this.frontier.pop().match.fillBefore(x.empty,!0);n.childCount&&(this.placed=Ft(this.placed,this.frontier.length,n))}}function Ot(t,e,n){return e==0?t.cutByIndex(n,t.childCount):t.replaceChild(0,t.firstChild.copy(Ot(t.firstChild.content,e-1,n)))}function Ft(t,e,n){return e==0?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(Ft(t.lastChild.content,e-1,n)))}function er(t,e){for(let n=0;n<e;n++)t=t.firstChild.content;return t}function Bo(t,e,n){if(e<=0)return t;let r=t.content;return e>1&&(r=r.replaceChild(0,Bo(r.firstChild,e-1,r.childCount==1?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore(x.empty,!0)))),t.copy(r)}function tr(t,e,n,r,u){let i=t.node(e),o=u?t.indexAfter(e):t.index(e);if(o==i.childCount&&!n.compatibleContent(i.type))return null;let s=r.fillBefore(i.content,!0,o);return s&&!Da(n,i.content,o)?s:null}function Da(t,e,n){for(let r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}function wa(t){return t.spec.defining||t.spec.definingForContent}function Ea(t,e,n,r){if(!r.size)return t.deleteRange(e,n);let u=t.doc.resolve(e),i=t.doc.resolve(n);if(Ro(u,i,r))return t.step(new j(e,n,r));let o=Po(u,t.doc.resolve(n));o[o.length-1]==0&&o.pop();let s=-(u.depth+1);o.unshift(s);for(let d=u.depth,p=u.pos-1;d>0;d--,p--){let h=u.node(d).type.spec;if(h.defining||h.definingAsContext||h.isolating)break;o.indexOf(d)>-1?s=d:u.before(d)==p&&o.splice(1,0,-d)}let l=o.indexOf(s),a=[],c=r.openStart;for(let d=r.content,p=0;;p++){let h=d.firstChild;if(a.push(h),p==r.openStart)break;d=h.content}for(let d=c-1;d>=0;d--){let p=a[d],h=wa(p.type);if(h&&!p.sameMarkup(u.node(Math.abs(s)-1)))c=d;else if(h||!p.type.isTextblock)break}for(let d=r.openStart;d>=0;d--){let p=(d+c+1)%(r.openStart+1),h=a[p];if(h)for(let m=0;m<o.length;m++){let g=o[(m+l)%o.length],b=!0;g<0&&(b=!1,g=-g);let y=u.node(g-1),C=u.index(g-1);if(y.canReplaceWith(C,C,h.type,h.marks))return t.replace(u.before(g),b?i.after(g):n,new k(zo(r.content,0,r.openStart,p),p,r.openEnd))}}let f=t.steps.length;for(let d=o.length-1;d>=0&&(t.replace(e,n,r),!(t.steps.length>f));d--){let p=o[d];p<0||(e=u.before(p),n=i.after(p))}}function zo(t,e,n,r,u){if(e<n){let i=t.firstChild;t=t.replaceChild(0,i.copy(zo(i.content,e+1,n,r,i)))}if(e>r){let i=u.contentMatchAt(0),o=i.fillBefore(t).append(t);t=o.append(i.matchFragment(o).fillBefore(x.empty,!0))}return t}function _a(t,e,n,r){if(!r.isInline&&e==n&&t.doc.resolve(e).parent.content.size){let u=ka(t.doc,e,r.type);u!=null&&(e=n=u)}t.replaceRange(e,n,new k(x.from(r),0,0))}function Sa(t,e,n){let r=t.doc.resolve(e),u=t.doc.resolve(n),i=Po(r,u);for(let o=0;o<i.length;o++){let s=i[o],l=o==i.length-1;if(l&&s==0||r.node(s).type.contentMatch.validEnd)return t.delete(r.start(s),u.end(s));if(s>0&&(l||r.node(s-1).canReplace(r.index(s-1),u.indexAfter(s-1))))return t.delete(r.before(s),u.after(s))}for(let o=1;o<=r.depth&&o<=u.depth;o++)if(e-r.start(o)==r.depth-o&&n>r.end(o)&&u.end(o)-n!=u.depth-o&&r.start(o-1)==u.start(o-1)&&r.node(o-1).canReplace(r.index(o-1),u.index(o-1)))return t.delete(r.before(o),n);t.delete(e,n)}function Po(t,e){let n=[],r=Math.min(t.depth,e.depth);for(let u=r;u>=0;u--){let i=t.start(u);if(i<t.pos-(t.depth-u)||e.end(u)>e.pos+(e.depth-u)||t.node(u).type.spec.isolating||e.node(u).type.spec.isolating)break;(i==e.start(u)||u==t.depth&&u==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&u&&e.start(u-1)==i-1)&&n.push(u)}return n}class ht extends K{constructor(e,n,r){super(),this.pos=e,this.attr=n,this.value=r}apply(e){let n=e.nodeAt(this.pos);if(!n)return R.fail("No node at attribute step's position");let r=Object.create(null);for(let i in n.attrs)r[i]=n.attrs[i];r[this.attr]=this.value;let u=n.type.create(r,null,n.marks);return R.fromReplace(e,this.pos,this.pos+1,new k(x.from(u),0,n.isLeaf?0:1))}getMap(){return ne.empty}invert(e){return new ht(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new ht(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.pos!="number"||typeof n.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new ht(n.pos,n.attr,n.value)}}K.jsonID("attr",ht);class Wt extends K{constructor(e,n){super(),this.attr=e,this.value=n}apply(e){let n=Object.create(null);for(let u in e.attrs)n[u]=e.attrs[u];n[this.attr]=this.value;let r=e.type.create(n,e.content,e.marks);return R.ok(r)}getMap(){return ne.empty}invert(e){return new Wt(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new Wt(n.attr,n.value)}}K.jsonID("docAttr",Wt);let bt=class extends Error{};bt=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n};bt.prototype=Object.create(Error.prototype);bt.prototype.constructor=bt;bt.prototype.name="TransformError";class Aa{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Ht}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let n=this.maybeStep(e);if(n.failed)throw new bt(n.failed);return this}maybeStep(e){let n=e.apply(this.doc);return n.failed||this.addStep(e,n.doc),n}get docChanged(){return this.steps.length>0}addStep(e,n){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=n}replace(e,n=e,r=k.empty){let u=nu(this.doc,e,n,r);return u&&this.step(u),this}replaceWith(e,n,r){return this.replace(e,n,new k(x.from(r),0,0))}delete(e,n){return this.replace(e,n,k.empty)}insert(e,n){return this.replaceWith(e,e,n)}replaceRange(e,n,r){return Ea(this,e,n,r),this}replaceRangeWith(e,n,r){return _a(this,e,n,r),this}deleteRange(e,n){return Sa(this,e,n),this}lift(e,n){return ca(this,e,n),this}join(e,n=1){return ya(this,e,n),this}wrap(e,n){return ha(this,e,n),this}setBlockType(e,n=e,r,u=null){return pa(this,e,n,r,u),this}setNodeMarkup(e,n,r=null,u){return ga(this,e,n,r,u),this}setNodeAttribute(e,n,r){return this.step(new ht(e,n,r)),this}setDocAttribute(e,n){return this.step(new Wt(e,n)),this}addNodeMark(e,n){return this.step(new Re(e,n)),this}removeNodeMark(e,n){let r=this.doc.nodeAt(e);if(!r)throw new RangeError("No node at position "+e);if(n instanceof M)n.isInSet(r.marks)&&this.step(new tt(e,n));else{let u=r.marks,i,o=[];for(;i=n.isInSet(u);)o.push(new tt(e,i)),u=i.removeFromSet(u);for(let s=o.length-1;s>=0;s--)this.step(o[s])}return this}split(e,n=1,r){return ba(this,e,n,r),this}addMark(e,n,r){return sa(this,e,n,r),this}removeMark(e,n,r){return la(this,e,n,r),this}clearIncompatible(e,n,r){return eu(this,e,n,r),this}}const nr=Object.create(null);class A{constructor(e,n,r){this.$anchor=e,this.$head=n,this.ranges=r||[new Ma(e.min(n),e.max(n))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let n=0;n<e.length;n++)if(e[n].$from.pos!=e[n].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,n=k.empty){let r=n.content.lastChild,u=null;for(let s=0;s<n.openEnd;s++)u=r,r=r.lastChild;let i=e.steps.length,o=this.ranges;for(let s=0;s<o.length;s++){let{$from:l,$to:a}=o[s],c=e.mapping.slice(i);e.replaceRange(c.map(l.pos),c.map(a.pos),s?k.empty:n),s==0&&Uu(e,i,(r?r.isInline:u&&u.isTextblock)?-1:1)}}replaceWith(e,n){let r=e.steps.length,u=this.ranges;for(let i=0;i<u.length;i++){let{$from:o,$to:s}=u[i],l=e.mapping.slice(r),a=l.map(o.pos),c=l.map(s.pos);i?e.deleteRange(a,c):(e.replaceRangeWith(a,c,n),Uu(e,r,n.isInline?-1:1))}}static findFrom(e,n,r=!1){let u=e.parent.inlineContent?new T(e):at(e.node(0),e.parent,e.pos,e.index(),n,r);if(u)return u;for(let i=e.depth-1;i>=0;i--){let o=n<0?at(e.node(0),e.node(i),e.before(i+1),e.index(i),n,r):at(e.node(0),e.node(i),e.after(i+1),e.index(i)+1,n,r);if(o)return o}return null}static near(e,n=1){return this.findFrom(e,n)||this.findFrom(e,-n)||new re(e.node(0))}static atStart(e){return at(e,e,0,0,1)||new re(e)}static atEnd(e){return at(e,e,e.content.size,e.childCount,-1)||new re(e)}static fromJSON(e,n){if(!n||!n.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=nr[n.type];if(!r)throw new RangeError(`No selection type ${n.type} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in nr)throw new RangeError("Duplicate use of selection JSON ID "+e);return nr[e]=n,n.prototype.jsonID=e,n}getBookmark(){return T.between(this.$anchor,this.$head).getBookmark()}}A.prototype.visible=!0;class Ma{constructor(e,n){this.$from=e,this.$to=n}}let Ju=!1;function ju(t){!Ju&&!t.parent.inlineContent&&(Ju=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class T extends A{constructor(e,n=e){ju(e),ju(n),super(e,n)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,n){let r=e.resolve(n.map(this.head));if(!r.parent.inlineContent)return A.near(r);let u=e.resolve(n.map(this.anchor));return new T(u.parent.inlineContent?u:r,r)}replace(e,n=k.empty){if(super.replace(e,n),n==k.empty){let r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}}eq(e){return e instanceof T&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new qn(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,n){if(typeof n.anchor!="number"||typeof n.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new T(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,r=n){let u=e.resolve(n);return new this(u,r==n?u:e.resolve(r))}static between(e,n,r){let u=e.pos-n.pos;if((!r||u)&&(r=u>=0?1:-1),!n.parent.inlineContent){let i=A.findFrom(n,r,!0)||A.findFrom(n,-r,!0);if(i)n=i.$head;else return A.near(n,r)}return e.parent.inlineContent||(u==0?e=n:(e=(A.findFrom(e,-r,!0)||A.findFrom(e,r,!0)).$anchor,e.pos<n.pos!=u<0&&(e=n))),new T(e,n)}}A.jsonID("text",T);class qn{constructor(e,n){this.anchor=e,this.head=n}map(e){return new qn(e.map(this.anchor),e.map(this.head))}resolve(e){return T.between(e.resolve(this.anchor),e.resolve(this.head))}}class w extends A{constructor(e){let n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);super(e,r),this.node=n}map(e,n){let{deleted:r,pos:u}=n.mapResult(this.anchor),i=e.resolve(u);return r?A.near(i):new w(i)}content(){return new k(x.from(this.node),0,0)}eq(e){return e instanceof w&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new ru(this.anchor)}static fromJSON(e,n){if(typeof n.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new w(e.resolve(n.anchor))}static create(e,n){return new w(e.resolve(n))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}w.prototype.visible=!1;A.jsonID("node",w);class ru{constructor(e){this.anchor=e}map(e){let{deleted:n,pos:r}=e.mapResult(this.anchor);return n?new qn(r,r):new ru(r)}resolve(e){let n=e.resolve(this.anchor),r=n.nodeAfter;return r&&w.isSelectable(r)?new w(n):A.near(n)}}class re extends A{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,n=k.empty){if(n==k.empty){e.delete(0,e.doc.content.size);let r=A.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else super.replace(e,n)}toJSON(){return{type:"all"}}static fromJSON(e){return new re(e)}map(e){return new re(e)}eq(e){return e instanceof re}getBookmark(){return Ta}}A.jsonID("all",re);const Ta={map(){return this},resolve(t){return new re(t)}};function at(t,e,n,r,u,i=!1){if(e.inlineContent)return T.create(t,n);for(let o=r-(u>0?0:1);u>0?o<e.childCount:o>=0;o+=u){let s=e.child(o);if(s.isAtom){if(!i&&w.isSelectable(s))return w.create(t,n-(u<0?s.nodeSize:0))}else{let l=at(t,s,n+u,u<0?s.childCount:0,u,i);if(l)return l}n+=s.nodeSize*u}return null}function Uu(t,e,n){let r=t.steps.length-1;if(r<e)return;let u=t.steps[r];if(!(u instanceof j||u instanceof W))return;let i=t.mapping.maps[r],o;i.forEach((s,l,a,c)=>{o==null&&(o=c)}),t.setSelection(A.near(t.doc.resolve(o),n))}const Ku=1,cn=2,Gu=4;class Oa extends Aa{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|Ku)&~cn,this.storedMarks=null,this}get selectionSet(){return(this.updated&Ku)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=cn,this}ensureMarks(e){return M.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&cn)>0}addStep(e,n){super.addStep(e,n),this.updated=this.updated&~cn,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,n=!0){let r=this.selection;return n&&(e=e.mark(this.storedMarks||(r.empty?r.$from.marks():r.$from.marksAcross(r.$to)||M.none))),r.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,n,r){let u=this.doc.type.schema;if(n==null)return e?this.replaceSelectionWith(u.text(e),!0):this.deleteSelection();{if(r==null&&(r=n),r=r??n,!e)return this.deleteRange(n,r);let i=this.storedMarks;if(!i){let o=this.doc.resolve(n);i=r==n?o.marks():o.marksAcross(this.doc.resolve(r))}return this.replaceRangeWith(n,r,u.text(e,i)),this.selection.empty||this.setSelection(A.near(this.selection.$to)),this}}setMeta(e,n){return this.meta[typeof e=="string"?e:e.key]=n,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=Gu,this}get scrolledIntoView(){return(this.updated&Gu)>0}}function Zu(t,e){return!e||!t?t:t.bind(e)}class Nt{constructor(e,n,r){this.name=e,this.init=Zu(n.init,r),this.apply=Zu(n.apply,r)}}const Fa=[new Nt("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new Nt("selection",{init(t,e){return t.selection||A.atStart(e.doc)},apply(t){return t.selection}}),new Nt("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new Nt("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})];class rr{constructor(e,n){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=Fa.slice(),n&&n.forEach(r=>{if(this.pluginsByKey[r.key])throw new RangeError("Adding different instances of a keyed plugin ("+r.key+")");this.plugins.push(r),this.pluginsByKey[r.key]=r,r.spec.state&&this.fields.push(new Nt(r.key,r.spec.state,r))})}}class ft{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,n=-1){for(let r=0;r<this.config.plugins.length;r++)if(r!=n){let u=this.config.plugins[r];if(u.spec.filterTransaction&&!u.spec.filterTransaction.call(u,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let n=[e],r=this.applyInner(e),u=null;for(;;){let i=!1;for(let o=0;o<this.config.plugins.length;o++){let s=this.config.plugins[o];if(s.spec.appendTransaction){let l=u?u[o].n:0,a=u?u[o].state:this,c=l<n.length&&s.spec.appendTransaction.call(s,l?n.slice(l):n,a,r);if(c&&r.filterTransaction(c,o)){if(c.setMeta("appendedTransaction",e),!u){u=[];for(let f=0;f<this.config.plugins.length;f++)u.push(f<o?{state:r,n:n.length}:{state:this,n:0})}n.push(c),r=r.applyInner(c),i=!0}u&&(u[o]={state:r,n:n.length})}}if(!i)return{state:r,transactions:n}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let n=new ft(this.config),r=this.config.fields;for(let u=0;u<r.length;u++){let i=r[u];n[i.name]=i.apply(e,this[i.name],this,n)}return n}get tr(){return new Oa(this)}static create(e){let n=new rr(e.doc?e.doc.type.schema:e.schema,e.plugins),r=new ft(n);for(let u=0;u<n.fields.length;u++)r[n.fields[u].name]=n.fields[u].init(e,r);return r}reconfigure(e){let n=new rr(this.schema,e.plugins),r=n.fields,u=new ft(n);for(let i=0;i<r.length;i++){let o=r[i].name;u[o]=this.hasOwnProperty(o)?this[o]:r[i].init(e,u)}return u}toJSON(e){let n={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(n.storedMarks=this.storedMarks.map(r=>r.toJSON())),e&&typeof e=="object")for(let r in e){if(r=="doc"||r=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let u=e[r],i=u.spec.state;i&&i.toJSON&&(n[r]=i.toJSON.call(u,this[u.key]))}return n}static fromJSON(e,n,r){if(!n)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let u=new rr(e.schema,e.plugins),i=new ft(u);return u.fields.forEach(o=>{if(o.name=="doc")i.doc=Ze.fromJSON(e.schema,n.doc);else if(o.name=="selection")i.selection=A.fromJSON(i.doc,n.selection);else if(o.name=="storedMarks")n.storedMarks&&(i.storedMarks=n.storedMarks.map(e.schema.markFromJSON));else{if(r)for(let s in r){let l=r[s],a=l.spec.state;if(l.key==o.name&&a&&a.fromJSON&&Object.prototype.hasOwnProperty.call(n,s)){i[o.name]=a.fromJSON.call(l,e,n[s],i);return}}i[o.name]=o.init(e,i)}}),i}}function Lo(t,e,n){for(let r in t){let u=t[r];u instanceof Function?u=u.bind(e):r=="handleDOMEvents"&&(u=Lo(u,e,{})),n[r]=u}return n}class ut{constructor(e){this.spec=e,this.props={},e.props&&Lo(e.props,this,this.props),this.key=e.key?e.key.key:qo("plugin")}getState(e){return e[this.key]}}const ur=Object.create(null);function qo(t){return t in ur?t+"$"+ ++ur[t]:(ur[t]=0,t+"$")}class Vo{constructor(e="key"){this.key=qo(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const $=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},xt=function(t){let e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e};let Fr=null;const Ee=function(t,e,n){let r=Fr||(Fr=document.createRange());return r.setEnd(t,n??t.nodeValue.length),r.setStart(t,e||0),r},Na=function(){Fr=null},nt=function(t,e,n,r){return n&&(Qu(t,e,n,r,-1)||Qu(t,e,n,r,1))},va=/^(img|br|input|textarea|hr)$/i;function Qu(t,e,n,r,u){for(var i;;){if(t==n&&e==r)return!0;if(e==(u<0?0:se(t))){let o=t.parentNode;if(!o||o.nodeType!=1||tn(t)||va.test(t.nodeName)||t.contentEditable=="false")return!1;e=$(t)+(u<0?0:1),t=o}else if(t.nodeType==1){let o=t.childNodes[e+(u<0?-1:0)];if(o.nodeType==1&&o.contentEditable=="false")if(!((i=o.pmViewDesc)===null||i===void 0)&&i.ignoreForSelection)e+=u;else return!1;else t=o,e=u<0?se(t):0}else return!1}}function se(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function Ia(t,e){for(;;){if(t.nodeType==3&&e)return t;if(t.nodeType==1&&e>0){if(t.contentEditable=="false")return null;t=t.childNodes[e-1],e=se(t)}else if(t.parentNode&&!tn(t))e=$(t),t=t.parentNode;else return null}}function Ra(t,e){for(;;){if(t.nodeType==3&&e<t.nodeValue.length)return t;if(t.nodeType==1&&e<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[e],e=0}else if(t.parentNode&&!tn(t))e=$(t)+1,t=t.parentNode;else return null}}function Ba(t,e,n){for(let r=e==0,u=e==se(t);r||u;){if(t==n)return!0;let i=$(t);if(t=t.parentNode,!t)return!1;r=r&&i==0,u=u&&i==se(t)}}function tn(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const Vn=function(t){return t.focusNode&&nt(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function Je(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}function za(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function Pa(t,e,n){if(t.caretPositionFromPoint)try{let r=t.caretPositionFromPoint(e,n);if(r)return{node:r.offsetNode,offset:Math.min(se(r.offsetNode),r.offset)}}catch{}if(t.caretRangeFromPoint){let r=t.caretRangeFromPoint(e,n);if(r)return{node:r.startContainer,offset:Math.min(se(r.startContainer),r.startOffset)}}}const ye=typeof navigator<"u"?navigator:null,Yu=typeof document<"u"?document:null,He=ye&&ye.userAgent||"",Nr=/Edge\/(\d+)/.exec(He),$o=/MSIE \d/.exec(He),vr=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(He),ee=!!($o||vr||Nr),Pe=$o?document.documentMode:vr?+vr[1]:Nr?+Nr[1]:0,he=!ee&&/gecko\/(\d+)/i.test(He);he&&+(/Firefox\/(\d+)/.exec(He)||[0,0])[1];const Ir=!ee&&/Chrome\/(\d+)/.exec(He),U=!!Ir,Ho=Ir?+Ir[1]:0,G=!ee&&!!ye&&/Apple Computer/.test(ye.vendor),yt=G&&(/Mobile\/\w+/.test(He)||!!ye&&ye.maxTouchPoints>2),oe=yt||(ye?/Mac/.test(ye.platform):!1),La=ye?/Win/.test(ye.platform):!1,Se=/Android \d/.test(He),nn=!!Yu&&"webkitFontSmoothing"in Yu.documentElement.style,qa=nn?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function Va(t){let e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function we(t,e){return typeof t=="number"?t:t[e]}function $a(t){let e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,r=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*n,top:e.top,bottom:e.top+t.clientHeight*r}}function Xu(t,e,n){let r=t.someProp("scrollThreshold")||0,u=t.someProp("scrollMargin")||5,i=t.dom.ownerDocument;for(let o=n||t.dom;o;){if(o.nodeType!=1){o=xt(o);continue}let s=o,l=s==i.body,a=l?Va(i):$a(s),c=0,f=0;if(e.top<a.top+we(r,"top")?f=-(a.top-e.top+we(u,"top")):e.bottom>a.bottom-we(r,"bottom")&&(f=e.bottom-e.top>a.bottom-a.top?e.top+we(u,"top")-a.top:e.bottom-a.bottom+we(u,"bottom")),e.left<a.left+we(r,"left")?c=-(a.left-e.left+we(u,"left")):e.right>a.right-we(r,"right")&&(c=e.right-a.right+we(u,"right")),c||f)if(l)i.defaultView.scrollBy(c,f);else{let p=s.scrollLeft,h=s.scrollTop;f&&(s.scrollTop+=f),c&&(s.scrollLeft+=c);let m=s.scrollLeft-p,g=s.scrollTop-h;e={left:e.left-m,top:e.top-g,right:e.right-m,bottom:e.bottom-g}}let d=l?"fixed":getComputedStyle(o).position;if(/^(fixed|sticky)$/.test(d))break;o=d=="absolute"?o.offsetParent:xt(o)}}function Ha(t){let e=t.dom.getBoundingClientRect(),n=Math.max(0,e.top),r,u;for(let i=(e.left+e.right)/2,o=n+1;o<Math.min(innerHeight,e.bottom);o+=5){let s=t.root.elementFromPoint(i,o);if(!s||s==t.dom||!t.dom.contains(s))continue;let l=s.getBoundingClientRect();if(l.top>=n-20){r=s,u=l.top;break}}return{refDOM:r,refTop:u,stack:Wo(t.dom)}}function Wo(t){let e=[],n=t.ownerDocument;for(let r=t;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),t!=n);r=xt(r));return e}function Wa({refDOM:t,refTop:e,stack:n}){let r=t?t.getBoundingClientRect().top:0;Jo(n,r==0?0:r-e)}function Jo(t,e){for(let n=0;n<t.length;n++){let{dom:r,top:u,left:i}=t[n];r.scrollTop!=u+e&&(r.scrollTop=u+e),r.scrollLeft!=i&&(r.scrollLeft=i)}}let ot=null;function Ja(t){if(t.setActive)return t.setActive();if(ot)return t.focus(ot);let e=Wo(t);t.focus(ot==null?{get preventScroll(){return ot={preventScroll:!0},!0}}:void 0),ot||(ot=!1,Jo(e,0))}function jo(t,e){let n,r=2e8,u,i=0,o=e.top,s=e.top,l,a;for(let c=t.firstChild,f=0;c;c=c.nextSibling,f++){let d;if(c.nodeType==1)d=c.getClientRects();else if(c.nodeType==3)d=Ee(c).getClientRects();else continue;for(let p=0;p<d.length;p++){let h=d[p];if(h.top<=o&&h.bottom>=s){o=Math.max(h.bottom,o),s=Math.min(h.top,s);let m=h.left>e.left?h.left-e.left:h.right<e.left?e.left-h.right:0;if(m<r){n=c,r=m,u=m&&n.nodeType==3?{left:h.right<e.left?h.right:h.left,top:e.top}:e,c.nodeType==1&&m&&(i=f+(e.left>=(h.left+h.right)/2?1:0));continue}}else h.top>e.top&&!l&&h.left<=e.left&&h.right>=e.left&&(l=c,a={left:Math.max(h.left,Math.min(h.right,e.left)),top:h.top});!n&&(e.left>=h.right&&e.top>=h.top||e.left>=h.left&&e.top>=h.bottom)&&(i=f+1)}}return!n&&l&&(n=l,u=a,r=0),n&&n.nodeType==3?ja(n,u):!n||r&&n.nodeType==1?{node:t,offset:i}:jo(n,u)}function ja(t,e){let n=t.nodeValue.length,r=document.createRange();for(let u=0;u<n;u++){r.setEnd(t,u+1),r.setStart(t,u);let i=Me(r,1);if(i.top!=i.bottom&&uu(e,i))return{node:t,offset:u+(e.left>=(i.left+i.right)/2?1:0)}}return{node:t,offset:0}}function uu(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function Ua(t,e){let n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}function Ka(t,e,n){let{node:r,offset:u}=jo(e,n),i=-1;if(r.nodeType==1&&!r.firstChild){let o=r.getBoundingClientRect();i=o.left!=o.right&&n.left>(o.left+o.right)/2?1:-1}return t.docView.posFromDOM(r,u,i)}function Ga(t,e,n,r){let u=-1;for(let i=e,o=!1;i!=t.dom;){let s=t.docView.nearestDesc(i,!0),l;if(!s)return null;if(s.dom.nodeType==1&&(s.node.isBlock&&s.parent||!s.contentDOM)&&((l=s.dom.getBoundingClientRect()).width||l.height)&&(s.node.isBlock&&s.parent&&(!o&&l.left>r.left||l.top>r.top?u=s.posBefore:(!o&&l.right<r.left||l.bottom<r.top)&&(u=s.posAfter),o=!0),!s.contentDOM&&u<0&&!s.node.isText))return(s.node.isBlock?r.top<(l.top+l.bottom)/2:r.left<(l.left+l.right)/2)?s.posBefore:s.posAfter;i=s.dom.parentNode}return u>-1?u:t.docView.posFromDOM(e,n,-1)}function Uo(t,e,n){let r=t.childNodes.length;if(r&&n.top<n.bottom)for(let u=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-n.top)/(n.bottom-n.top))-2)),i=u;;){let o=t.childNodes[i];if(o.nodeType==1){let s=o.getClientRects();for(let l=0;l<s.length;l++){let a=s[l];if(uu(e,a))return Uo(o,e,a)}}if((i=(i+1)%r)==u)break}return t}function Za(t,e){let n=t.dom.ownerDocument,r,u=0,i=Pa(n,e.left,e.top);i&&({node:r,offset:u}=i);let o=(t.root.elementFromPoint?t.root:n).elementFromPoint(e.left,e.top),s;if(!o||!t.dom.contains(o.nodeType!=1?o.parentNode:o)){let a=t.dom.getBoundingClientRect();if(!uu(e,a)||(o=Uo(t.dom,e,a),!o))return null}if(G)for(let a=o;r&&a;a=xt(a))a.draggable&&(r=void 0);if(o=Ua(o,e),r){if(he&&r.nodeType==1&&(u=Math.min(u,r.childNodes.length),u<r.childNodes.length)){let c=r.childNodes[u],f;c.nodeName=="IMG"&&(f=c.getBoundingClientRect()).right<=e.left&&f.bottom>e.top&&u++}let a;nn&&u&&r.nodeType==1&&(a=r.childNodes[u-1]).nodeType==1&&a.contentEditable=="false"&&a.getBoundingClientRect().top>=e.top&&u--,r==t.dom&&u==r.childNodes.length-1&&r.lastChild.nodeType==1&&e.top>r.lastChild.getBoundingClientRect().bottom?s=t.state.doc.content.size:(u==0||r.nodeType!=1||r.childNodes[u-1].nodeName!="BR")&&(s=Ga(t,r,u,e))}s==null&&(s=Ka(t,o,e));let l=t.docView.nearestDesc(o,!0);return{pos:s,inside:l?l.posAtStart-l.border:-1}}function ei(t){return t.top<t.bottom||t.left<t.right}function Me(t,e){let n=t.getClientRects();if(n.length){let r=n[e<0?0:n.length-1];if(ei(r))return r}return Array.prototype.find.call(n,ei)||t.getBoundingClientRect()}const Qa=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function Ko(t,e,n){let{node:r,offset:u,atom:i}=t.docView.domFromPos(e,n<0?-1:1),o=nn||he;if(r.nodeType==3)if(o&&(Qa.test(r.nodeValue)||(n<0?!u:u==r.nodeValue.length))){let l=Me(Ee(r,u,u),n);if(he&&u&&/\s/.test(r.nodeValue[u-1])&&u<r.nodeValue.length){let a=Me(Ee(r,u-1,u-1),-1);if(a.top==l.top){let c=Me(Ee(r,u,u+1),-1);if(c.top!=l.top)return Mt(c,c.left<a.left)}}return l}else{let l=u,a=u,c=n<0?1:-1;return n<0&&!u?(a++,c=-1):n>=0&&u==r.nodeValue.length?(l--,c=1):n<0?l--:a++,Mt(Me(Ee(r,l,a),c),c<0)}if(!t.state.doc.resolve(e-(i||0)).parent.inlineContent){if(i==null&&u&&(n<0||u==se(r))){let l=r.childNodes[u-1];if(l.nodeType==1)return ir(l.getBoundingClientRect(),!1)}if(i==null&&u<se(r)){let l=r.childNodes[u];if(l.nodeType==1)return ir(l.getBoundingClientRect(),!0)}return ir(r.getBoundingClientRect(),n>=0)}if(i==null&&u&&(n<0||u==se(r))){let l=r.childNodes[u-1],a=l.nodeType==3?Ee(l,se(l)-(o?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(a)return Mt(Me(a,1),!1)}if(i==null&&u<se(r)){let l=r.childNodes[u];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let a=l?l.nodeType==3?Ee(l,0,o?0:1):l.nodeType==1?l:null:null;if(a)return Mt(Me(a,-1),!0)}return Mt(Me(r.nodeType==3?Ee(r):r,-n),n>=0)}function Mt(t,e){if(t.width==0)return t;let n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function ir(t,e){if(t.height==0)return t;let n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function Go(t,e,n){let r=t.state,u=t.root.activeElement;r!=e&&t.updateState(e),u!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),u!=t.dom&&u&&u.focus()}}function Ya(t,e,n){let r=e.selection,u=n=="up"?r.$from:r.$to;return Go(t,e,()=>{let{node:i}=t.docView.domFromPos(u.pos,n=="up"?-1:1);for(;;){let s=t.docView.nearestDesc(i,!0);if(!s)break;if(s.node.isBlock){i=s.contentDOM||s.dom;break}i=s.dom.parentNode}let o=Ko(t,u.pos,1);for(let s=i.firstChild;s;s=s.nextSibling){let l;if(s.nodeType==1)l=s.getClientRects();else if(s.nodeType==3)l=Ee(s,0,s.nodeValue.length).getClientRects();else continue;for(let a=0;a<l.length;a++){let c=l[a];if(c.bottom>c.top+1&&(n=="up"?o.top-c.top>(c.bottom-o.top)*2:c.bottom-o.bottom>(o.bottom-c.top)*2))return!1}}return!0})}const Xa=/[\u0590-\u08ac]/;function ec(t,e,n){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let u=r.parentOffset,i=!u,o=u==r.parent.content.size,s=t.domSelection();return s?!Xa.test(r.parent.textContent)||!s.modify?n=="left"||n=="backward"?i:o:Go(t,e,()=>{let{focusNode:l,focusOffset:a,anchorNode:c,anchorOffset:f}=t.domSelectionRange(),d=s.caretBidiLevel;s.modify("move",n,"character");let p=r.depth?t.docView.domAfterPos(r.before()):t.dom,{focusNode:h,focusOffset:m}=t.domSelectionRange(),g=h&&!p.contains(h.nodeType==1?h:h.parentNode)||l==h&&a==m;try{s.collapse(c,f),l&&(l!=c||a!=f)&&s.extend&&s.extend(l,a)}catch{}return d!=null&&(s.caretBidiLevel=d),g}):r.pos==r.start()||r.pos==r.end()}let ti=null,ni=null,ri=!1;function tc(t,e,n){return ti==e&&ni==n?ri:(ti=e,ni=n,ri=n=="up"||n=="down"?Ya(t,e,n):ec(t,e,n))}const ae=0,ui=1,je=2,ke=3;class rn{constructor(e,n,r,u){this.parent=e,this.children=n,this.dom=r,this.contentDOM=u,this.dirty=ae,r.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,n,r){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let n=0;n<this.children.length;n++)e+=this.children[n].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let n=0,r=this.posAtStart;;n++){let u=this.children[n];if(u==e)return r;r+=u.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,n,r){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(r<0){let i,o;if(e==this.contentDOM)i=e.childNodes[n-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.previousSibling}for(;i&&!((o=i.pmViewDesc)&&o.parent==this);)i=i.previousSibling;return i?this.posBeforeChild(o)+o.size:this.posAtStart}else{let i,o;if(e==this.contentDOM)i=e.childNodes[n];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.nextSibling}for(;i&&!((o=i.pmViewDesc)&&o.parent==this);)i=i.nextSibling;return i?this.posBeforeChild(o):this.posAtEnd}let u;if(e==this.dom&&this.contentDOM)u=n>$(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))u=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(n==0)for(let i=e;;i=i.parentNode){if(i==this.dom){u=!1;break}if(i.previousSibling)break}if(u==null&&n==e.childNodes.length)for(let i=e;;i=i.parentNode){if(i==this.dom){u=!0;break}if(i.nextSibling)break}}return u??r>0?this.posAtEnd:this.posAtStart}nearestDesc(e,n=!1){for(let r=!0,u=e;u;u=u.parentNode){let i=this.getDesc(u),o;if(i&&(!n||i.node))if(r&&(o=i.nodeDOM)&&!(o.nodeType==1?o.contains(e.nodeType==1?e:e.parentNode):o==e))r=!1;else return i}}getDesc(e){let n=e.pmViewDesc;for(let r=n;r;r=r.parent)if(r==this)return n}posFromDOM(e,n,r){for(let u=e;u;u=u.parentNode){let i=this.getDesc(u);if(i)return i.localPosFromDOM(e,n,r)}return-1}descAt(e){for(let n=0,r=0;n<this.children.length;n++){let u=this.children[n],i=r+u.size;if(r==e&&i!=r){for(;!u.border&&u.children.length;)for(let o=0;o<u.children.length;o++){let s=u.children[o];if(s.size){u=s;break}}return u}if(e<i)return u.descAt(e-r-u.border);r=i}}domFromPos(e,n){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let r=0,u=0;for(let i=0;r<this.children.length;r++){let o=this.children[r],s=i+o.size;if(s>e||o instanceof Qo){u=e-i;break}i=s}if(u)return this.children[r].domFromPos(u-this.children[r].border,n);for(let i;r&&!(i=this.children[r-1]).size&&i instanceof Zo&&i.side>=0;r--);if(n<=0){let i,o=!0;for(;i=r?this.children[r-1]:null,!(!i||i.dom.parentNode==this.contentDOM);r--,o=!1);return i&&n&&o&&!i.border&&!i.domAtom?i.domFromPos(i.size,n):{node:this.contentDOM,offset:i?$(i.dom)+1:0}}else{let i,o=!0;for(;i=r<this.children.length?this.children[r]:null,!(!i||i.dom.parentNode==this.contentDOM);r++,o=!1);return i&&o&&!i.border&&!i.domAtom?i.domFromPos(0,n):{node:this.contentDOM,offset:i?$(i.dom):this.contentDOM.childNodes.length}}}parseRange(e,n,r=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:n,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let u=-1,i=-1;for(let o=r,s=0;;s++){let l=this.children[s],a=o+l.size;if(u==-1&&e<=a){let c=o+l.border;if(e>=c&&n<=a-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,n,c);e=o;for(let f=s;f>0;f--){let d=this.children[f-1];if(d.size&&d.dom.parentNode==this.contentDOM&&!d.emptyChildAt(1)){u=$(d.dom)+1;break}e-=d.size}u==-1&&(u=0)}if(u>-1&&(a>n||s==this.children.length-1)){n=a;for(let c=s+1;c<this.children.length;c++){let f=this.children[c];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(-1)){i=$(f.dom);break}n+=f.size}i==-1&&(i=this.contentDOM.childNodes.length);break}o=a}return{node:this.contentDOM,from:e,to:n,fromOffset:u,toOffset:i}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let n=this.children[e<0?0:this.children.length-1];return n.size==0||n.emptyChildAt(e)}domAfterPos(e){let{node:n,offset:r}=this.domFromPos(e,0);if(n.nodeType!=1||r==n.childNodes.length)throw new RangeError("No node after pos "+e);return n.childNodes[r]}setSelection(e,n,r,u=!1){let i=Math.min(e,n),o=Math.max(e,n);for(let p=0,h=0;p<this.children.length;p++){let m=this.children[p],g=h+m.size;if(i>h&&o<g)return m.setSelection(e-h-m.border,n-h-m.border,r,u);h=g}let s=this.domFromPos(e,e?-1:1),l=n==e?s:this.domFromPos(n,n?-1:1),a=r.root.getSelection(),c=r.domSelectionRange(),f=!1;if((he||G)&&e==n){let{node:p,offset:h}=s;if(p.nodeType==3){if(f=!!(h&&p.nodeValue[h-1]==`
`),f&&h==p.nodeValue.length)for(let m=p,g;m;m=m.parentNode){if(g=m.nextSibling){g.nodeName=="BR"&&(s=l={node:g.parentNode,offset:$(g)+1});break}let b=m.pmViewDesc;if(b&&b.node&&b.node.isBlock)break}}else{let m=p.childNodes[h-1];f=m&&(m.nodeName=="BR"||m.contentEditable=="false")}}if(he&&c.focusNode&&c.focusNode!=l.node&&c.focusNode.nodeType==1){let p=c.focusNode.childNodes[c.focusOffset];p&&p.contentEditable=="false"&&(u=!0)}if(!(u||f&&G)&&nt(s.node,s.offset,c.anchorNode,c.anchorOffset)&&nt(l.node,l.offset,c.focusNode,c.focusOffset))return;let d=!1;if((a.extend||e==n)&&!f){a.collapse(s.node,s.offset);try{e!=n&&a.extend(l.node,l.offset),d=!0}catch{}}if(!d){if(e>n){let h=s;s=l,l=h}let p=document.createRange();p.setEnd(l.node,l.offset),p.setStart(s.node,s.offset),a.removeAllRanges(),a.addRange(p)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,n){for(let r=0,u=0;u<this.children.length;u++){let i=this.children[u],o=r+i.size;if(r==o?e<=o&&n>=r:e<o&&n>r){let s=r+i.border,l=o-i.border;if(e>=s&&n<=l){this.dirty=e==r||n==o?je:ui,e==s&&n==l&&(i.contentLost||i.dom.parentNode!=this.contentDOM)?i.dirty=ke:i.markDirty(e-s,n-s);return}else i.dirty=i.dom==i.contentDOM&&i.dom.parentNode==this.contentDOM&&!i.children.length?je:ke}r=o}this.dirty=je}markParentsDirty(){let e=1;for(let n=this.parent;n;n=n.parent,e++){let r=e==1?je:ui;n.dirty<r&&(n.dirty=r)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class Zo extends rn{constructor(e,n,r,u){let i,o=n.type.toDOM;if(typeof o=="function"&&(o=o(r,()=>{if(!i)return u;if(i.parent)return i.parent.posBeforeChild(i)})),!n.type.spec.raw){if(o.nodeType!=1){let s=document.createElement("span");s.appendChild(o),o=s}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=n,this.widget=n,i=this}matchesWidget(e){return this.dirty==ae&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let n=this.widget.spec.stopEvent;return n?n(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class nc extends rn{constructor(e,n,r,u){super(e,[],n,null),this.textDOM=r,this.text=u}get size(){return this.text.length}localPosFromDOM(e,n){return e!=this.textDOM?this.posAtStart+(n?this.size:0):this.posAtStart+n}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class rt extends rn{constructor(e,n,r,u,i){super(e,[],r,u),this.mark=n,this.spec=i}static create(e,n,r,u){let i=u.nodeViews[n.type.name],o=i&&i(n,u,r);return(!o||!o.dom)&&(o=wt.renderSpec(document,n.type.spec.toDOM(n,r),null,n.attrs)),new rt(e,n,o.dom,o.contentDOM||o.dom,o)}parseRule(){return this.dirty&ke||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=ke&&this.mark.eq(e)}markDirty(e,n){if(super.markDirty(e,n),this.dirty!=ae){let r=this.parent;for(;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=ae}}slice(e,n,r){let u=rt.create(this.parent,this.mark,!0,r),i=this.children,o=this.size;n<o&&(i=Br(i,n,o,r)),e>0&&(i=Br(i,0,e,r));for(let s=0;s<i.length;s++)i[s].parent=u;return u.children=i,u}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class Le extends rn{constructor(e,n,r,u,i,o,s,l,a){super(e,[],i,o),this.node=n,this.outerDeco=r,this.innerDeco=u,this.nodeDOM=s}static create(e,n,r,u,i,o){let s=i.nodeViews[n.type.name],l,a=s&&s(n,i,()=>{if(!l)return o;if(l.parent)return l.parent.posBeforeChild(l)},r,u),c=a&&a.dom,f=a&&a.contentDOM;if(n.isText){if(!c)c=document.createTextNode(n.text);else if(c.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else c||({dom:c,contentDOM:f}=wt.renderSpec(document,n.type.spec.toDOM(n),null,n.attrs));!f&&!n.isText&&c.nodeName!="BR"&&(c.hasAttribute("contenteditable")||(c.contentEditable="false"),n.type.spec.draggable&&(c.draggable=!0));let d=c;return c=es(c,r,n),a?l=new rc(e,n,r,u,c,f||null,d,a,i,o+1):n.isText?new $n(e,n,r,u,c,d,i):new Le(e,n,r,u,c,f||null,d,i,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let n=this.children.length-1;n>=0;n--){let r=this.children[n];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=()=>x.empty)}return e}matchesNode(e,n,r){return this.dirty==ae&&e.eq(this.node)&&Sn(n,this.outerDeco)&&r.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,n){let r=this.node.inlineContent,u=n,i=e.composing?this.localCompositionInfo(e,n):null,o=i&&i.pos>-1?i:null,s=i&&i.pos<0,l=new ic(this,o&&o.node,e);lc(this.node,this.innerDeco,(a,c,f)=>{a.spec.marks?l.syncToMarks(a.spec.marks,r,e):a.type.side>=0&&!f&&l.syncToMarks(c==this.node.childCount?M.none:this.node.child(c).marks,r,e),l.placeWidget(a,e,u)},(a,c,f,d)=>{l.syncToMarks(a.marks,r,e);let p;l.findNodeMatch(a,c,f,d)||s&&e.state.selection.from>u&&e.state.selection.to<u+a.nodeSize&&(p=l.findIndexWithChild(i.node))>-1&&l.updateNodeAt(a,c,f,p,e)||l.updateNextNode(a,c,f,e,d,u)||l.addNode(a,c,f,e,u),u+=a.nodeSize}),l.syncToMarks([],r,e),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==je)&&(o&&this.protectLocalComposition(e,o),Yo(this.contentDOM,this.children,e),yt&&ac(this.dom))}localCompositionInfo(e,n){let{from:r,to:u}=e.state.selection;if(!(e.state.selection instanceof T)||r<n||u>n+this.node.content.size)return null;let i=e.input.compositionNode;if(!i||!this.dom.contains(i.parentNode))return null;if(this.node.inlineContent){let o=i.nodeValue,s=cc(this.node.content,o,r-n,u-n);return s<0?null:{node:i,pos:s,text:o}}else return{node:i,pos:-1,text:""}}protectLocalComposition(e,{node:n,pos:r,text:u}){if(this.getDesc(n))return;let i=n;for(;i.parentNode!=this.contentDOM;i=i.parentNode){for(;i.previousSibling;)i.parentNode.removeChild(i.previousSibling);for(;i.nextSibling;)i.parentNode.removeChild(i.nextSibling);i.pmViewDesc&&(i.pmViewDesc=void 0)}let o=new nc(this,i,n,u);e.input.compositionNodes.push(o),this.children=Br(this.children,r,r+u.length,e,o)}update(e,n,r,u){return this.dirty==ke||!e.sameMarkup(this.node)?!1:(this.updateInner(e,n,r,u),!0)}updateInner(e,n,r,u){this.updateOuterDeco(n),this.node=e,this.innerDeco=r,this.contentDOM&&this.updateChildren(u,this.posAtStart),this.dirty=ae}updateOuterDeco(e){if(Sn(e,this.outerDeco))return;let n=this.nodeDOM.nodeType!=1,r=this.dom;this.dom=Xo(this.dom,this.nodeDOM,Rr(this.outerDeco,this.node,n),Rr(e,this.node,n)),this.dom!=r&&(r.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function ii(t,e,n,r,u){es(r,e,t);let i=new Le(void 0,t,e,n,r,r,r,u,0);return i.contentDOM&&i.updateChildren(u,0),i}class $n extends Le{constructor(e,n,r,u,i,o,s){super(e,n,r,u,i,null,o,s,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,n,r,u){return this.dirty==ke||this.dirty!=ae&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(n),(this.dirty!=ae||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,u.trackWrites==this.nodeDOM&&(u.trackWrites=null)),this.node=e,this.dirty=ae,!0)}inParent(){let e=this.parent.contentDOM;for(let n=this.nodeDOM;n;n=n.parentNode)if(n==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,n,r){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):super.localPosFromDOM(e,n,r)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,n,r){let u=this.node.cut(e,n),i=document.createTextNode(u.text);return new $n(this.parent,u,this.outerDeco,this.innerDeco,i,i,r)}markDirty(e,n){super.markDirty(e,n),this.dom!=this.nodeDOM&&(e==0||n==this.nodeDOM.nodeValue.length)&&(this.dirty=ke)}get domAtom(){return!1}isText(e){return this.node.text==e}}class Qo extends rn{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==ae&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class rc extends Le{constructor(e,n,r,u,i,o,s,l,a,c){super(e,n,r,u,i,o,s,a,c),this.spec=l}update(e,n,r,u){if(this.dirty==ke)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let i=this.spec.update(e,n,r);return i&&this.updateInner(e,n,r,u),i}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,n,r,u)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,n,r,u){this.spec.setSelection?this.spec.setSelection(e,n,r.root):super.setSelection(e,n,r,u)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function Yo(t,e,n){let r=t.firstChild,u=!1;for(let i=0;i<e.length;i++){let o=e[i],s=o.dom;if(s.parentNode==t){for(;s!=r;)r=oi(r),u=!0;r=r.nextSibling}else u=!0,t.insertBefore(s,r);if(o instanceof rt){let l=r?r.previousSibling:t.lastChild;Yo(o.contentDOM,o.children,n),r=l?l.nextSibling:t.firstChild}}for(;r;)r=oi(r),u=!0;u&&n.trackWrites==t&&(n.trackWrites=null)}const Rt=function(t){t&&(this.nodeName=t)};Rt.prototype=Object.create(null);const Ue=[new Rt];function Rr(t,e,n){if(t.length==0)return Ue;let r=n?Ue[0]:new Rt,u=[r];for(let i=0;i<t.length;i++){let o=t[i].type.attrs;if(o){o.nodeName&&u.push(r=new Rt(o.nodeName));for(let s in o){let l=o[s];l!=null&&(n&&u.length==1&&u.push(r=new Rt(e.isInline?"span":"div")),s=="class"?r.class=(r.class?r.class+" ":"")+l:s=="style"?r.style=(r.style?r.style+";":"")+l:s!="nodeName"&&(r[s]=l))}}}return u}function Xo(t,e,n,r){if(n==Ue&&r==Ue)return e;let u=e;for(let i=0;i<r.length;i++){let o=r[i],s=n[i];if(i){let l;s&&s.nodeName==o.nodeName&&u!=t&&(l=u.parentNode)&&l.nodeName.toLowerCase()==o.nodeName||(l=document.createElement(o.nodeName),l.pmIsDeco=!0,l.appendChild(u),s=Ue[0]),u=l}uc(u,s||Ue[0],o)}return u}function uc(t,e,n){for(let r in e)r!="class"&&r!="style"&&r!="nodeName"&&!(r in n)&&t.removeAttribute(r);for(let r in n)r!="class"&&r!="style"&&r!="nodeName"&&n[r]!=e[r]&&t.setAttribute(r,n[r]);if(e.class!=n.class){let r=e.class?e.class.split(" ").filter(Boolean):[],u=n.class?n.class.split(" ").filter(Boolean):[];for(let i=0;i<r.length;i++)u.indexOf(r[i])==-1&&t.classList.remove(r[i]);for(let i=0;i<u.length;i++)r.indexOf(u[i])==-1&&t.classList.add(u[i]);t.classList.length==0&&t.removeAttribute("class")}if(e.style!=n.style){if(e.style){let r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,u;for(;u=r.exec(e.style);)t.style.removeProperty(u[1])}n.style&&(t.style.cssText+=n.style)}}function es(t,e,n){return Xo(t,t,Ue,Rr(e,n,t.nodeType!=1))}function Sn(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function oi(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class ic{constructor(e,n,r){this.lock=n,this.view=r,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=oc(e.node.content,e)}destroyBetween(e,n){if(e!=n){for(let r=e;r<n;r++)this.top.children[r].destroy();this.top.children.splice(e,n-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,n,r){let u=0,i=this.stack.length>>1,o=Math.min(i,e.length);for(;u<o&&(u==i-1?this.top:this.stack[u+1<<1]).matchesMark(e[u])&&e[u].type.spec.spanning!==!1;)u++;for(;u<i;)this.destroyRest(),this.top.dirty=ae,this.index=this.stack.pop(),this.top=this.stack.pop(),i--;for(;i<e.length;){this.stack.push(this.top,this.index+1);let s=-1;for(let l=this.index;l<Math.min(this.index+3,this.top.children.length);l++){let a=this.top.children[l];if(a.matchesMark(e[i])&&!this.isLocked(a.dom)){s=l;break}}if(s>-1)s>this.index&&(this.changed=!0,this.destroyBetween(this.index,s)),this.top=this.top.children[this.index];else{let l=rt.create(this.top,e[i],n,r);this.top.children.splice(this.index,0,l),this.top=l,this.changed=!0}this.index=0,i++}}findNodeMatch(e,n,r,u){let i=-1,o;if(u>=this.preMatch.index&&(o=this.preMatch.matches[u-this.preMatch.index]).parent==this.top&&o.matchesNode(e,n,r))i=this.top.children.indexOf(o,this.index);else for(let s=this.index,l=Math.min(this.top.children.length,s+5);s<l;s++){let a=this.top.children[s];if(a.matchesNode(e,n,r)&&!this.preMatch.matched.has(a)){i=s;break}}return i<0?!1:(this.destroyBetween(this.index,i),this.index++,!0)}updateNodeAt(e,n,r,u,i){let o=this.top.children[u];return o.dirty==ke&&o.dom==o.contentDOM&&(o.dirty=je),o.update(e,n,r,i)?(this.destroyBetween(this.index,u),this.index++,!0):!1}findIndexWithChild(e){for(;;){let n=e.parentNode;if(!n)return-1;if(n==this.top.contentDOM){let r=e.pmViewDesc;if(r){for(let u=this.index;u<this.top.children.length;u++)if(this.top.children[u]==r)return u}return-1}e=n}}updateNextNode(e,n,r,u,i,o){for(let s=this.index;s<this.top.children.length;s++){let l=this.top.children[s];if(l instanceof Le){let a=this.preMatch.matched.get(l);if(a!=null&&a!=i)return!1;let c=l.dom,f,d=this.isLocked(c)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=ke&&Sn(n,l.outerDeco));if(!d&&l.update(e,n,r,u))return this.destroyBetween(this.index,s),l.dom!=c&&(this.changed=!0),this.index++,!0;if(!d&&(f=this.recreateWrapper(l,e,n,r,u,o)))return this.destroyBetween(this.index,s),this.top.children[this.index]=f,f.contentDOM&&(f.dirty=je,f.updateChildren(u,o+1),f.dirty=ae),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,n,r,u,i,o){if(e.dirty||n.isAtom||!e.children.length||!e.node.content.eq(n.content)||!Sn(r,e.outerDeco)||!u.eq(e.innerDeco))return null;let s=Le.create(this.top,n,r,u,i,o);if(s.contentDOM){s.children=e.children,e.children=[];for(let l of s.children)l.parent=s}return e.destroy(),s}addNode(e,n,r,u,i){let o=Le.create(this.top,e,n,r,u,i);o.contentDOM&&o.updateChildren(u,i+1),this.top.children.splice(this.index++,0,o),this.changed=!0}placeWidget(e,n,r){let u=this.index<this.top.children.length?this.top.children[this.index]:null;if(u&&u.matchesWidget(e)&&(e==u.widget||!u.widget.type.toDOM.parentNode))this.index++;else{let i=new Zo(this.top,e,n,r);this.top.children.splice(this.index++,0,i),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],n=this.top;for(;e instanceof rt;)n=e,e=n.children[n.children.length-1];(!e||!(e instanceof $n)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((G||U)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",n),this.addHackNode("BR",this.top))}addHackNode(e,n){if(n==this.top&&this.index<n.children.length&&n.children[this.index].matchesHack(e))this.index++;else{let r=document.createElement(e);e=="IMG"&&(r.className="ProseMirror-separator",r.alt=""),e=="BR"&&(r.className="ProseMirror-trailingBreak");let u=new Qo(this.top,[],r,null);n!=this.top?n.children.push(u):n.children.splice(this.index++,0,u),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function oc(t,e){let n=e,r=n.children.length,u=t.childCount,i=new Map,o=[];e:for(;u>0;){let s;for(;;)if(r){let a=n.children[r-1];if(a instanceof rt)n=a,r=a.children.length;else{s=a,r--;break}}else{if(n==e)break e;r=n.parent.children.indexOf(n),n=n.parent}let l=s.node;if(l){if(l!=t.child(u-1))break;--u,i.set(s,u),o.push(s)}}return{index:u,matched:i,matches:o.reverse()}}function sc(t,e){return t.type.side-e.type.side}function lc(t,e,n,r){let u=e.locals(t),i=0;if(u.length==0){for(let a=0;a<t.childCount;a++){let c=t.child(a);r(c,u,e.forChild(i,c),a),i+=c.nodeSize}return}let o=0,s=[],l=null;for(let a=0;;){let c,f;for(;o<u.length&&u[o].to==i;){let g=u[o++];g.widget&&(c?(f||(f=[c])).push(g):c=g)}if(c)if(f){f.sort(sc);for(let g=0;g<f.length;g++)n(f[g],a,!!l)}else n(c,a,!!l);let d,p;if(l)p=-1,d=l,l=null;else if(a<t.childCount)p=a,d=t.child(a++);else break;for(let g=0;g<s.length;g++)s[g].to<=i&&s.splice(g--,1);for(;o<u.length&&u[o].from<=i&&u[o].to>i;)s.push(u[o++]);let h=i+d.nodeSize;if(d.isText){let g=h;o<u.length&&u[o].from<g&&(g=u[o].from);for(let b=0;b<s.length;b++)s[b].to<g&&(g=s[b].to);g<h&&(l=d.cut(g-i),d=d.cut(0,g-i),h=g,p=-1)}else for(;o<u.length&&u[o].to<h;)o++;let m=d.isInline&&!d.isLeaf?s.filter(g=>!g.inline):s.slice();r(d,m,e.forChild(i,d),p),i=h}}function ac(t){if(t.nodeName=="UL"||t.nodeName=="OL"){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function cc(t,e,n,r){for(let u=0,i=0;u<t.childCount&&i<=r;){let o=t.child(u++),s=i;if(i+=o.nodeSize,!o.isText)continue;let l=o.text;for(;u<t.childCount;){let a=t.child(u++);if(i+=a.nodeSize,!a.isText)break;l+=a.text}if(i>=n){if(i>=r&&l.slice(r-e.length-s,r-s)==e)return r-e.length;let a=s<r?l.lastIndexOf(e,r-s-1):-1;if(a>=0&&a+e.length+s>=n)return s+a;if(n==r&&l.length>=r+e.length-s&&l.slice(r-s,r-s+e.length)==e)return r}}return-1}function Br(t,e,n,r,u){let i=[];for(let o=0,s=0;o<t.length;o++){let l=t[o],a=s,c=s+=l.size;a>=n||c<=e?i.push(l):(a<e&&i.push(l.slice(0,e-a,r)),u&&(i.push(u),u=void 0),c>n&&i.push(l.slice(n-a,l.size,r)))}return i}function iu(t,e=null){let n=t.domSelectionRange(),r=t.state.doc;if(!n.focusNode)return null;let u=t.docView.nearestDesc(n.focusNode),i=u&&u.size==0,o=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(o<0)return null;let s=r.resolve(o),l,a;if(Vn(n)){for(l=o;u&&!u.node;)u=u.parent;let f=u.node;if(u&&f.isAtom&&w.isSelectable(f)&&u.parent&&!(f.isInline&&Ba(n.focusNode,n.focusOffset,u.dom))){let d=u.posBefore;a=new w(o==d?s:r.resolve(d))}}else{if(n instanceof t.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let f=o,d=o;for(let p=0;p<n.rangeCount;p++){let h=n.getRangeAt(p);f=Math.min(f,t.docView.posFromDOM(h.startContainer,h.startOffset,1)),d=Math.max(d,t.docView.posFromDOM(h.endContainer,h.endOffset,-1))}if(f<0)return null;[l,o]=d==t.state.selection.anchor?[d,f]:[f,d],s=r.resolve(o)}else l=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(l<0)return null}let c=r.resolve(l);if(!a){let f=e=="pointer"||t.state.selection.head<s.pos&&!i?1:-1;a=ou(t,c,s,f)}return a}function ts(t){return t.editable?t.hasFocus():rs(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function Ae(t,e=!1){let n=t.state.selection;if(ns(t,n),!!ts(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&U){let r=t.domSelectionRange(),u=t.domObserver.currentSelection;if(r.anchorNode&&u.anchorNode&&nt(r.anchorNode,r.anchorOffset,u.anchorNode,u.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)dc(t);else{let{anchor:r,head:u}=n,i,o;si&&!(n instanceof T)&&(n.$from.parent.inlineContent||(i=li(t,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(o=li(t,n.to))),t.docView.setSelection(r,u,t,e),si&&(i&&ai(i),o&&ai(o)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&fc(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const si=G||U&&Ho<63;function li(t,e){let{node:n,offset:r}=t.docView.domFromPos(e,0),u=r<n.childNodes.length?n.childNodes[r]:null,i=r?n.childNodes[r-1]:null;if(G&&u&&u.contentEditable=="false")return or(u);if((!u||u.contentEditable=="false")&&(!i||i.contentEditable=="false")){if(u)return or(u);if(i)return or(i)}}function or(t){return t.contentEditable="true",G&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function ai(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function fc(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelectionRange(),r=n.anchorNode,u=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(n.anchorNode!=r||n.anchorOffset!=u)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!ts(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function dc(t){let e=t.domSelection(),n=document.createRange();if(!e)return;let r=t.cursorWrapper.dom,u=r.nodeName=="IMG";u?n.setStart(r.parentNode,$(r)+1):n.setStart(r,0),n.collapse(!0),e.removeAllRanges(),e.addRange(n),!u&&!t.state.selection.visible&&ee&&Pe<=11&&(r.disabled=!0,r.disabled=!1)}function ns(t,e){if(e instanceof w){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(ci(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else ci(t)}function ci(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function ou(t,e,n,r){return t.someProp("createSelectionBetween",u=>u(t,e,n))||T.between(e,n,r)}function fi(t){return t.editable&&!t.hasFocus()?!1:rs(t)}function rs(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function hc(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),n=t.domSelectionRange();return nt(e.node,e.offset,n.anchorNode,n.anchorOffset)}function zr(t,e){let{$anchor:n,$head:r}=t.selection,u=e>0?n.max(r):n.min(r),i=u.parent.inlineContent?u.depth?t.doc.resolve(e>0?u.after():u.before()):null:u;return i&&A.findFrom(i,e)}function Te(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function di(t,e,n){let r=t.state.selection;if(r instanceof T)if(n.indexOf("s")>-1){let{$head:u}=r,i=u.textOffset?null:e<0?u.nodeBefore:u.nodeAfter;if(!i||i.isText||!i.isLeaf)return!1;let o=t.state.doc.resolve(u.pos+i.nodeSize*(e<0?-1:1));return Te(t,new T(r.$anchor,o))}else if(r.empty){if(t.endOfTextblock(e>0?"forward":"backward")){let u=zr(t.state,e);return u&&u instanceof w?Te(t,u):!1}else if(!(oe&&n.indexOf("m")>-1)){let u=r.$head,i=u.textOffset?null:e<0?u.nodeBefore:u.nodeAfter,o;if(!i||i.isText)return!1;let s=e<0?u.pos-i.nodeSize:u.pos;return i.isAtom||(o=t.docView.descAt(s))&&!o.contentDOM?w.isSelectable(i)?Te(t,new w(e<0?t.state.doc.resolve(u.pos-i.nodeSize):u)):nn?Te(t,new T(t.state.doc.resolve(e<0?s:s+i.nodeSize))):!1:!1}}else return!1;else{if(r instanceof w&&r.node.isInline)return Te(t,new T(e>0?r.$to:r.$from));{let u=zr(t.state,e);return u?Te(t,u):!1}}}function An(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function Bt(t,e){let n=t.pmViewDesc;return n&&n.size==0&&(e<0||t.nextSibling||t.nodeName!="BR")}function st(t,e){return e<0?pc(t):mc(t)}function pc(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let u,i,o=!1;for(he&&n.nodeType==1&&r<An(n)&&Bt(n.childNodes[r],-1)&&(o=!0);;)if(r>0){if(n.nodeType!=1)break;{let s=n.childNodes[r-1];if(Bt(s,-1))u=n,i=--r;else if(s.nodeType==3)n=s,r=n.nodeValue.length;else break}}else{if(us(n))break;{let s=n.previousSibling;for(;s&&Bt(s,-1);)u=n.parentNode,i=$(s),s=s.previousSibling;if(s)n=s,r=An(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}}o?Pr(t,n,r):u&&Pr(t,u,i)}function mc(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let u=An(n),i,o;for(;;)if(r<u){if(n.nodeType!=1)break;let s=n.childNodes[r];if(Bt(s,1))i=n,o=++r;else break}else{if(us(n))break;{let s=n.nextSibling;for(;s&&Bt(s,1);)i=s.parentNode,o=$(s)+1,s=s.nextSibling;if(s)n=s,r=0,u=An(n);else{if(n=n.parentNode,n==t.dom)break;r=u=0}}}i&&Pr(t,i,o)}function us(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function gc(t,e){for(;t&&e==t.childNodes.length&&!tn(t);)e=$(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let n=t.childNodes[e];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=0}}function bc(t,e){for(;t&&!e&&!tn(t);)e=$(t),t=t.parentNode;for(;t&&e;){let n=t.childNodes[e-1];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=t.childNodes.length}}function Pr(t,e,n){if(e.nodeType!=3){let i,o;(o=gc(e,n))?(e=o,n=0):(i=bc(e,n))&&(e=i,n=i.nodeValue.length)}let r=t.domSelection();if(!r)return;if(Vn(r)){let i=document.createRange();i.setEnd(e,n),i.setStart(e,n),r.removeAllRanges(),r.addRange(i)}else r.extend&&r.extend(e,n);t.domObserver.setCurSelection();let{state:u}=t;setTimeout(()=>{t.state==u&&Ae(t)},50)}function hi(t,e){let n=t.state.doc.resolve(e);if(!(U||La)&&n.parent.inlineContent){let u=t.coordsAtPos(e);if(e>n.start()){let i=t.coordsAtPos(e-1),o=(i.top+i.bottom)/2;if(o>u.top&&o<u.bottom&&Math.abs(i.left-u.left)>1)return i.left<u.left?"ltr":"rtl"}if(e<n.end()){let i=t.coordsAtPos(e+1),o=(i.top+i.bottom)/2;if(o>u.top&&o<u.bottom&&Math.abs(i.left-u.left)>1)return i.left>u.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function pi(t,e,n){let r=t.state.selection;if(r instanceof T&&!r.empty||n.indexOf("s")>-1||oe&&n.indexOf("m")>-1)return!1;let{$from:u,$to:i}=r;if(!u.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let o=zr(t.state,e);if(o&&o instanceof w)return Te(t,o)}if(!u.parent.inlineContent){let o=e<0?u:i,s=r instanceof re?A.near(o,e):A.findFrom(o,e);return s?Te(t,s):!1}return!1}function mi(t,e){if(!(t.state.selection instanceof T))return!0;let{$head:n,$anchor:r,empty:u}=t.state.selection;if(!n.sameParent(r))return!0;if(!u)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let i=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(i&&!i.isText){let o=t.state.tr;return e<0?o.delete(n.pos-i.nodeSize,n.pos):o.delete(n.pos,n.pos+i.nodeSize),t.dispatch(o),!0}return!1}function gi(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function xc(t){if(!G||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(e&&e.nodeType==1&&n==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let r=e.firstChild;gi(t,r,"true"),setTimeout(()=>gi(t,r,"false"),20)}return!1}function yc(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function kc(t,e){let n=e.keyCode,r=yc(e);if(n==8||oe&&n==72&&r=="c")return mi(t,-1)||st(t,-1);if(n==46&&!e.shiftKey||oe&&n==68&&r=="c")return mi(t,1)||st(t,1);if(n==13||n==27)return!0;if(n==37||oe&&n==66&&r=="c"){let u=n==37?hi(t,t.state.selection.from)=="ltr"?-1:1:-1;return di(t,u,r)||st(t,u)}else if(n==39||oe&&n==70&&r=="c"){let u=n==39?hi(t,t.state.selection.from)=="ltr"?1:-1:1;return di(t,u,r)||st(t,u)}else{if(n==38||oe&&n==80&&r=="c")return pi(t,-1,r)||st(t,-1);if(n==40||oe&&n==78&&r=="c")return xc(t)||pi(t,1,r)||st(t,1);if(r==(oe?"m":"c")&&(n==66||n==73||n==89||n==90))return!0}return!1}function su(t,e){t.someProp("transformCopied",p=>{e=p(e,t)});let n=[],{content:r,openStart:u,openEnd:i}=e;for(;u>1&&i>1&&r.childCount==1&&r.firstChild.childCount==1;){u--,i--;let p=r.firstChild;n.push(p.type.name,p.attrs!=p.type.defaultAttrs?p.attrs:null),r=p.content}let o=t.someProp("clipboardSerializer")||wt.fromSchema(t.state.schema),s=fs(),l=s.createElement("div");l.appendChild(o.serializeFragment(r,{document:s}));let a=l.firstChild,c,f=0;for(;a&&a.nodeType==1&&(c=cs[a.nodeName.toLowerCase()]);){for(let p=c.length-1;p>=0;p--){let h=s.createElement(c[p]);for(;l.firstChild;)h.appendChild(l.firstChild);l.appendChild(h),f++}a=l.firstChild}a&&a.nodeType==1&&a.setAttribute("data-pm-slice",`${u} ${i}${f?` -${f}`:""} ${JSON.stringify(n)}`);let d=t.someProp("clipboardTextSerializer",p=>p(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:d,slice:e}}function is(t,e,n,r,u){let i=u.parent.type.spec.code,o,s;if(!n&&!e)return null;let l=e&&(r||i||!n);if(l){if(t.someProp("transformPastedText",d=>{e=d(e,i||r,t)}),i)return e?new k(x.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0):k.empty;let f=t.someProp("clipboardTextParser",d=>d(e,u,r,t));if(f)s=f;else{let d=u.marks(),{schema:p}=t.state,h=wt.fromSchema(p);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(m=>{let g=o.appendChild(document.createElement("p"));m&&g.appendChild(h.serializeNode(p.text(m,d)))})}}else t.someProp("transformPastedHTML",f=>{n=f(n,t)}),o=Ec(n),nn&&_c(o);let a=o&&o.querySelector("[data-pm-slice]"),c=a&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(a.getAttribute("data-pm-slice")||"");if(c&&c[3])for(let f=+c[3];f>0;f--){let d=o.firstChild;for(;d&&d.nodeType!=1;)d=d.nextSibling;if(!d)break;o=d}if(s||(s=(t.someProp("clipboardParser")||t.someProp("domParser")||Vt.fromSchema(t.state.schema)).parseSlice(o,{preserveWhitespace:!!(l||c),context:u,ruleFromNode(d){return d.nodeName=="BR"&&!d.nextSibling&&d.parentNode&&!Cc.test(d.parentNode.nodeName)?{ignore:!0}:null}})),c)s=Sc(bi(s,+c[1],+c[2]),c[4]);else if(s=k.maxOpen(Dc(s.content,u),!0),s.openStart||s.openEnd){let f=0,d=0;for(let p=s.content.firstChild;f<s.openStart&&!p.type.spec.isolating;f++,p=p.firstChild);for(let p=s.content.lastChild;d<s.openEnd&&!p.type.spec.isolating;d++,p=p.lastChild);s=bi(s,f,d)}return t.someProp("transformPasted",f=>{s=f(s,t)}),s}const Cc=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function Dc(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let u=e.node(n).contentMatchAt(e.index(n)),i,o=[];if(t.forEach(s=>{if(!o)return;let l=u.findWrapping(s.type),a;if(!l)return o=null;if(a=o.length&&i.length&&ls(l,i,s,o[o.length-1],0))o[o.length-1]=a;else{o.length&&(o[o.length-1]=as(o[o.length-1],i.length));let c=ss(s,l);o.push(c),u=u.matchType(c.type),i=l}}),o)return x.from(o)}return t}function ss(t,e,n=0){for(let r=e.length-1;r>=n;r--)t=e[r].create(null,x.from(t));return t}function ls(t,e,n,r,u){if(u<t.length&&u<e.length&&t[u]==e[u]){let i=ls(t,e,n,r.lastChild,u+1);if(i)return r.copy(r.content.replaceChild(r.childCount-1,i));if(r.contentMatchAt(r.childCount).matchType(u==t.length-1?n.type:t[u+1]))return r.copy(r.content.append(x.from(ss(n,t,u+1))))}}function as(t,e){if(e==0)return t;let n=t.content.replaceChild(t.childCount-1,as(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(x.empty,!0);return t.copy(n.append(r))}function Lr(t,e,n,r,u,i){let o=e<0?t.firstChild:t.lastChild,s=o.content;return t.childCount>1&&(i=0),u<r-1&&(s=Lr(s,e,n,r,u+1,i)),u>=n&&(s=e<0?o.contentMatchAt(0).fillBefore(s,i<=u).append(s):s.append(o.contentMatchAt(o.childCount).fillBefore(x.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,o.copy(s))}function bi(t,e,n){return e<t.openStart&&(t=new k(Lr(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new k(Lr(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const cs={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let xi=null;function fs(){return xi||(xi=document.implementation.createHTMLDocument("title"))}let sr=null;function wc(t){let e=window.trustedTypes;return e?(sr||(sr=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:n=>n})),sr.createHTML(t)):t}function Ec(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let n=fs().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(t),u;if((u=r&&cs[r[1].toLowerCase()])&&(t=u.map(i=>"<"+i+">").join("")+t+u.map(i=>"</"+i+">").reverse().join("")),n.innerHTML=wc(t),u)for(let i=0;i<u.length;i++)n=n.querySelector(u[i])||n;return n}function _c(t){let e=t.querySelectorAll(U?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let r=e[n];r.childNodes.length==1&&r.textContent==""&&r.parentNode&&r.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),r)}}function Sc(t,e){if(!t.size)return t;let n=t.content.firstChild.type.schema,r;try{r=JSON.parse(e)}catch{return t}let{content:u,openStart:i,openEnd:o}=t;for(let s=r.length-2;s>=0;s-=2){let l=n.nodes[r[s]];if(!l||l.hasRequiredAttrs())break;u=x.from(l.create(r[s+1],u)),i++,o++}return new k(u,i,o)}const Z={},Q={},Ac={touchstart:!0,touchmove:!0};class Mc{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function Tc(t){for(let e in Z){let n=Z[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=r=>{Fc(t,r)&&!lu(t,r)&&(t.editable||!(r.type in Q))&&n(t,r)},Ac[e]?{passive:!0}:void 0)}G&&t.dom.addEventListener("input",()=>null),qr(t)}function Be(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function Oc(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}function qr(t){t.someProp("handleDOMEvents",e=>{for(let n in e)t.input.eventHandlers[n]||t.dom.addEventListener(n,t.input.eventHandlers[n]=r=>lu(t,r))})}function lu(t,e){return t.someProp("handleDOMEvents",n=>{let r=n[e.type];return r?r(t,e)||e.defaultPrevented:!1})}function Fc(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target;n!=t.dom;n=n.parentNode)if(!n||n.nodeType==11||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function Nc(t,e){!lu(t,e)&&Z[e.type]&&(t.editable||!(e.type in Q))&&Z[e.type](t,e)}Q.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=n.keyCode==16||n.shiftKey,!hs(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!(Se&&U&&n.keyCode==13)))if(n.keyCode!=229&&t.domObserver.forceFlush(),yt&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let r=Date.now();t.input.lastIOSEnter=r,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==r&&(t.someProp("handleKeyDown",u=>u(t,Je(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",r=>r(t,n))||kc(t,n)?n.preventDefault():Be(t,"key")};Q.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)};Q.keypress=(t,e)=>{let n=e;if(hs(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||oe&&n.metaKey)return;if(t.someProp("handleKeyPress",u=>u(t,n))){n.preventDefault();return}let r=t.state.selection;if(!(r instanceof T)||!r.$from.sameParent(r.$to)){let u=String.fromCharCode(n.charCode),i=()=>t.state.tr.insertText(u).scrollIntoView();!/[\r\n]/.test(u)&&!t.someProp("handleTextInput",o=>o(t,r.$from.pos,r.$to.pos,u,i))&&t.dispatch(i()),n.preventDefault()}};function Hn(t){return{left:t.clientX,top:t.clientY}}function vc(t,e){let n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}function au(t,e,n,r,u){if(r==-1)return!1;let i=t.state.doc.resolve(r);for(let o=i.depth+1;o>0;o--)if(t.someProp(e,s=>o>i.depth?s(t,n,i.nodeAfter,i.before(o),u,!0):s(t,n,i.node(o),i.before(o),u,!1)))return!0;return!1}function pt(t,e,n){if(t.focused||t.focus(),t.state.selection.eq(e))return;let r=t.state.tr.setSelection(e);r.setMeta("pointer",!0),t.dispatch(r)}function Ic(t,e){if(e==-1)return!1;let n=t.state.doc.resolve(e),r=n.nodeAfter;return r&&r.isAtom&&w.isSelectable(r)?(pt(t,new w(n)),!0):!1}function Rc(t,e){if(e==-1)return!1;let n=t.state.selection,r,u;n instanceof w&&(r=n.node);let i=t.state.doc.resolve(e);for(let o=i.depth+1;o>0;o--){let s=o>i.depth?i.nodeAfter:i.node(o);if(w.isSelectable(s)){r&&n.$from.depth>0&&o>=n.$from.depth&&i.before(n.$from.depth+1)==n.$from.pos?u=i.before(n.$from.depth):u=i.before(o);break}}return u!=null?(pt(t,w.create(t.state.doc,u)),!0):!1}function Bc(t,e,n,r,u){return au(t,"handleClickOn",e,n,r)||t.someProp("handleClick",i=>i(t,e,r))||(u?Rc(t,n):Ic(t,n))}function zc(t,e,n,r){return au(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",u=>u(t,e,r))}function Pc(t,e,n,r){return au(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",u=>u(t,e,r))||Lc(t,n,r)}function Lc(t,e,n){if(n.button!=0)return!1;let r=t.state.doc;if(e==-1)return r.inlineContent?(pt(t,T.create(r,0,r.content.size)),!0):!1;let u=r.resolve(e);for(let i=u.depth+1;i>0;i--){let o=i>u.depth?u.nodeAfter:u.node(i),s=u.before(i);if(o.inlineContent)pt(t,T.create(r,s+1,s+1+o.content.size));else if(w.isSelectable(o))pt(t,w.create(r,s));else continue;return!0}}function cu(t){return Mn(t)}const ds=oe?"metaKey":"ctrlKey";Z.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let r=cu(t),u=Date.now(),i="singleClick";u-t.input.lastClick.time<500&&vc(n,t.input.lastClick)&&!n[ds]&&t.input.lastClick.button==n.button&&(t.input.lastClick.type=="singleClick"?i="doubleClick":t.input.lastClick.type=="doubleClick"&&(i="tripleClick")),t.input.lastClick={time:u,x:n.clientX,y:n.clientY,type:i,button:n.button};let o=t.posAtCoords(Hn(n));o&&(i=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new qc(t,o,n,!!r)):(i=="doubleClick"?zc:Pc)(t,o.pos,o.inside,n)?n.preventDefault():Be(t,"pointer"))};class qc{constructor(e,n,r,u){this.view=e,this.pos=n,this.event=r,this.flushed=u,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[ds],this.allowDefault=r.shiftKey;let i,o;if(n.inside>-1)i=e.state.doc.nodeAt(n.inside),o=n.inside;else{let c=e.state.doc.resolve(n.pos);i=c.parent,o=c.depth?c.before():0}const s=u?null:r.target,l=s?e.docView.nearestDesc(s,!0):null;this.target=l&&l.dom.nodeType==1?l.dom:null;let{selection:a}=e.state;(r.button==0&&i.type.spec.draggable&&i.type.spec.selectable!==!1||a instanceof w&&a.from<=o&&a.to>o)&&(this.mightDrag={node:i,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&he&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Be(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>Ae(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(Hn(e))),this.updateAllowDefault(e),this.allowDefault||!n?Be(this.view,"pointer"):Bc(this.view,n.pos,n.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||G&&this.mightDrag&&!this.mightDrag.node.isAtom||U&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(pt(this.view,A.near(this.view.state.doc.resolve(n.pos))),e.preventDefault()):Be(this.view,"pointer")}move(e){this.updateAllowDefault(e),Be(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}Z.touchstart=t=>{t.input.lastTouch=Date.now(),cu(t),Be(t,"pointer")};Z.touchmove=t=>{t.input.lastTouch=Date.now(),Be(t,"pointer")};Z.contextmenu=t=>cu(t);function hs(t,e){return t.composing?!0:G&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const Vc=Se?5e3:-1;Q.compositionstart=Q.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$to;if(e.selection instanceof T&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)))t.markCursor=t.state.storedMarks||n.marks(),Mn(t,!0),t.markCursor=null;else if(Mn(t,!e.selection.empty),he&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let r=t.domSelectionRange();for(let u=r.focusNode,i=r.focusOffset;u&&u.nodeType==1&&i!=0;){let o=i<0?u.lastChild:u.childNodes[i-1];if(!o)break;if(o.nodeType==3){let s=t.domSelection();s&&s.collapse(o,o.nodeValue.length);break}else u=o,i=-1}}t.input.composing=!0}ps(t,Vc)};Q.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,ps(t,20))};function ps(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>Mn(t),e))}function ms(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=Hc());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function $c(t){let e=t.domSelectionRange();if(!e.focusNode)return null;let n=Ia(e.focusNode,e.focusOffset),r=Ra(e.focusNode,e.focusOffset);if(n&&r&&n!=r){let u=r.pmViewDesc,i=t.domObserver.lastChangedTextNode;if(n==i||r==i)return i;if(!u||!u.isText(r.nodeValue))return r;if(t.input.compositionNode==r){let o=n.pmViewDesc;if(!(!o||!o.isText(n.nodeValue)))return r}}return n||r}function Hc(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function Mn(t,e=!1){if(!(Se&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),ms(t),e||t.docView&&t.docView.dirty){let n=iu(t),r=t.state.selection;return n&&!n.eq(r)?t.dispatch(t.state.tr.setSelection(n)):(t.markCursor||e)&&!r.$from.node(r.$from.sharedDepth(r.to)).inlineContent?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function Wc(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),u=document.createRange();u.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(u),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}const Jt=ee&&Pe<15||yt&&qa<604;Z.copy=Q.cut=(t,e)=>{let n=e,r=t.state.selection,u=n.type=="cut";if(r.empty)return;let i=Jt?null:n.clipboardData,o=r.content(),{dom:s,text:l}=su(t,o);i?(n.preventDefault(),i.clearData(),i.setData("text/html",s.innerHTML),i.setData("text/plain",l)):Wc(t,s),u&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function Jc(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function jc(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let u=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?jt(t,r.value,null,u,e):jt(t,r.textContent,r.innerHTML,u,e)},50)}function jt(t,e,n,r,u){let i=is(t,e,n,r,t.state.selection.$from);if(t.someProp("handlePaste",l=>l(t,u,i||k.empty)))return!0;if(!i)return!1;let o=Jc(i),s=o?t.state.tr.replaceSelectionWith(o,r):t.state.tr.replaceSelection(i);return t.dispatch(s.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function gs(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let n=t.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}Q.paste=(t,e)=>{let n=e;if(t.composing&&!Se)return;let r=Jt?null:n.clipboardData,u=t.input.shiftKey&&t.input.lastKeyCode!=45;r&&jt(t,gs(r),r.getData("text/html"),u,n)?n.preventDefault():jc(t,n)};class bs{constructor(e,n,r){this.slice=e,this.move=n,this.node=r}}const Uc=oe?"altKey":"ctrlKey";function xs(t,e){let n=t.someProp("dragCopies",r=>!r(e));return n??!e[Uc]}Z.dragstart=(t,e)=>{let n=e,r=t.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let u=t.state.selection,i=u.empty?null:t.posAtCoords(Hn(n)),o;if(!(i&&i.pos>=u.from&&i.pos<=(u instanceof w?u.to-1:u.to))){if(r&&r.mightDrag)o=w.create(t.state.doc,r.mightDrag.pos);else if(n.target&&n.target.nodeType==1){let f=t.docView.nearestDesc(n.target,!0);f&&f.node.type.spec.draggable&&f!=t.docView&&(o=w.create(t.state.doc,f.posBefore))}}let s=(o||t.state.selection).content(),{dom:l,text:a,slice:c}=su(t,s);(!n.dataTransfer.files.length||!U||Ho>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(Jt?"Text":"text/html",l.innerHTML),n.dataTransfer.effectAllowed="copyMove",Jt||n.dataTransfer.setData("text/plain",a),t.dragging=new bs(c,xs(t,n),o)};Z.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)};Q.dragover=Q.dragenter=(t,e)=>e.preventDefault();Q.drop=(t,e)=>{let n=e,r=t.dragging;if(t.dragging=null,!n.dataTransfer)return;let u=t.posAtCoords(Hn(n));if(!u)return;let i=t.state.doc.resolve(u.pos),o=r&&r.slice;o?t.someProp("transformPasted",h=>{o=h(o,t)}):o=is(t,gs(n.dataTransfer),Jt?null:n.dataTransfer.getData("text/html"),!1,i);let s=!!(r&&xs(t,n));if(t.someProp("handleDrop",h=>h(t,n,o||k.empty,s))){n.preventDefault();return}if(!o)return;n.preventDefault();let l=o?Io(t.state.doc,i.pos,o):i.pos;l==null&&(l=i.pos);let a=t.state.tr;if(s){let{node:h}=r;h?h.replace(a):a.deleteSelection()}let c=a.mapping.map(l),f=o.openStart==0&&o.openEnd==0&&o.content.childCount==1,d=a.doc;if(f?a.replaceRangeWith(c,c,o.content.firstChild):a.replaceRange(c,c,o),a.doc.eq(d))return;let p=a.doc.resolve(c);if(f&&w.isSelectable(o.content.firstChild)&&p.nodeAfter&&p.nodeAfter.sameMarkup(o.content.firstChild))a.setSelection(new w(p));else{let h=a.mapping.map(l);a.mapping.maps[a.mapping.maps.length-1].forEach((m,g,b,y)=>h=y),a.setSelection(ou(t,p,a.doc.resolve(h)))}t.focus(),t.dispatch(a.setMeta("uiEvent","drop"))};Z.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&Ae(t)},20))};Z.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)};Z.beforeinput=(t,e)=>{if(U&&Se&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:r}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=r||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",i=>i(t,Je(8,"Backspace")))))return;let{$cursor:u}=t.state.selection;u&&u.pos>0&&t.dispatch(t.state.tr.delete(u.pos-1,u.pos).scrollIntoView())},50)}};for(let t in Q)Z[t]=Q[t];function Ut(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class Tn{constructor(e,n){this.toDOM=e,this.spec=n||Qe,this.side=this.spec.side||0}map(e,n,r,u){let{pos:i,deleted:o}=e.mapResult(n.from+u,this.side<0?-1:1);return o?null:new le(i-r,i-r,this)}valid(){return!0}eq(e){return this==e||e instanceof Tn&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Ut(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class qe{constructor(e,n){this.attrs=e,this.spec=n||Qe}map(e,n,r,u){let i=e.map(n.from+u,this.spec.inclusiveStart?-1:1)-r,o=e.map(n.to+u,this.spec.inclusiveEnd?1:-1)-r;return i>=o?null:new le(i,o,this)}valid(e,n){return n.from<n.to}eq(e){return this==e||e instanceof qe&&Ut(this.attrs,e.attrs)&&Ut(this.spec,e.spec)}static is(e){return e.type instanceof qe}destroy(){}}class fu{constructor(e,n){this.attrs=e,this.spec=n||Qe}map(e,n,r,u){let i=e.mapResult(n.from+u,1);if(i.deleted)return null;let o=e.mapResult(n.to+u,-1);return o.deleted||o.pos<=i.pos?null:new le(i.pos-r,o.pos-r,this)}valid(e,n){let{index:r,offset:u}=e.content.findIndex(n.from),i;return u==n.from&&!(i=e.child(r)).isText&&u+i.nodeSize==n.to}eq(e){return this==e||e instanceof fu&&Ut(this.attrs,e.attrs)&&Ut(this.spec,e.spec)}destroy(){}}class le{constructor(e,n,r){this.from=e,this.to=n,this.type=r}copy(e,n){return new le(e,n,this.type)}eq(e,n=0){return this.type.eq(e.type)&&this.from+n==e.from&&this.to+n==e.to}map(e,n,r){return this.type.map(e,this,n,r)}static widget(e,n,r){return new le(e,e,new Tn(n,r))}static inline(e,n,r,u){return new le(e,n,new qe(r,u))}static node(e,n,r,u){return new le(e,n,new fu(r,u))}get spec(){return this.type.spec}get inline(){return this.type instanceof qe}get widget(){return this.type instanceof Tn}}const ct=[],Qe={};class B{constructor(e,n){this.local=e.length?e:ct,this.children=n.length?n:ct}static create(e,n){return n.length?On(n,e,0,Qe):J}find(e,n,r){let u=[];return this.findInner(e??0,n??1e9,u,0,r),u}findInner(e,n,r,u,i){for(let o=0;o<this.local.length;o++){let s=this.local[o];s.from<=n&&s.to>=e&&(!i||i(s.spec))&&r.push(s.copy(s.from+u,s.to+u))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<n&&this.children[o+1]>e){let s=this.children[o]+1;this.children[o+2].findInner(e-s,n-s,r,u+s,i)}}map(e,n,r){return this==J||e.maps.length==0?this:this.mapInner(e,n,0,0,r||Qe)}mapInner(e,n,r,u,i){let o;for(let s=0;s<this.local.length;s++){let l=this.local[s].map(e,r,u);l&&l.type.valid(n,l)?(o||(o=[])).push(l):i.onRemove&&i.onRemove(this.local[s].spec)}return this.children.length?Kc(this.children,o||[],e,n,r,u,i):o?new B(o.sort(Ye),ct):J}add(e,n){return n.length?this==J?B.create(e,n):this.addInner(e,n,0):this}addInner(e,n,r){let u,i=0;e.forEach((s,l)=>{let a=l+r,c;if(c=ks(n,s,a)){for(u||(u=this.children.slice());i<u.length&&u[i]<l;)i+=3;u[i]==l?u[i+2]=u[i+2].addInner(s,c,a+1):u.splice(i,0,l,l+s.nodeSize,On(c,s,a+1,Qe)),i+=3}});let o=ys(i?Cs(n):n,-r);for(let s=0;s<o.length;s++)o[s].type.valid(e,o[s])||o.splice(s--,1);return new B(o.length?this.local.concat(o).sort(Ye):this.local,u||this.children)}remove(e){return e.length==0||this==J?this:this.removeInner(e,0)}removeInner(e,n){let r=this.children,u=this.local;for(let i=0;i<r.length;i+=3){let o,s=r[i]+n,l=r[i+1]+n;for(let c=0,f;c<e.length;c++)(f=e[c])&&f.from>s&&f.to<l&&(e[c]=null,(o||(o=[])).push(f));if(!o)continue;r==this.children&&(r=this.children.slice());let a=r[i+2].removeInner(o,s+1);a!=J?r[i+2]=a:(r.splice(i,3),i-=3)}if(u.length){for(let i=0,o;i<e.length;i++)if(o=e[i])for(let s=0;s<u.length;s++)u[s].eq(o,n)&&(u==this.local&&(u=this.local.slice()),u.splice(s--,1))}return r==this.children&&u==this.local?this:u.length||r.length?new B(u,r):J}forChild(e,n){if(this==J)return this;if(n.isLeaf)return B.empty;let r,u;for(let s=0;s<this.children.length;s+=3)if(this.children[s]>=e){this.children[s]==e&&(r=this.children[s+2]);break}let i=e+1,o=i+n.content.size;for(let s=0;s<this.local.length;s++){let l=this.local[s];if(l.from<o&&l.to>i&&l.type instanceof qe){let a=Math.max(i,l.from)-i,c=Math.min(o,l.to)-i;a<c&&(u||(u=[])).push(l.copy(a,c))}}if(u){let s=new B(u.sort(Ye),ct);return r?new Ne([s,r]):s}return r||J}eq(e){if(this==e)return!0;if(!(e instanceof B)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0}locals(e){return du(this.localsInner(e))}localsInner(e){if(this==J)return ct;if(e.inlineContent||!this.local.some(qe.is))return this.local;let n=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof qe||n.push(this.local[r]);return n}forEachSet(e){e(this)}}B.empty=new B([],[]);B.removeOverlap=du;const J=B.empty;class Ne{constructor(e){this.members=e}map(e,n){const r=this.members.map(u=>u.map(e,n,Qe));return Ne.from(r)}forChild(e,n){if(n.isLeaf)return B.empty;let r=[];for(let u=0;u<this.members.length;u++){let i=this.members[u].forChild(e,n);i!=J&&(i instanceof Ne?r=r.concat(i.members):r.push(i))}return Ne.from(r)}eq(e){if(!(e instanceof Ne)||e.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}locals(e){let n,r=!0;for(let u=0;u<this.members.length;u++){let i=this.members[u].localsInner(e);if(i.length)if(!n)n=i;else{r&&(n=n.slice(),r=!1);for(let o=0;o<i.length;o++)n.push(i[o])}}return n?du(r?n:n.sort(Ye)):ct}static from(e){switch(e.length){case 0:return J;case 1:return e[0];default:return new Ne(e.every(n=>n instanceof B)?e:e.reduce((n,r)=>n.concat(r instanceof B?r:r.members),[]))}}forEachSet(e){for(let n=0;n<this.members.length;n++)this.members[n].forEachSet(e)}}function Kc(t,e,n,r,u,i,o){let s=t.slice();for(let a=0,c=i;a<n.maps.length;a++){let f=0;n.maps[a].forEach((d,p,h,m)=>{let g=m-h-(p-d);for(let b=0;b<s.length;b+=3){let y=s[b+1];if(y<0||d>y+c-f)continue;let C=s[b]+c-f;p>=C?s[b+1]=d<=C?-2:-1:d>=c&&g&&(s[b]+=g,s[b+1]+=g)}f+=g}),c=n.maps[a].map(c,-1)}let l=!1;for(let a=0;a<s.length;a+=3)if(s[a+1]<0){if(s[a+1]==-2){l=!0,s[a+1]=-1;continue}let c=n.map(t[a]+i),f=c-u;if(f<0||f>=r.content.size){l=!0;continue}let d=n.map(t[a+1]+i,-1),p=d-u,{index:h,offset:m}=r.content.findIndex(f),g=r.maybeChild(h);if(g&&m==f&&m+g.nodeSize==p){let b=s[a+2].mapInner(n,g,c+1,t[a]+i+1,o);b!=J?(s[a]=f,s[a+1]=p,s[a+2]=b):(s[a+1]=-2,l=!0)}else l=!0}if(l){let a=Gc(s,t,e,n,u,i,o),c=On(a,r,0,o);e=c.local;for(let f=0;f<s.length;f+=3)s[f+1]<0&&(s.splice(f,3),f-=3);for(let f=0,d=0;f<c.children.length;f+=3){let p=c.children[f];for(;d<s.length&&s[d]<p;)d+=3;s.splice(d,0,c.children[f],c.children[f+1],c.children[f+2])}}return new B(e.sort(Ye),s)}function ys(t,e){if(!e||!t.length)return t;let n=[];for(let r=0;r<t.length;r++){let u=t[r];n.push(new le(u.from+e,u.to+e,u.type))}return n}function Gc(t,e,n,r,u,i,o){function s(l,a){for(let c=0;c<l.local.length;c++){let f=l.local[c].map(r,u,a);f?n.push(f):o.onRemove&&o.onRemove(l.local[c].spec)}for(let c=0;c<l.children.length;c+=3)s(l.children[c+2],l.children[c]+a+1)}for(let l=0;l<t.length;l+=3)t[l+1]==-1&&s(t[l+2],e[l]+i+1);return n}function ks(t,e,n){if(e.isLeaf)return null;let r=n+e.nodeSize,u=null;for(let i=0,o;i<t.length;i++)(o=t[i])&&o.from>n&&o.to<r&&((u||(u=[])).push(o),t[i]=null);return u}function Cs(t){let e=[];for(let n=0;n<t.length;n++)t[n]!=null&&e.push(t[n]);return e}function On(t,e,n,r){let u=[],i=!1;e.forEach((s,l)=>{let a=ks(t,s,l+n);if(a){i=!0;let c=On(a,s,n+l+1,r);c!=J&&u.push(l,l+s.nodeSize,c)}});let o=ys(i?Cs(t):t,-n).sort(Ye);for(let s=0;s<o.length;s++)o[s].type.valid(e,o[s])||(r.onRemove&&r.onRemove(o[s].spec),o.splice(s--,1));return o.length||u.length?new B(o,u):J}function Ye(t,e){return t.from-e.from||t.to-e.to}function du(t){let e=t;for(let n=0;n<e.length-1;n++){let r=e[n];if(r.from!=r.to)for(let u=n+1;u<e.length;u++){let i=e[u];if(i.from==r.from){i.to!=r.to&&(e==t&&(e=t.slice()),e[u]=i.copy(i.from,r.to),yi(e,u+1,i.copy(r.to,i.to)));continue}else{i.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,i.from),yi(e,u,r.copy(i.from,r.to)));break}}}return e}function yi(t,e,n){for(;e<t.length&&Ye(n,t[e])>0;)e++;t.splice(e,0,n)}function lr(t){let e=[];return t.someProp("decorations",n=>{let r=n(t.state);r&&r!=J&&e.push(r)}),t.cursorWrapper&&e.push(B.create(t.state.doc,[t.cursorWrapper.deco])),Ne.from(e)}const Zc={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},Qc=ee&&Pe<=11;class Yc{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class Xc{constructor(e,n){this.view=e,this.handleDOMChange=n,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new Yc,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(r=>{for(let u=0;u<r.length;u++)this.queue.push(r[u]);ee&&Pe<=11&&r.some(u=>u.type=="childList"&&u.removedNodes.length||u.type=="characterData"&&u.oldValue.length>u.target.nodeValue.length)?this.flushSoon():this.flush()}),Qc&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,Zc)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let n=0;n<e.length;n++)this.queue.push(e[n]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(fi(this.view)){if(this.suppressingSelectionUpdates)return Ae(this.view);if(ee&&Pe<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&nt(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let n=new Set,r;for(let i=e.focusNode;i;i=xt(i))n.add(i);for(let i=e.anchorNode;i;i=xt(i))if(n.has(i)){r=i;break}let u=r&&this.view.docView.nearestDesc(r);if(u&&u.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let n=this.pendingRecords();n.length&&(this.queue=[]);let r=e.domSelectionRange(),u=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&fi(e)&&!this.ignoreSelectionChange(r),i=-1,o=-1,s=!1,l=[];if(e.editable)for(let c=0;c<n.length;c++){let f=this.registerMutation(n[c],l);f&&(i=i<0?f.from:Math.min(f.from,i),o=o<0?f.to:Math.max(f.to,o),f.typeOver&&(s=!0))}if(he&&l.length){let c=l.filter(f=>f.nodeName=="BR");if(c.length==2){let[f,d]=c;f.parentNode&&f.parentNode.parentNode==d.parentNode?d.remove():f.remove()}else{let{focusNode:f}=this.currentSelection;for(let d of c){let p=d.parentNode;p&&p.nodeName=="LI"&&(!f||nf(e,f)!=p)&&d.remove()}}}let a=null;i<0&&u&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&Vn(r)&&(a=iu(e))&&a.eq(A.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,Ae(e),this.currentSelection.set(r),e.scrollToSelection()):(i>-1||u)&&(i>-1&&(e.docView.markDirty(i,o),ef(e)),this.handleDOMChange(i,o,s,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(r)||Ae(e),this.currentSelection.set(r))}registerMutation(e,n){if(n.indexOf(e.target)>-1)return null;let r=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(r==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!r||r.ignoreMutation(e))return null;if(e.type=="childList"){for(let c=0;c<e.addedNodes.length;c++){let f=e.addedNodes[c];n.push(f),f.nodeType==3&&(this.lastChangedTextNode=f)}if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(e.target))return{from:r.posBefore,to:r.posAfter};let u=e.previousSibling,i=e.nextSibling;if(ee&&Pe<=11&&e.addedNodes.length)for(let c=0;c<e.addedNodes.length;c++){let{previousSibling:f,nextSibling:d}=e.addedNodes[c];(!f||Array.prototype.indexOf.call(e.addedNodes,f)<0)&&(u=f),(!d||Array.prototype.indexOf.call(e.addedNodes,d)<0)&&(i=d)}let o=u&&u.parentNode==e.target?$(u)+1:0,s=r.localPosFromDOM(e.target,o,-1),l=i&&i.parentNode==e.target?$(i):e.target.childNodes.length,a=r.localPosFromDOM(e.target,l,1);return{from:s,to:a}}else return e.type=="attributes"?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:(this.lastChangedTextNode=e.target,{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let ki=new WeakMap,Ci=!1;function ef(t){if(!ki.has(t)&&(ki.set(t,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)!==-1)){if(t.requiresGeckoHackNode=he,Ci)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),Ci=!0}}function Di(t,e){let n=e.startContainer,r=e.startOffset,u=e.endContainer,i=e.endOffset,o=t.domAtPos(t.state.selection.anchor);return nt(o.node,o.offset,u,i)&&([n,r,u,i]=[u,i,n,r]),{anchorNode:n,anchorOffset:r,focusNode:u,focusOffset:i}}function tf(t,e){if(e.getComposedRanges){let u=e.getComposedRanges(t.root)[0];if(u)return Di(t,u)}let n;function r(u){u.preventDefault(),u.stopImmediatePropagation(),n=u.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",r,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",r,!0),n?Di(t,n):null}function nf(t,e){for(let n=e.parentNode;n&&n!=t.dom;n=n.parentNode){let r=t.docView.nearestDesc(n,!0);if(r&&r.node.isBlock)return n}return null}function rf(t,e,n){let{node:r,fromOffset:u,toOffset:i,from:o,to:s}=t.docView.parseRange(e,n),l=t.domSelectionRange(),a,c=l.anchorNode;if(c&&t.dom.contains(c.nodeType==1?c:c.parentNode)&&(a=[{node:c,offset:l.anchorOffset}],Vn(l)||a.push({node:l.focusNode,offset:l.focusOffset})),U&&t.input.lastKeyCode===8)for(let g=i;g>u;g--){let b=r.childNodes[g-1],y=b.pmViewDesc;if(b.nodeName=="BR"&&!y){i=g;break}if(!y||y.size)break}let f=t.state.doc,d=t.someProp("domParser")||Vt.fromSchema(t.state.schema),p=f.resolve(o),h=null,m=d.parse(r,{topNode:p.parent,topMatch:p.parent.contentMatchAt(p.index()),topOpen:!0,from:u,to:i,preserveWhitespace:p.parent.type.whitespace=="pre"?"full":!0,findPositions:a,ruleFromNode:uf,context:p});if(a&&a[0].pos!=null){let g=a[0].pos,b=a[1]&&a[1].pos;b==null&&(b=g),h={anchor:g+o,head:b+o}}return{doc:m,sel:h,from:o,to:s}}function uf(t){let e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(G&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}else if(t.parentNode.lastChild==t||G&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}const of=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function sf(t,e,n,r,u){let i=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){let _=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,O=iu(t,_);if(O&&!t.state.selection.eq(O)){if(U&&Se&&t.input.lastKeyCode===13&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",St=>St(t,Je(13,"Enter"))))return;let I=t.state.tr.setSelection(O);_=="pointer"?I.setMeta("pointer",!0):_=="key"&&I.scrollIntoView(),i&&I.setMeta("composition",i),t.dispatch(I)}return}let o=t.state.doc.resolve(e),s=o.sharedDepth(n);e=o.before(s+1),n=t.state.doc.resolve(n).after(s+1);let l=t.state.selection,a=rf(t,e,n),c=t.state.doc,f=c.slice(a.from,a.to),d,p;t.input.lastKeyCode===8&&Date.now()-100<t.input.lastKeyCodeTime?(d=t.state.selection.to,p="end"):(d=t.state.selection.from,p="start"),t.input.lastKeyCode=null;let h=cf(f.content,a.doc.content,a.from,d,p);if(h&&t.input.domChangeCount++,(yt&&t.input.lastIOSEnter>Date.now()-225||Se)&&u.some(_=>_.nodeType==1&&!of.test(_.nodeName))&&(!h||h.endA>=h.endB)&&t.someProp("handleKeyDown",_=>_(t,Je(13,"Enter")))){t.input.lastIOSEnter=0;return}if(!h)if(r&&l instanceof T&&!l.empty&&l.$head.sameParent(l.$anchor)&&!t.composing&&!(a.sel&&a.sel.anchor!=a.sel.head))h={start:l.from,endA:l.to,endB:l.to};else{if(a.sel){let _=wi(t,t.state.doc,a.sel);if(_&&!_.eq(t.state.selection)){let O=t.state.tr.setSelection(_);i&&O.setMeta("composition",i),t.dispatch(O)}}return}t.state.selection.from<t.state.selection.to&&h.start==h.endB&&t.state.selection instanceof T&&(h.start>t.state.selection.from&&h.start<=t.state.selection.from+2&&t.state.selection.from>=a.from?h.start=t.state.selection.from:h.endA<t.state.selection.to&&h.endA>=t.state.selection.to-2&&t.state.selection.to<=a.to&&(h.endB+=t.state.selection.to-h.endA,h.endA=t.state.selection.to)),ee&&Pe<=11&&h.endB==h.start+1&&h.endA==h.start&&h.start>a.from&&a.doc.textBetween(h.start-a.from-1,h.start-a.from+1)==" "&&(h.start--,h.endA--,h.endB--);let m=a.doc.resolveNoCache(h.start-a.from),g=a.doc.resolveNoCache(h.endB-a.from),b=c.resolve(h.start),y=m.sameParent(g)&&m.parent.inlineContent&&b.end()>=h.endA,C;if((yt&&t.input.lastIOSEnter>Date.now()-225&&(!y||u.some(_=>_.nodeName=="DIV"||_.nodeName=="P"))||!y&&m.pos<a.doc.content.size&&(!m.sameParent(g)||!m.parent.inlineContent)&&!/\S/.test(a.doc.textBetween(m.pos,g.pos,"",""))&&(C=A.findFrom(a.doc.resolve(m.pos+1),1,!0))&&C.head>m.pos)&&t.someProp("handleKeyDown",_=>_(t,Je(13,"Enter")))){t.input.lastIOSEnter=0;return}if(t.state.selection.anchor>h.start&&af(c,h.start,h.endA,m,g)&&t.someProp("handleKeyDown",_=>_(t,Je(8,"Backspace")))){Se&&U&&t.domObserver.suppressSelectionUpdates();return}U&&h.endB==h.start&&(t.input.lastChromeDelete=Date.now()),Se&&!y&&m.start()!=g.start()&&g.parentOffset==0&&m.depth==g.depth&&a.sel&&a.sel.anchor==a.sel.head&&a.sel.head==h.endA&&(h.endB-=2,g=a.doc.resolveNoCache(h.endB-a.from),setTimeout(()=>{t.someProp("handleKeyDown",function(_){return _(t,Je(13,"Enter"))})},20));let D=h.start,E=h.endA,S=_=>{let O=_||t.state.tr.replace(D,E,a.doc.slice(h.start-a.from,h.endB-a.from));if(a.sel){let I=wi(t,O.doc,a.sel);I&&!(U&&t.composing&&I.empty&&(h.start!=h.endB||t.input.lastChromeDelete<Date.now()-100)&&(I.head==D||I.head==O.mapping.map(E)-1)||ee&&I.empty&&I.head==D)&&O.setSelection(I)}return i&&O.setMeta("composition",i),O.scrollIntoView()},N;if(y){if(m.pos==g.pos){ee&&Pe<=11&&m.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>Ae(t),20));let _=S(t.state.tr.delete(D,E)),O=c.resolve(h.start).marksAcross(c.resolve(h.endA));O&&_.ensureMarks(O),t.dispatch(_)}else if(h.endA==h.endB&&(N=lf(m.parent.content.cut(m.parentOffset,g.parentOffset),b.parent.content.cut(b.parentOffset,h.endA-b.start())))){let _=S(t.state.tr);N.type=="add"?_.addMark(D,E,N.mark):_.removeMark(D,E,N.mark),t.dispatch(_)}else if(m.parent.child(m.index()).isText&&m.index()==g.index()-(g.textOffset?0:1)){let _=m.parent.textBetween(m.parentOffset,g.parentOffset),O=()=>S(t.state.tr.insertText(_,D,E));t.someProp("handleTextInput",I=>I(t,D,E,_,O))||t.dispatch(O())}}else t.dispatch(S())}function wi(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:ou(t,e.resolve(n.anchor),e.resolve(n.head))}function lf(t,e){let n=t.firstChild.marks,r=e.firstChild.marks,u=n,i=r,o,s,l;for(let c=0;c<r.length;c++)u=r[c].removeFromSet(u);for(let c=0;c<n.length;c++)i=n[c].removeFromSet(i);if(u.length==1&&i.length==0)s=u[0],o="add",l=c=>c.mark(s.addToSet(c.marks));else if(u.length==0&&i.length==1)s=i[0],o="remove",l=c=>c.mark(s.removeFromSet(c.marks));else return null;let a=[];for(let c=0;c<e.childCount;c++)a.push(l(e.child(c)));if(x.from(a).eq(t))return{mark:s,type:o}}function af(t,e,n,r,u){if(n-e<=u.pos-r.pos||ar(r,!0,!1)<u.pos)return!1;let i=t.resolve(e);if(!r.parent.isTextblock){let s=i.nodeAfter;return s!=null&&n==e+s.nodeSize}if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;let o=t.resolve(ar(i,!0,!0));return!o.parent.isTextblock||o.pos>n||ar(o,!0,!1)<n?!1:r.parent.content.cut(r.parentOffset).eq(o.parent.content)}function ar(t,e,n){let r=t.depth,u=e?t.end():t.pos;for(;r>0&&(e||t.indexAfter(r)==t.node(r).childCount);)r--,u++,e=!1;if(n){let i=t.node(r).maybeChild(t.indexAfter(r));for(;i&&!i.isLeaf;)i=i.firstChild,u++}return u}function cf(t,e,n,r,u){let i=t.findDiffStart(e,n);if(i==null)return null;let{a:o,b:s}=t.findDiffEnd(e,n+t.size,n+e.size);if(u=="end"){let l=Math.max(0,i-Math.min(o,s));r-=o+l-i}if(o<i&&t.size<e.size){let l=r<=i&&r>=o?i-r:0;i-=l,i&&i<e.size&&Ei(e.textBetween(i-1,i+1))&&(i+=l?1:-1),s=i+(s-o),o=i}else if(s<i){let l=r<=i&&r>=s?i-r:0;i-=l,i&&i<t.size&&Ei(t.textBetween(i-1,i+1))&&(i+=l?1:-1),o=i+(o-s),s=i}return{start:i,endA:o,endB:s}}function Ei(t){if(t.length!=2)return!1;let e=t.charCodeAt(0),n=t.charCodeAt(1);return e>=56320&&e<=57343&&n>=55296&&n<=56319}class Ds{constructor(e,n){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new Mc,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=n,this.state=n.state,this.directPlugins=n.plugins||[],this.directPlugins.forEach(Ti),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=Ai(this),Si(this),this.nodeViews=Mi(this),this.docView=ii(this.state.doc,_i(this),lr(this),this.dom,this),this.domObserver=new Xc(this,(r,u,i,o)=>sf(this,r,u,i,o)),this.domObserver.start(),Tc(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let n in e)this._props[n]=e[n];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&qr(this);let n=this._props;this._props=e,e.plugins&&(e.plugins.forEach(Ti),this.directPlugins=e.plugins),this.updateStateInner(e.state,n)}setProps(e){let n={};for(let r in this._props)n[r]=this._props[r];n.state=this.state;for(let r in e)n[r]=e[r];this.update(n)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,n){var r;let u=this.state,i=!1,o=!1;e.storedMarks&&this.composing&&(ms(this),o=!0),this.state=e;let s=u.plugins!=e.plugins||this._props.plugins!=n.plugins;if(s||this._props.plugins!=n.plugins||this._props.nodeViews!=n.nodeViews){let p=Mi(this);df(p,this.nodeViews)&&(this.nodeViews=p,i=!0)}(s||n.handleDOMEvents!=this._props.handleDOMEvents)&&qr(this),this.editable=Ai(this),Si(this);let l=lr(this),a=_i(this),c=u.plugins!=e.plugins&&!u.doc.eq(e.doc)?"reset":e.scrollToSelection>u.scrollToSelection?"to selection":"preserve",f=i||!this.docView.matchesNode(e.doc,a,l);(f||!e.selection.eq(u.selection))&&(o=!0);let d=c=="preserve"&&o&&this.dom.style.overflowAnchor==null&&Ha(this);if(o){this.domObserver.stop();let p=f&&(ee||U)&&!this.composing&&!u.selection.empty&&!e.selection.empty&&ff(u.selection,e.selection);if(f){let h=U?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=$c(this)),(i||!this.docView.update(e.doc,a,l,this))&&(this.docView.updateOuterDeco(a),this.docView.destroy(),this.docView=ii(e.doc,a,l,this.dom,this)),h&&!this.trackWrites&&(p=!0)}p||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&hc(this))?Ae(this,p):(ns(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(u),!((r=this.dragging)===null||r===void 0)&&r.node&&!u.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,u),c=="reset"?this.dom.scrollTop=0:c=="to selection"?this.scrollToSelection():d&&Wa(d)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",n=>n(this)))if(this.state.selection instanceof w){let n=this.docView.domAfterPos(this.state.selection.from);n.nodeType==1&&Xu(this,n.getBoundingClientRect(),e)}else Xu(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let n=0;n<this.directPlugins.length;n++){let r=this.directPlugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(let n=0;n<this.state.plugins.length;n++){let r=this.state.plugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}}else for(let n=0;n<this.pluginViews.length;n++){let r=this.pluginViews[n];r.update&&r.update(this,e)}}updateDraggedNode(e,n){let r=e.node,u=-1;if(this.state.doc.nodeAt(r.from)==r.node)u=r.from;else{let i=r.from+(this.state.doc.content.size-n.doc.content.size);(i>0&&this.state.doc.nodeAt(i))==r.node&&(u=i)}this.dragging=new bs(e.slice,e.move,u<0?void 0:w.create(this.state.doc,u))}someProp(e,n){let r=this._props&&this._props[e],u;if(r!=null&&(u=n?n(r):r))return u;for(let o=0;o<this.directPlugins.length;o++){let s=this.directPlugins[o].props[e];if(s!=null&&(u=n?n(s):s))return u}let i=this.state.plugins;if(i)for(let o=0;o<i.length;o++){let s=i[o].props[e];if(s!=null&&(u=n?n(s):s))return u}}hasFocus(){if(ee){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&Ja(this.dom),Ae(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let n=this.dom.parentNode;n;n=n.parentNode)if(n.nodeType==9||n.nodeType==11&&n.host)return n.getSelection||(Object.getPrototypeOf(n).getSelection=()=>n.ownerDocument.getSelection()),this._root=n}return e||document}updateRoot(){this._root=null}posAtCoords(e){return Za(this,e)}coordsAtPos(e,n=1){return Ko(this,e,n)}domAtPos(e,n=0){return this.docView.domFromPos(e,n)}nodeDOM(e){let n=this.docView.descAt(e);return n?n.nodeDOM:null}posAtDOM(e,n,r=-1){let u=this.docView.posFromDOM(e,n,r);if(u==null)throw new RangeError("DOM position not inside the editor");return u}endOfTextblock(e,n){return tc(this,n||this.state,e)}pasteHTML(e,n){return jt(this,"",e,!1,n||new ClipboardEvent("paste"))}pasteText(e,n){return jt(this,e,null,!0,n||new ClipboardEvent("paste"))}serializeForClipboard(e){return su(this,e)}destroy(){this.docView&&(Oc(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],lr(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,Na())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return Nc(this,e)}domSelectionRange(){let e=this.domSelection();return e?G&&this.root.nodeType===11&&za(this.dom.ownerDocument)==this.dom&&tf(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}Ds.prototype.dispatch=function(t){let e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))};function _i(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",n=>{if(typeof n=="function"&&(n=n(t.state)),n)for(let r in n)r=="class"?e.class+=" "+n[r]:r=="style"?e.style=(e.style?e.style+";":"")+n[r]:!e[r]&&r!="contenteditable"&&r!="nodeName"&&(e[r]=String(n[r]))}),e.translate||(e.translate="no"),[le.node(0,t.state.doc.content.size,e)]}function Si(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:le.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function Ai(t){return!t.someProp("editable",e=>e(t.state)===!1)}function ff(t,e){let n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}function Mi(t){let e=Object.create(null);function n(r){for(let u in r)Object.prototype.hasOwnProperty.call(e,u)||(e[u]=r[u])}return t.someProp("nodeViews",n),t.someProp("markViews",n),e}function df(t,e){let n=0,r=0;for(let u in t){if(t[u]!=e[u])return!0;n++}for(let u in e)r++;return n!=r}function Ti(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}const Oi={};function hf(t){let e=Oi[t];if(e)return e;e=Oi[t]=[];for(let n=0;n<128;n++){const r=String.fromCharCode(n);e.push(r)}for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);e[r]="%"+("0"+r.toString(16).toUpperCase()).slice(-2)}return e}function kt(t,e){typeof e!="string"&&(e=kt.defaultChars);const n=hf(e);return t.replace(/(%[a-f0-9]{2})+/gi,function(r){let u="";for(let i=0,o=r.length;i<o;i+=3){const s=parseInt(r.slice(i+1,i+3),16);if(s<128){u+=n[s];continue}if((s&224)===192&&i+3<o){const l=parseInt(r.slice(i+4,i+6),16);if((l&192)===128){const a=s<<6&1984|l&63;a<128?u+="":u+=String.fromCharCode(a),i+=3;continue}}if((s&240)===224&&i+6<o){const l=parseInt(r.slice(i+4,i+6),16),a=parseInt(r.slice(i+7,i+9),16);if((l&192)===128&&(a&192)===128){const c=s<<12&61440|l<<6&4032|a&63;c<2048||c>=55296&&c<=57343?u+="":u+=String.fromCharCode(c),i+=6;continue}}if((s&248)===240&&i+9<o){const l=parseInt(r.slice(i+4,i+6),16),a=parseInt(r.slice(i+7,i+9),16),c=parseInt(r.slice(i+10,i+12),16);if((l&192)===128&&(a&192)===128&&(c&192)===128){let f=s<<18&1835008|l<<12&258048|a<<6&4032|c&63;f<65536||f>1114111?u+="":(f-=65536,u+=String.fromCharCode(55296+(f>>10),56320+(f&1023))),i+=9;continue}}u+=""}return u})}kt.defaultChars=";/?:@&=+$,#";kt.componentChars="";const Fi={};function pf(t){let e=Fi[t];if(e)return e;e=Fi[t]=[];for(let n=0;n<128;n++){const r=String.fromCharCode(n);/^[0-9a-z]$/i.test(r)?e.push(r):e.push("%"+("0"+n.toString(16).toUpperCase()).slice(-2))}for(let n=0;n<t.length;n++)e[t.charCodeAt(n)]=t[n];return e}function un(t,e,n){typeof e!="string"&&(n=e,e=un.defaultChars),typeof n>"u"&&(n=!0);const r=pf(e);let u="";for(let i=0,o=t.length;i<o;i++){const s=t.charCodeAt(i);if(n&&s===37&&i+2<o&&/^[0-9a-f]{2}$/i.test(t.slice(i+1,i+3))){u+=t.slice(i,i+3),i+=2;continue}if(s<128){u+=r[s];continue}if(s>=55296&&s<=57343){if(s>=55296&&s<=56319&&i+1<o){const l=t.charCodeAt(i+1);if(l>=56320&&l<=57343){u+=encodeURIComponent(t[i]+t[i+1]),i++;continue}}u+="%EF%BF%BD";continue}u+=encodeURIComponent(t[i])}return u}un.defaultChars=";/?:@&=+$,-_.!~*'()#";un.componentChars="-_.!~*'()";function hu(t){let e="";return e+=t.protocol||"",e+=t.slashes?"//":"",e+=t.auth?t.auth+"@":"",t.hostname&&t.hostname.indexOf(":")!==-1?e+="["+t.hostname+"]":e+=t.hostname||"",e+=t.port?":"+t.port:"",e+=t.pathname||"",e+=t.search||"",e+=t.hash||"",e}function Fn(){this.protocol=null,this.slashes=null,this.auth=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.pathname=null}const mf=/^([a-z0-9.+-]+:)/i,gf=/:[0-9]*$/,bf=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,xf=["<",">",'"',"`"," ","\r",`
`,"	"],yf=["{","}","|","\\","^","`"].concat(xf),kf=["'"].concat(yf),Ni=["%","/","?",";","#"].concat(kf),vi=["/","?","#"],Cf=255,Ii=/^[+a-z0-9A-Z_-]{0,63}$/,Df=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,Ri={javascript:!0,"javascript:":!0},Bi={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function pu(t,e){if(t&&t instanceof Fn)return t;const n=new Fn;return n.parse(t,e),n}Fn.prototype.parse=function(t,e){let n,r,u,i=t;if(i=i.trim(),!e&&t.split("#").length===1){const a=bf.exec(i);if(a)return this.pathname=a[1],a[2]&&(this.search=a[2]),this}let o=mf.exec(i);if(o&&(o=o[0],n=o.toLowerCase(),this.protocol=o,i=i.substr(o.length)),(e||o||i.match(/^\/\/[^@\/]+@[^@\/]+/))&&(u=i.substr(0,2)==="//",u&&!(o&&Ri[o])&&(i=i.substr(2),this.slashes=!0)),!Ri[o]&&(u||o&&!Bi[o])){let a=-1;for(let h=0;h<vi.length;h++)r=i.indexOf(vi[h]),r!==-1&&(a===-1||r<a)&&(a=r);let c,f;a===-1?f=i.lastIndexOf("@"):f=i.lastIndexOf("@",a),f!==-1&&(c=i.slice(0,f),i=i.slice(f+1),this.auth=c),a=-1;for(let h=0;h<Ni.length;h++)r=i.indexOf(Ni[h]),r!==-1&&(a===-1||r<a)&&(a=r);a===-1&&(a=i.length),i[a-1]===":"&&a--;const d=i.slice(0,a);i=i.slice(a),this.parseHost(d),this.hostname=this.hostname||"";const p=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!p){const h=this.hostname.split(/\./);for(let m=0,g=h.length;m<g;m++){const b=h[m];if(b&&!b.match(Ii)){let y="";for(let C=0,D=b.length;C<D;C++)b.charCodeAt(C)>127?y+="x":y+=b[C];if(!y.match(Ii)){const C=h.slice(0,m),D=h.slice(m+1),E=b.match(Df);E&&(C.push(E[1]),D.unshift(E[2])),D.length&&(i=D.join(".")+i),this.hostname=C.join(".");break}}}}this.hostname.length>Cf&&(this.hostname=""),p&&(this.hostname=this.hostname.substr(1,this.hostname.length-2))}const s=i.indexOf("#");s!==-1&&(this.hash=i.substr(s),i=i.slice(0,s));const l=i.indexOf("?");return l!==-1&&(this.search=i.substr(l),i=i.slice(0,l)),i&&(this.pathname=i),Bi[n]&&this.hostname&&!this.pathname&&(this.pathname=""),this};Fn.prototype.parseHost=function(t){let e=gf.exec(t);e&&(e=e[0],e!==":"&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)};const wf=Object.freeze(Object.defineProperty({__proto__:null,decode:kt,encode:un,format:hu,parse:pu},Symbol.toStringTag,{value:"Module"})),ws=/[\0-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,Es=/[\0-\x1F\x7F-\x9F]/,Ef=/[\xAD\u0600-\u0605\u061C\u06DD\u070F\u0890\u0891\u08E2\u180E\u200B-\u200F\u202A-\u202E\u2060-\u2064\u2066-\u206F\uFEFF\uFFF9-\uFFFB]|\uD804[\uDCBD\uDCCD]|\uD80D[\uDC30-\uDC3F]|\uD82F[\uDCA0-\uDCA3]|\uD834[\uDD73-\uDD7A]|\uDB40[\uDC01\uDC20-\uDC7F]/,mu=/[!-#%-\*,-\/:;\?@\[-\]_\{\}\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061D-\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1B7D\u1B7E\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52-\u2E5D\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59\uDF86-\uDF89]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDEB9\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2\uDF00-\uDF09]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDF43-\uDF4F\uDFFF]|\uD809[\uDC70-\uDC74]|\uD80B[\uDFF1\uDFF2]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]/,_s=/[\$\+<->\^`\|~\xA2-\xA6\xA8\xA9\xAC\xAE-\xB1\xB4\xB8\xD7\xF7\u02C2-\u02C5\u02D2-\u02DF\u02E5-\u02EB\u02ED\u02EF-\u02FF\u0375\u0384\u0385\u03F6\u0482\u058D-\u058F\u0606-\u0608\u060B\u060E\u060F\u06DE\u06E9\u06FD\u06FE\u07F6\u07FE\u07FF\u0888\u09F2\u09F3\u09FA\u09FB\u0AF1\u0B70\u0BF3-\u0BFA\u0C7F\u0D4F\u0D79\u0E3F\u0F01-\u0F03\u0F13\u0F15-\u0F17\u0F1A-\u0F1F\u0F34\u0F36\u0F38\u0FBE-\u0FC5\u0FC7-\u0FCC\u0FCE\u0FCF\u0FD5-\u0FD8\u109E\u109F\u1390-\u1399\u166D\u17DB\u1940\u19DE-\u19FF\u1B61-\u1B6A\u1B74-\u1B7C\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u2044\u2052\u207A-\u207C\u208A-\u208C\u20A0-\u20C0\u2100\u2101\u2103-\u2106\u2108\u2109\u2114\u2116-\u2118\u211E-\u2123\u2125\u2127\u2129\u212E\u213A\u213B\u2140-\u2144\u214A-\u214D\u214F\u218A\u218B\u2190-\u2307\u230C-\u2328\u232B-\u2426\u2440-\u244A\u249C-\u24E9\u2500-\u2767\u2794-\u27C4\u27C7-\u27E5\u27F0-\u2982\u2999-\u29D7\u29DC-\u29FB\u29FE-\u2B73\u2B76-\u2B95\u2B97-\u2BFF\u2CE5-\u2CEA\u2E50\u2E51\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFF\u3004\u3012\u3013\u3020\u3036\u3037\u303E\u303F\u309B\u309C\u3190\u3191\u3196-\u319F\u31C0-\u31E3\u31EF\u3200-\u321E\u322A-\u3247\u3250\u3260-\u327F\u328A-\u32B0\u32C0-\u33FF\u4DC0-\u4DFF\uA490-\uA4C6\uA700-\uA716\uA720\uA721\uA789\uA78A\uA828-\uA82B\uA836-\uA839\uAA77-\uAA79\uAB5B\uAB6A\uAB6B\uFB29\uFBB2-\uFBC2\uFD40-\uFD4F\uFDCF\uFDFC-\uFDFF\uFE62\uFE64-\uFE66\uFE69\uFF04\uFF0B\uFF1C-\uFF1E\uFF3E\uFF40\uFF5C\uFF5E\uFFE0-\uFFE6\uFFE8-\uFFEE\uFFFC\uFFFD]|\uD800[\uDD37-\uDD3F\uDD79-\uDD89\uDD8C-\uDD8E\uDD90-\uDD9C\uDDA0\uDDD0-\uDDFC]|\uD802[\uDC77\uDC78\uDEC8]|\uD805\uDF3F|\uD807[\uDFD5-\uDFF1]|\uD81A[\uDF3C-\uDF3F\uDF45]|\uD82F\uDC9C|\uD833[\uDF50-\uDFC3]|\uD834[\uDC00-\uDCF5\uDD00-\uDD26\uDD29-\uDD64\uDD6A-\uDD6C\uDD83\uDD84\uDD8C-\uDDA9\uDDAE-\uDDEA\uDE00-\uDE41\uDE45\uDF00-\uDF56]|\uD835[\uDEC1\uDEDB\uDEFB\uDF15\uDF35\uDF4F\uDF6F\uDF89\uDFA9\uDFC3]|\uD836[\uDC00-\uDDFF\uDE37-\uDE3A\uDE6D-\uDE74\uDE76-\uDE83\uDE85\uDE86]|\uD838[\uDD4F\uDEFF]|\uD83B[\uDCAC\uDCB0\uDD2E\uDEF0\uDEF1]|\uD83C[\uDC00-\uDC2B\uDC30-\uDC93\uDCA0-\uDCAE\uDCB1-\uDCBF\uDCC1-\uDCCF\uDCD1-\uDCF5\uDD0D-\uDDAD\uDDE6-\uDE02\uDE10-\uDE3B\uDE40-\uDE48\uDE50\uDE51\uDE60-\uDE65\uDF00-\uDFFF]|\uD83D[\uDC00-\uDED7\uDEDC-\uDEEC\uDEF0-\uDEFC\uDF00-\uDF76\uDF7B-\uDFD9\uDFE0-\uDFEB\uDFF0]|\uD83E[\uDC00-\uDC0B\uDC10-\uDC47\uDC50-\uDC59\uDC60-\uDC87\uDC90-\uDCAD\uDCB0\uDCB1\uDD00-\uDE53\uDE60-\uDE6D\uDE70-\uDE7C\uDE80-\uDE88\uDE90-\uDEBD\uDEBF-\uDEC5\uDECE-\uDEDB\uDEE0-\uDEE8\uDEF0-\uDEF8\uDF00-\uDF92\uDF94-\uDFCA]/,Ss=/[ \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000]/,_f=Object.freeze(Object.defineProperty({__proto__:null,Any:ws,Cc:Es,Cf:Ef,P:mu,S:_s,Z:Ss},Symbol.toStringTag,{value:"Module"})),Sf=new Uint16Array('<\0\0\0\0\0\0EMabcfglmnoprstu\\bfmsligP&cutereve;iyx}rc;r;ravepha;acr;d;gpon;f;plyFunction;ingcsr;ign;ildemlaceforsucrkslash;;ed;y;crtause;noullis;a;r;pf;eve;cmpeq;HOacdefhilorsucy;PYcpyute;;italDifferentialD;leys;aeioron;dilrc;nint;ot;dnilla;terDot;i;rcleDMPTot;inus;lus;imes;ocskwiseContourIntegral;eCurlyDQoubleQuote;uote;lnpuon;e;gitruent;nt;ourIntegral;fr;oduct;nterClockwiseContourIntegral;oss;cr;p;Cap;DJSZacefios;otrahd;cy;cy;cy;grsger;r;hv;ayron;;l;ta;r;afcmriticalADGTcute;o;bleAcute;rave;ilde;ond;ferentialD;\0\0\0\0f;;DEot;qual;bleCDLRUVontourIntegrao\0\0nArrow;eoftARTrrow;ightArrow;engLReftARrrow;ightArrow;ightArrow;ightATrrow;ee;p\0\0rrow;ownArrow;erticalBar;nABLRTarrow;BUar;pArrow;reve;eft\0\0ightVector;eeVector;ector;Bar;ight\0eeVector;ector;Bar;ee;Arrow;ctr;rok;NTacdfglmopqstuxG;Hcuteaiyron;rc;ot;r;raveement;apcr;ty\0\0mallSquare;erySmallSquare;gpon;f;silon;uail;Tilde;librium;cir;m;a;mlipsts;onentialE;cfiosy;r;lled\0\0mallSquare;erySmallSquare;\0\0\0f;All;riertrf;cJTabcdfgorstcy;>mma;d;reve;eiydil;rc;;ot;r;;pf;eaterEFGLSTqual;Less;ullEqual;reater;ess;lantEqual;ilde;cr;;AacfiosuRDcy;ctek;;irc;r;lbertSpace;\0f;izontalLine;ctrok;mpownHumqual;EJOacdfgmnostucy;lig;cy;cuteiyrc;ot;r;rave;apcgr;inaryI;lie\0;egrral;section;isibleCTomma;imes;gpton;f;a;cr;ilde;\0cy;lcfosuiyrc;;r;pf;\0r;rcy;kcy;HJacfoscy;cy;ppa;eydil;;r;pf;cr;JTaceflmostcy;<cmnprute;bda;g;lacetrf;r;aeyron;dil;;fstACDFRTUVarnrgleBracket;row;BRar;ightArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ightAVrrow;ector;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;ightsEFGLSTqualGreater;ullEqual;reater;ess;lantEqual;ilde;r;;eftarrow;idot;npwgLRlreftARrrow;ightArrow;ightArrow;eftarightightf;erLReftArrow;ightArrow;cht;rok;;acefiosup;y;dliumSpace;lintrf;r;nusPlus;pf;c;Jacefostucy;cute;aeyron;dil;;gswativeMTVediumSpace;hicneryThitedGLreaterGreateessLesLine;r;Bnptreak;BreakingSpace;f;;CDEGHLNPRSTVoungruent;pCap;oubleVerticalBar;lqxement;ual;Tilde;ists;reater;EFGLSTqual;ullEqual;reater;ess;lantEqual;ilde;umpownHump;qual;efstTriangle;BEar;qual;s;EGLSTqual;reater;ess;lantEqual;ilde;estedGLreaterGreater;essLess;recedes;ESqual;lantEqual;eiverseElement;ghtTriangle;BEar;qual;quuareSubpset;Equal;erset;Equal;bcpset;Equal;ceeds;ESTqual;lantEqual;ilde;erset;Equal;ilde;EFTqual;ullEqual;ilde;erticalBar;cr;ilde;Eacdfgmoprstuvlig;cuteiyrc;blac;r;raveaeicr;ga;cron;pf;enCurlyDQoubleQuote;uote;;clr;ashidees;mlerBParr;acek;et;arenthesis;acfhilorsrtialD;y;r;i;;usMinus;ipncareplanf;;eiocedes;ESTqual;lantEqual;ilde;me;dpuct;ortion;al;cir;;UfosOT"r;pf;cr;BEacefhiorsuarr;Gcnrute;g;r;tl;aeyron;dil;;;verseEUlqement;uilibrium;pEquilibrium;ro;ghtACDFTUVanrgleBracket;row;BLar;eftArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;puf;ndImplies;ightarrow;chr;;leDelayed;HOacfhimoqstuCcHcy;y;FTcy;cute;;aeiyron;dil;rc;;r;ortDLRUownArroweftArrowightArrowpArrow;gma;allCircle;pf;\0\0t;are;ISUntersection;ubpset;Equal;erset;Equal;nion;cr;ar;bcmp;set;Equal;cheeds;ESTqual;lantEqual;ilde;Th;;esrset;Equal;etHRSacfhiorsORNADE;Hccy;y;bu;;aeyron;dil;;r;ei\0efore;a;cnkSpace;Space;lde;EFTqual;ullEqual;ilde;pf;ipleDot;ctr;rok;\0\0\0\0\0\0\0cruter;ocir;r\0y;ve;iyrc;blac;r;raveacr;dierBParr;acek;et;arenthesis;on;Plus;gpon;f;ADETadpsrrow;BDar;ownArrow;ownArrow;quilibrium;ee;Arrow;ownerLReftArrow;ightArrow;i;lon;ing;cr;ilde;mlDbcdefosvash;ar;y;ash;l;er;btyar;;icalBLSTar;ine;eparator;ilde;ThinSpace;r;pf;cr;dash;cefosirc;dge;r;pf;cr;fiosr;;pf;cr;AIUacfosucy;cy;cy;cuteiyrc;;r;pf;cr;ml;Hacdefoscy;cute;ayron;;ot;\0oWidta;r;pf;cr;\0\0\0\0\0\0\0cutereve;;Ediuy;;rcte;lig;r;raveepfpsym;ha;apcclr;g;\0\0;adsvnd;;lope;;;elmrsz;esd;a;;;;;;;;t;vb;d;pth;arr;gpon;f;;Eaeiop;cir;;d;s;rox;eingctyr;;mp;eildemlcioninnt;Nabcdefiklnoprsuot;crkcepsong;psilon;rime;im;eq;ee;ed;gerk;tbrk;oy;quo;cmprtaus;eptyv;snoahw;;een;r;gcostuvwaiurc;pdptot;lus;imes;\0\0cup;ar;riangleduown;p;plus;earow;akocnklstozenge;riangle;dlrown;eft;ight;k;\0\0;;4;ck;eo;q=uiv;t;ptwxf;;tomtie;DHUVbdhmptuvLRlr;;;;;DUdu;;;;LRlr;;;;;HLRhlr;;;;;;ox;LRlr;;;;;DUdu;;;;inus;lus;imes;LRlr;;;;;HLRhlr;;;;;;evbarceior;mi;m;el;bh;sub;l;etp;Ee;;q\0\0\0\0\0\0\0\0\0\0cprute;;abcdsnd;rcup;aup;p;ot;;eot;aeiu\0s;on;dilrc;ps;sm;ot;dmnilptyv;t;err;ceiy;ck;mark;r;Ecefms;;elq;e\0\0rrowlreft;ight;RSacd;st;irc;ash;nint;id;cir;ubs;uit\0on;e;q\0\0a;t;;flemxente\0;dot;nfry;o;sr;aorr;ss;cur;bp;e;;e;dot;delprvwarrlr;;\0\0r;c;arr;p;;bcdosrcap;aup;p;ot;r;;alrvrr;m;yevwq\0\0reuee;edge;enearrowlreftightecioninnt;lcty;AHabcdefhijlorstuwzrar;glrsger;eth;h;varow;aayron;;;aogrr;tseq;glmta;ptyv;irsht;;arlraegsvm;osnd;suit;amma;in;;iode;ontimes;ncy;c\0\0rn;op;lptuwlar;f;;empsq;dot;inus;lus;quare;blebarwedgnadhownarrowarpoonlrefighkaro\0\0rn;op;cotry;;l;rok;drot;i;fahraangle;ciy;grarr;DacdefglmnopqrstuxDoocsuteter;aioyron;r;clon;;ot;Drot;;;rsave;dot;;ilsnters;;;dot;apscr;ty;svetp1;;;gs;p;gpon;f;alsr;sl;us;i;lvon;csuviorc\0\0antgltressaeils;st;v;DD;parsl;Daot;rr;cdir;oah;mrlo;cipl;seoctationential\0\0\0\0\0\0\0llingdotsey;male;ilrlig;\0\0g;ig;;lig;lig;fjaltt;ig;ns;of;\0f;ak;v;artint;aocs\0\0;;;;\0;;\0\0;;5;\0;;8;l;wn;cr;Eabcdefgijlnorstv;l;cmpute;ma;d;reve;iyrc;;ot;;lqs;qslan;cdlc;ot;o;l;;es;r;;gmel;cy;;Eaj;;;Eaes;p;prox;q;qim;pf;cir;m;el;;>;cdlqrci;r;ot;Par;uest;adels\0pror;qlqlesienrtneqq;Aabcefkosyrilmrrsfildrcy;;cwir;;ar;irc;alrrts;uitlip;con;r;sewarow;arow;amoprrr;tht;klreftarrow;ightarrow;f;bar;cltr;asrok;bpull;hen\0\0\0\0\0\0cute;iyrc;cxy;clfr;rave;inoinnt;t;fin;ta;lig;aopcgtr;elpinarh;f;ed;;cfotare;in;tie;do;celpal;grerarhk;rod;cgpty;on;f;a;uestcir;n;Edsv;ot;;v;;ilde;\0cy;lcfmosuiyrc;;r;ath;pf;\0r;rcy;kcy;acfghjosppa;v;eydil;;r;reen;cy;cy;pf;cr;ABEHabcdefghjlmnoprstuvartrail;arr;;g;ar;\0\0\0\0\0\0\0\0\0ute;mptyv;rabda;g;dl;;uor;bfhlpst;fs;s;p;l;im;l;;aeil;;s;abrrr;rk;akcek;;es;ldu;;aeuyron;diil;;cqrsa;uo;rduhar;shar;h;;fgqstahlrtrrow;taarpoonduownpeftarrows;ightahsrrow;sarpoonquigarrohreetimes;;qslan;cdgsc;ot;o;r;;es;adegspproot;qgqgtiilrsht;;;E;rdu;l;lk;cy;;achtrorneard;ri;iodot;ust;acheEaes;p;prox;q;qim;abnoptwznrg;r;rglmreftarightapsto;ightparrowlrefight;aflr;;us;imes;st;;efngear;lt;achmtrornear;d;;ri;achiqtquo;r;m;eg;;buo;r;rok;<;cdhilqrci;r;remes;arr;uest;Piar;;efrdushar;har;enrtneqq;DacdefhilnopsuDot;clprret;;ese;sto;dluowefker;oymma;;ash;asuredangler;o;cdnro;acdsir;otus;bd;u;p;dpels;f;ctr;pos;lmtimap;GLRVabcdefghijlmoprstuvwgt;;veltftarrrow;ightarrow;;;vightarrow;Ddash;ash;bcnptlaute;g;;Eiop;d;s;rour;al;s\0pmp;eaeouy\0;on;dil;ng;dot;p;;ash;;Aadqsxrr;rhrk;;oot;uieiar;ist;sr;Eest;qs;qslani;rAaprrr;ar;;sv;d;cy;AEadestr;rr;r;;fqstarrroightarro;qslan;si;ri;eiptf;;inn;Edv;ot;;;i;v;;aorr;astllel;;lint;;ceu;c;eAaitrrr;cw;;ghtarrowri;echimpqu;ceru;ort\0\0arm;e;qsubpbcp;Ees;et;eq;qc;e;Ees;et;eq;qgilrldeianglelreft;eight;e;m;esro;p;DHadgilrsash;arr;p;ash;et;;>nfin;Aetrr;;;r<ie;Atrr;rie;im;Aanrr;rhrk;;oear;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0csuteiyr;c;abioslac;v;old;lig;crir;;\0\0\0n;ave;bmar;acitrirr;oss;n;aeicr;ga;cdnron;;pf;aelr;rp;;adiosvr;efmr;ofgof;r;lope;;cloashl;idees;as;mlbar;\0\0\0\0\0\0\0\0\0r;ast;lle\0\0m;;y;rcimptnt;od;il;enk;r;imo;v;mane;;tvchfork;aunckk;h;s;abcdemstcir;ir;ou;;nim;wo;ipuntint;f;nd;Eaceinosu;p;u;c;acenspprourlyeaespprox;qq;im;ime;sEasdfpalslar;ine;urf;;trel;cir;;ncsp;fiopsur;pf;rime;cr;aeoteirnionnt;st;eABHabcdefhilmnoprstuxartrail;arar;cdenqrteu;te;imptyv;g;del;;uor;abcfhlpstwp;;fs;;s;l;im;l;;aiil;o;nalabrrrk;akcek;;es;ldu;;aeuyron;diil;;clqsa;dhar;uo;rh;acgl;ipsnart;ilrsht;;aordu;l;;v;gnshtahlrstrrow;taarpoonduowpeftahrrowarpoonightarrows;quigarrohreetimes;g;ingdotseahmra;oust;achemid;abptnrg;r;raflr;;us;imes;apr;gt;olint;arachqquo;r;buo;rhirremes;i;efltri;luhar;;\0\0\0\0\0\0\0cute;qu;Eaceinpsy;\0;on;u;dil;rc;Eas;p;im;olint;i;ot;be;Aacmstxrr;rhr;oti;war;minnut;r;oacoyrp;hycy;;rt\0\0iaragmma;fv;;deglnprot;;q;E;;E;e;lus;arr;araeitlslsetmhp;parsl;dle;;e;s;flptcy;;b;ar;f;adres;uitcsuaup;s;p;s;ubp;eset;e;eset;e;afrarcemtr;tmiararr;fanighteppsilohsbcmnp;Edemnprs;ot;;dot;ult;Ee;;lus;arr;eiut;enq;qeq;qm;bp;;c;acenspprourlyeaespproqg;123;Edehlmnps;ost;ub;;dot;soul;b;arr;ult;Ee;;lus;eiut;enq;qeq;qm;bp;;Aanrr;rhr;owar;lig\0\0\0\0\0\0\0\0\0\0\0\0get;;raeyron;dil;;lrec;r;eiko\0e4fa;svym;cnkaspproimsasrnes;bd;ar;;eps;bcfot;ir;;ork;rime;aipdadempstngle;dlqrowneft;e;ight;eot;inus;lus;b;ime;ezium;chtry;;cy;rok;ioxheadlreftarroightarrowAHabcdfghlmoprstuwrar;cruter\0y;ve;iyrc;abhrlac;airsht;;raverlrlk;ct\0\0rn;erop;ri;alcr;gpon;f;adhlsuownarpoonlrefighi;hlonparrows;cit\0\0rn;erop;ng;ri;cr;dirot;lde;i;famrlangle;ABDacdeflnoprszrar;v;asnrgrt;eknprstappothinhirop;hiugmbpsetneq;q;setneq;q;hretianglelreftighty;ashelr;bear;q;lip;btar;trsubppf;rotrcur;bpnEenEeigzag;cefoprsirc;dibgar;e;q;erp;r;pf;;eatcr;\0\0\0\0\0\0\0trr;Aarr;Aarrais;dptfl;imAarrcqr;ptracefiosucuyte;iyrc;;nr;cy;pf;cr;cmy;lacdefhioswcute;ayron;;ot;ettra;r;cy;grarr;pf;cr;jn;j;'.split("").map(t=>t.charCodeAt(0))),Af=new Uint16Array("aglq	\x1B\0\0p;os;t;t;uot;".split("").map(t=>t.charCodeAt(0)));var cr;const Mf=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]),Tf=(cr=String.fromCodePoint)!==null&&cr!==void 0?cr:function(t){let e="";return t>65535&&(t-=65536,e+=String.fromCharCode(t>>>10&1023|55296),t=56320|t&1023),e+=String.fromCharCode(t),e};function Of(t){var e;return t>=55296&&t<=57343||t>1114111?65533:(e=Mf.get(t))!==null&&e!==void 0?e:t}var L;(function(t){t[t.NUM=35]="NUM",t[t.SEMI=59]="SEMI",t[t.EQUALS=61]="EQUALS",t[t.ZERO=48]="ZERO",t[t.NINE=57]="NINE",t[t.LOWER_A=97]="LOWER_A",t[t.LOWER_F=102]="LOWER_F",t[t.LOWER_X=120]="LOWER_X",t[t.LOWER_Z=122]="LOWER_Z",t[t.UPPER_A=65]="UPPER_A",t[t.UPPER_F=70]="UPPER_F",t[t.UPPER_Z=90]="UPPER_Z"})(L||(L={}));const Ff=32;var ze;(function(t){t[t.VALUE_LENGTH=49152]="VALUE_LENGTH",t[t.BRANCH_LENGTH=16256]="BRANCH_LENGTH",t[t.JUMP_TABLE=127]="JUMP_TABLE"})(ze||(ze={}));function Vr(t){return t>=L.ZERO&&t<=L.NINE}function Nf(t){return t>=L.UPPER_A&&t<=L.UPPER_F||t>=L.LOWER_A&&t<=L.LOWER_F}function vf(t){return t>=L.UPPER_A&&t<=L.UPPER_Z||t>=L.LOWER_A&&t<=L.LOWER_Z||Vr(t)}function If(t){return t===L.EQUALS||vf(t)}var P;(function(t){t[t.EntityStart=0]="EntityStart",t[t.NumericStart=1]="NumericStart",t[t.NumericDecimal=2]="NumericDecimal",t[t.NumericHex=3]="NumericHex",t[t.NamedEntity=4]="NamedEntity"})(P||(P={}));var ve;(function(t){t[t.Legacy=0]="Legacy",t[t.Strict=1]="Strict",t[t.Attribute=2]="Attribute"})(ve||(ve={}));class Rf{constructor(e,n,r){this.decodeTree=e,this.emitCodePoint=n,this.errors=r,this.state=P.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=ve.Strict}startEntity(e){this.decodeMode=e,this.state=P.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1}write(e,n){switch(this.state){case P.EntityStart:return e.charCodeAt(n)===L.NUM?(this.state=P.NumericStart,this.consumed+=1,this.stateNumericStart(e,n+1)):(this.state=P.NamedEntity,this.stateNamedEntity(e,n));case P.NumericStart:return this.stateNumericStart(e,n);case P.NumericDecimal:return this.stateNumericDecimal(e,n);case P.NumericHex:return this.stateNumericHex(e,n);case P.NamedEntity:return this.stateNamedEntity(e,n)}}stateNumericStart(e,n){return n>=e.length?-1:(e.charCodeAt(n)|Ff)===L.LOWER_X?(this.state=P.NumericHex,this.consumed+=1,this.stateNumericHex(e,n+1)):(this.state=P.NumericDecimal,this.stateNumericDecimal(e,n))}addToNumericResult(e,n,r,u){if(n!==r){const i=r-n;this.result=this.result*Math.pow(u,i)+parseInt(e.substr(n,i),u),this.consumed+=i}}stateNumericHex(e,n){const r=n;for(;n<e.length;){const u=e.charCodeAt(n);if(Vr(u)||Nf(u))n+=1;else return this.addToNumericResult(e,r,n,16),this.emitNumericEntity(u,3)}return this.addToNumericResult(e,r,n,16),-1}stateNumericDecimal(e,n){const r=n;for(;n<e.length;){const u=e.charCodeAt(n);if(Vr(u))n+=1;else return this.addToNumericResult(e,r,n,10),this.emitNumericEntity(u,2)}return this.addToNumericResult(e,r,n,10),-1}emitNumericEntity(e,n){var r;if(this.consumed<=n)return(r=this.errors)===null||r===void 0||r.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(e===L.SEMI)this.consumed+=1;else if(this.decodeMode===ve.Strict)return 0;return this.emitCodePoint(Of(this.result),this.consumed),this.errors&&(e!==L.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed}stateNamedEntity(e,n){const{decodeTree:r}=this;let u=r[this.treeIndex],i=(u&ze.VALUE_LENGTH)>>14;for(;n<e.length;n++,this.excess++){const o=e.charCodeAt(n);if(this.treeIndex=Bf(r,u,this.treeIndex+Math.max(1,i),o),this.treeIndex<0)return this.result===0||this.decodeMode===ve.Attribute&&(i===0||If(o))?0:this.emitNotTerminatedNamedEntity();if(u=r[this.treeIndex],i=(u&ze.VALUE_LENGTH)>>14,i!==0){if(o===L.SEMI)return this.emitNamedEntityData(this.treeIndex,i,this.consumed+this.excess);this.decodeMode!==ve.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1}emitNotTerminatedNamedEntity(){var e;const{result:n,decodeTree:r}=this,u=(r[n]&ze.VALUE_LENGTH)>>14;return this.emitNamedEntityData(n,u,this.consumed),(e=this.errors)===null||e===void 0||e.missingSemicolonAfterCharacterReference(),this.consumed}emitNamedEntityData(e,n,r){const{decodeTree:u}=this;return this.emitCodePoint(n===1?u[e]&~ze.VALUE_LENGTH:u[e+1],r),n===3&&this.emitCodePoint(u[e+2],r),r}end(){var e;switch(this.state){case P.NamedEntity:return this.result!==0&&(this.decodeMode!==ve.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case P.NumericDecimal:return this.emitNumericEntity(0,2);case P.NumericHex:return this.emitNumericEntity(0,3);case P.NumericStart:return(e=this.errors)===null||e===void 0||e.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case P.EntityStart:return 0}}}function As(t){let e="";const n=new Rf(t,r=>e+=Tf(r));return function(u,i){let o=0,s=0;for(;(s=u.indexOf("&",s))>=0;){e+=u.slice(o,s),n.startEntity(i);const a=n.write(u,s+1);if(a<0){o=s+n.end();break}o=s+a,s=a===0?o+1:o}const l=e+u.slice(o);return e="",l}}function Bf(t,e,n,r){const u=(e&ze.BRANCH_LENGTH)>>7,i=e&ze.JUMP_TABLE;if(u===0)return i!==0&&r===i?n:-1;if(i){const l=r-i;return l<0||l>=u?-1:t[n+l]-1}let o=n,s=o+u-1;for(;o<=s;){const l=o+s>>>1,a=t[l];if(a<r)o=l+1;else if(a>r)s=l-1;else return t[l+u]}return-1}const zf=As(Sf);As(Af);function Ms(t,e=ve.Legacy){return zf(t,e)}function Pf(t){return Object.prototype.toString.call(t)}function gu(t){return Pf(t)==="[object String]"}const Lf=Object.prototype.hasOwnProperty;function qf(t,e){return Lf.call(t,e)}function Wn(t){return Array.prototype.slice.call(arguments,1).forEach(function(n){if(n){if(typeof n!="object")throw new TypeError(n+"must be object");Object.keys(n).forEach(function(r){t[r]=n[r]})}}),t}function Ts(t,e,n){return[].concat(t.slice(0,e),n,t.slice(e+1))}function bu(t){return!(t>=55296&&t<=57343||t>=64976&&t<=65007||(t&65535)===65535||(t&65535)===65534||t>=0&&t<=8||t===11||t>=14&&t<=31||t>=127&&t<=159||t>1114111)}function Nn(t){if(t>65535){t-=65536;const e=55296+(t>>10),n=56320+(t&1023);return String.fromCharCode(e,n)}return String.fromCharCode(t)}const Os=/\\([!"#$%&'()*+,\-./:;<=>?@[\\\]^_`{|}~])/g,Vf=/&([a-z#][a-z0-9]{1,31});/gi,$f=new RegExp(Os.source+"|"+Vf.source,"gi"),Hf=/^#((?:x[a-f0-9]{1,8}|[0-9]{1,8}))$/i;function Wf(t,e){if(e.charCodeAt(0)===35&&Hf.test(e)){const r=e[1].toLowerCase()==="x"?parseInt(e.slice(2),16):parseInt(e.slice(1),10);return bu(r)?Nn(r):t}const n=Ms(t);return n!==t?n:t}function Jf(t){return t.indexOf("\\")<0?t:t.replace(Os,"$1")}function Ct(t){return t.indexOf("\\")<0&&t.indexOf("&")<0?t:t.replace($f,function(e,n,r){return n||Wf(e,r)})}const jf=/[&<>"]/,Uf=/[&<>"]/g,Kf={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};function Gf(t){return Kf[t]}function Ve(t){return jf.test(t)?t.replace(Uf,Gf):t}const Zf=/[.?*+^$[\]\\(){}|-]/g;function Qf(t){return t.replace(Zf,"\\$&")}function F(t){switch(t){case 9:case 32:return!0}return!1}function Kt(t){if(t>=8192&&t<=8202)return!0;switch(t){case 9:case 10:case 11:case 12:case 13:case 32:case 160:case 5760:case 8239:case 8287:case 12288:return!0}return!1}function Gt(t){return mu.test(t)||_s.test(t)}function Zt(t){switch(t){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 58:case 59:case 60:case 61:case 62:case 63:case 64:case 91:case 92:case 93:case 94:case 95:case 96:case 123:case 124:case 125:case 126:return!0;default:return!1}}function Jn(t){return t=t.trim().replace(/\s+/g," "),"".toLowerCase()===""&&(t=t.replace(//g,"")),t.toLowerCase().toUpperCase()}const Yf={mdurl:wf,ucmicro:_f},Xf=Object.freeze(Object.defineProperty({__proto__:null,arrayReplaceAt:Ts,assign:Wn,escapeHtml:Ve,escapeRE:Qf,fromCodePoint:Nn,has:qf,isMdAsciiPunct:Zt,isPunctChar:Gt,isSpace:F,isString:gu,isValidEntityCode:bu,isWhiteSpace:Kt,lib:Yf,normalizeReference:Jn,unescapeAll:Ct,unescapeMd:Jf},Symbol.toStringTag,{value:"Module"}));function e0(t,e,n){let r,u,i,o;const s=t.posMax,l=t.pos;for(t.pos=e+1,r=1;t.pos<s;){if(i=t.src.charCodeAt(t.pos),i===93&&(r--,r===0)){u=!0;break}if(o=t.pos,t.md.inline.skipToken(t),i===91){if(o===t.pos-1)r++;else if(n)return t.pos=l,-1}}let a=-1;return u&&(a=t.pos),t.pos=l,a}function t0(t,e,n){let r,u=e;const i={ok:!1,pos:0,str:""};if(t.charCodeAt(u)===60){for(u++;u<n;){if(r=t.charCodeAt(u),r===10||r===60)return i;if(r===62)return i.pos=u+1,i.str=Ct(t.slice(e+1,u)),i.ok=!0,i;if(r===92&&u+1<n){u+=2;continue}u++}return i}let o=0;for(;u<n&&(r=t.charCodeAt(u),!(r===32||r<32||r===127));){if(r===92&&u+1<n){if(t.charCodeAt(u+1)===32)break;u+=2;continue}if(r===40&&(o++,o>32))return i;if(r===41){if(o===0)break;o--}u++}return e===u||o!==0||(i.str=Ct(t.slice(e,u)),i.pos=u,i.ok=!0),i}function n0(t,e,n,r){let u,i=e;const o={ok:!1,can_continue:!1,pos:0,str:"",marker:0};if(r)o.str=r.str,o.marker=r.marker;else{if(i>=n)return o;let s=t.charCodeAt(i);if(s!==34&&s!==39&&s!==40)return o;e++,i++,s===40&&(s=41),o.marker=s}for(;i<n;){if(u=t.charCodeAt(i),u===o.marker)return o.pos=i+1,o.str+=Ct(t.slice(e,i)),o.ok=!0,o;if(u===40&&o.marker===41)return o;u===92&&i+1<n&&i++,i++}return o.can_continue=!0,o.str+=Ct(t.slice(e,i)),o}const r0=Object.freeze(Object.defineProperty({__proto__:null,parseLinkDestination:t0,parseLinkLabel:e0,parseLinkTitle:n0},Symbol.toStringTag,{value:"Module"})),Ce={};Ce.code_inline=function(t,e,n,r,u){const i=t[e];return"<code"+u.renderAttrs(i)+">"+Ve(i.content)+"</code>"};Ce.code_block=function(t,e,n,r,u){const i=t[e];return"<pre"+u.renderAttrs(i)+"><code>"+Ve(t[e].content)+`</code></pre>
`};Ce.fence=function(t,e,n,r,u){const i=t[e],o=i.info?Ct(i.info).trim():"";let s="",l="";if(o){const c=o.split(/(\s+)/g);s=c[0],l=c.slice(2).join("")}let a;if(n.highlight?a=n.highlight(i.content,s,l)||Ve(i.content):a=Ve(i.content),a.indexOf("<pre")===0)return a+`
`;if(o){const c=i.attrIndex("class"),f=i.attrs?i.attrs.slice():[];c<0?f.push(["class",n.langPrefix+s]):(f[c]=f[c].slice(),f[c][1]+=" "+n.langPrefix+s);const d={attrs:f};return`<pre><code${u.renderAttrs(d)}>${a}</code></pre>
`}return`<pre><code${u.renderAttrs(i)}>${a}</code></pre>
`};Ce.image=function(t,e,n,r,u){const i=t[e];return i.attrs[i.attrIndex("alt")][1]=u.renderInlineAsText(i.children,n,r),u.renderToken(t,e,n)};Ce.hardbreak=function(t,e,n){return n.xhtmlOut?`<br />
`:`<br>
`};Ce.softbreak=function(t,e,n){return n.breaks?n.xhtmlOut?`<br />
`:`<br>
`:`
`};Ce.text=function(t,e){return Ve(t[e].content)};Ce.html_block=function(t,e){return t[e].content};Ce.html_inline=function(t,e){return t[e].content};function _t(){this.rules=Wn({},Ce)}_t.prototype.renderAttrs=function(e){let n,r,u;if(!e.attrs)return"";for(u="",n=0,r=e.attrs.length;n<r;n++)u+=" "+Ve(e.attrs[n][0])+'="'+Ve(e.attrs[n][1])+'"';return u};_t.prototype.renderToken=function(e,n,r){const u=e[n];let i="";if(u.hidden)return"";u.block&&u.nesting!==-1&&n&&e[n-1].hidden&&(i+=`
`),i+=(u.nesting===-1?"</":"<")+u.tag,i+=this.renderAttrs(u),u.nesting===0&&r.xhtmlOut&&(i+=" /");let o=!1;if(u.block&&(o=!0,u.nesting===1&&n+1<e.length)){const s=e[n+1];(s.type==="inline"||s.hidden||s.nesting===-1&&s.tag===u.tag)&&(o=!1)}return i+=o?`>
`:">",i};_t.prototype.renderInline=function(t,e,n){let r="";const u=this.rules;for(let i=0,o=t.length;i<o;i++){const s=t[i].type;typeof u[s]<"u"?r+=u[s](t,i,e,n,this):r+=this.renderToken(t,i,e)}return r};_t.prototype.renderInlineAsText=function(t,e,n){let r="";for(let u=0,i=t.length;u<i;u++)switch(t[u].type){case"text":r+=t[u].content;break;case"image":r+=this.renderInlineAsText(t[u].children,e,n);break;case"html_inline":case"html_block":r+=t[u].content;break;case"softbreak":case"hardbreak":r+=`
`;break}return r};_t.prototype.render=function(t,e,n){let r="";const u=this.rules;for(let i=0,o=t.length;i<o;i++){const s=t[i].type;s==="inline"?r+=this.renderInline(t[i].children,e,n):typeof u[s]<"u"?r+=u[s](t,i,e,n,this):r+=this.renderToken(t,i,e,n)}return r};function te(){this.__rules__=[],this.__cache__=null}te.prototype.__find__=function(t){for(let e=0;e<this.__rules__.length;e++)if(this.__rules__[e].name===t)return e;return-1};te.prototype.__compile__=function(){const t=this,e=[""];t.__rules__.forEach(function(n){n.enabled&&n.alt.forEach(function(r){e.indexOf(r)<0&&e.push(r)})}),t.__cache__={},e.forEach(function(n){t.__cache__[n]=[],t.__rules__.forEach(function(r){r.enabled&&(n&&r.alt.indexOf(n)<0||t.__cache__[n].push(r.fn))})})};te.prototype.at=function(t,e,n){const r=this.__find__(t),u=n||{};if(r===-1)throw new Error("Parser rule not found: "+t);this.__rules__[r].fn=e,this.__rules__[r].alt=u.alt||[],this.__cache__=null};te.prototype.before=function(t,e,n,r){const u=this.__find__(t),i=r||{};if(u===-1)throw new Error("Parser rule not found: "+t);this.__rules__.splice(u,0,{name:e,enabled:!0,fn:n,alt:i.alt||[]}),this.__cache__=null};te.prototype.after=function(t,e,n,r){const u=this.__find__(t),i=r||{};if(u===-1)throw new Error("Parser rule not found: "+t);this.__rules__.splice(u+1,0,{name:e,enabled:!0,fn:n,alt:i.alt||[]}),this.__cache__=null};te.prototype.push=function(t,e,n){const r=n||{};this.__rules__.push({name:t,enabled:!0,fn:e,alt:r.alt||[]}),this.__cache__=null};te.prototype.enable=function(t,e){Array.isArray(t)||(t=[t]);const n=[];return t.forEach(function(r){const u=this.__find__(r);if(u<0){if(e)return;throw new Error("Rules manager: invalid rule name "+r)}this.__rules__[u].enabled=!0,n.push(r)},this),this.__cache__=null,n};te.prototype.enableOnly=function(t,e){Array.isArray(t)||(t=[t]),this.__rules__.forEach(function(n){n.enabled=!1}),this.enable(t,e)};te.prototype.disable=function(t,e){Array.isArray(t)||(t=[t]);const n=[];return t.forEach(function(r){const u=this.__find__(r);if(u<0){if(e)return;throw new Error("Rules manager: invalid rule name "+r)}this.__rules__[u].enabled=!1,n.push(r)},this),this.__cache__=null,n};te.prototype.getRules=function(t){return this.__cache__===null&&this.__compile__(),this.__cache__[t]||[]};function pe(t,e,n){this.type=t,this.tag=e,this.attrs=null,this.map=null,this.nesting=n,this.level=0,this.children=null,this.content="",this.markup="",this.info="",this.meta=null,this.block=!1,this.hidden=!1}pe.prototype.attrIndex=function(e){if(!this.attrs)return-1;const n=this.attrs;for(let r=0,u=n.length;r<u;r++)if(n[r][0]===e)return r;return-1};pe.prototype.attrPush=function(e){this.attrs?this.attrs.push(e):this.attrs=[e]};pe.prototype.attrSet=function(e,n){const r=this.attrIndex(e),u=[e,n];r<0?this.attrPush(u):this.attrs[r]=u};pe.prototype.attrGet=function(e){const n=this.attrIndex(e);let r=null;return n>=0&&(r=this.attrs[n][1]),r};pe.prototype.attrJoin=function(e,n){const r=this.attrIndex(e);r<0?this.attrPush([e,n]):this.attrs[r][1]=this.attrs[r][1]+" "+n};function Fs(t,e,n){this.src=t,this.env=n,this.tokens=[],this.inlineMode=!1,this.md=e}Fs.prototype.Token=pe;const u0=/\r\n?|\n/g,i0=/\0/g;function o0(t){let e;e=t.src.replace(u0,`
`),e=e.replace(i0,""),t.src=e}function s0(t){let e;t.inlineMode?(e=new t.Token("inline","",0),e.content=t.src,e.map=[0,1],e.children=[],t.tokens.push(e)):t.md.block.parse(t.src,t.md,t.env,t.tokens)}function l0(t){const e=t.tokens;for(let n=0,r=e.length;n<r;n++){const u=e[n];u.type==="inline"&&t.md.inline.parse(u.content,t.md,t.env,u.children)}}function a0(t){return/^<a[>\s]/i.test(t)}function c0(t){return/^<\/a\s*>/i.test(t)}function f0(t){const e=t.tokens;if(t.md.options.linkify)for(let n=0,r=e.length;n<r;n++){if(e[n].type!=="inline"||!t.md.linkify.pretest(e[n].content))continue;let u=e[n].children,i=0;for(let o=u.length-1;o>=0;o--){const s=u[o];if(s.type==="link_close"){for(o--;u[o].level!==s.level&&u[o].type!=="link_open";)o--;continue}if(s.type==="html_inline"&&(a0(s.content)&&i>0&&i--,c0(s.content)&&i++),!(i>0)&&s.type==="text"&&t.md.linkify.test(s.content)){const l=s.content;let a=t.md.linkify.match(l);const c=[];let f=s.level,d=0;a.length>0&&a[0].index===0&&o>0&&u[o-1].type==="text_special"&&(a=a.slice(1));for(let p=0;p<a.length;p++){const h=a[p].url,m=t.md.normalizeLink(h);if(!t.md.validateLink(m))continue;let g=a[p].text;a[p].schema?a[p].schema==="mailto:"&&!/^mailto:/i.test(g)?g=t.md.normalizeLinkText("mailto:"+g).replace(/^mailto:/,""):g=t.md.normalizeLinkText(g):g=t.md.normalizeLinkText("http://"+g).replace(/^http:\/\//,"");const b=a[p].index;if(b>d){const E=new t.Token("text","",0);E.content=l.slice(d,b),E.level=f,c.push(E)}const y=new t.Token("link_open","a",1);y.attrs=[["href",m]],y.level=f++,y.markup="linkify",y.info="auto",c.push(y);const C=new t.Token("text","",0);C.content=g,C.level=f,c.push(C);const D=new t.Token("link_close","a",-1);D.level=--f,D.markup="linkify",D.info="auto",c.push(D),d=a[p].lastIndex}if(d<l.length){const p=new t.Token("text","",0);p.content=l.slice(d),p.level=f,c.push(p)}e[n].children=u=Ts(u,o,c)}}}}const Ns=/\+-|\.\.|\?\?\?\?|!!!!|,,|--/,d0=/\((c|tm|r)\)/i,h0=/\((c|tm|r)\)/ig,p0={c:"",r:"",tm:""};function m0(t,e){return p0[e.toLowerCase()]}function g0(t){let e=0;for(let n=t.length-1;n>=0;n--){const r=t[n];r.type==="text"&&!e&&(r.content=r.content.replace(h0,m0)),r.type==="link_open"&&r.info==="auto"&&e--,r.type==="link_close"&&r.info==="auto"&&e++}}function b0(t){let e=0;for(let n=t.length-1;n>=0;n--){const r=t[n];r.type==="text"&&!e&&Ns.test(r.content)&&(r.content=r.content.replace(/\+-/g,"").replace(/\.{2,}/g,"").replace(/([?!])/g,"$1..").replace(/([?!]){4,}/g,"$1$1$1").replace(/,{2,}/g,",").replace(/(^|[^-])---(?=[^-]|$)/mg,"$1").replace(/(^|\s)--(?=\s|$)/mg,"$1").replace(/(^|[^-\s])--(?=[^-\s]|$)/mg,"$1")),r.type==="link_open"&&r.info==="auto"&&e--,r.type==="link_close"&&r.info==="auto"&&e++}}function x0(t){let e;if(t.md.options.typographer)for(e=t.tokens.length-1;e>=0;e--)t.tokens[e].type==="inline"&&(d0.test(t.tokens[e].content)&&g0(t.tokens[e].children),Ns.test(t.tokens[e].content)&&b0(t.tokens[e].children))}const y0=/['"]/,zi=/['"]/g,Pi="";function fn(t,e,n){return t.slice(0,e)+n+t.slice(e+1)}function k0(t,e){let n;const r=[];for(let u=0;u<t.length;u++){const i=t[u],o=t[u].level;for(n=r.length-1;n>=0&&!(r[n].level<=o);n--);if(r.length=n+1,i.type!=="text")continue;let s=i.content,l=0,a=s.length;e:for(;l<a;){zi.lastIndex=l;const c=zi.exec(s);if(!c)break;let f=!0,d=!0;l=c.index+1;const p=c[0]==="'";let h=32;if(c.index-1>=0)h=s.charCodeAt(c.index-1);else for(n=u-1;n>=0&&!(t[n].type==="softbreak"||t[n].type==="hardbreak");n--)if(t[n].content){h=t[n].content.charCodeAt(t[n].content.length-1);break}let m=32;if(l<a)m=s.charCodeAt(l);else for(n=u+1;n<t.length&&!(t[n].type==="softbreak"||t[n].type==="hardbreak");n++)if(t[n].content){m=t[n].content.charCodeAt(0);break}const g=Zt(h)||Gt(String.fromCharCode(h)),b=Zt(m)||Gt(String.fromCharCode(m)),y=Kt(h),C=Kt(m);if(C?f=!1:b&&(y||g||(f=!1)),y?d=!1:g&&(C||b||(d=!1)),m===34&&c[0]==='"'&&h>=48&&h<=57&&(d=f=!1),f&&d&&(f=g,d=b),!f&&!d){p&&(i.content=fn(i.content,c.index,Pi));continue}if(d)for(n=r.length-1;n>=0;n--){let D=r[n];if(r[n].level<o)break;if(D.single===p&&r[n].level===o){D=r[n];let E,S;p?(E=e.md.options.quotes[2],S=e.md.options.quotes[3]):(E=e.md.options.quotes[0],S=e.md.options.quotes[1]),i.content=fn(i.content,c.index,S),t[D.token].content=fn(t[D.token].content,D.pos,E),l+=S.length-1,D.token===u&&(l+=E.length-1),s=i.content,a=s.length,r.length=n;continue e}}f?r.push({token:u,pos:c.index,single:p,level:o}):d&&p&&(i.content=fn(i.content,c.index,Pi))}}}function C0(t){if(t.md.options.typographer)for(let e=t.tokens.length-1;e>=0;e--)t.tokens[e].type!=="inline"||!y0.test(t.tokens[e].content)||k0(t.tokens[e].children,t)}function D0(t){let e,n;const r=t.tokens,u=r.length;for(let i=0;i<u;i++){if(r[i].type!=="inline")continue;const o=r[i].children,s=o.length;for(e=0;e<s;e++)o[e].type==="text_special"&&(o[e].type="text");for(e=n=0;e<s;e++)o[e].type==="text"&&e+1<s&&o[e+1].type==="text"?o[e+1].content=o[e].content+o[e+1].content:(e!==n&&(o[n]=o[e]),n++);e!==n&&(o.length=n)}}const fr=[["normalize",o0],["block",s0],["inline",l0],["linkify",f0],["replacements",x0],["smartquotes",C0],["text_join",D0]];function xu(){this.ruler=new te;for(let t=0;t<fr.length;t++)this.ruler.push(fr[t][0],fr[t][1])}xu.prototype.process=function(t){const e=this.ruler.getRules("");for(let n=0,r=e.length;n<r;n++)e[n](t)};xu.prototype.State=Fs;function De(t,e,n,r){this.src=t,this.md=e,this.env=n,this.tokens=r,this.bMarks=[],this.eMarks=[],this.tShift=[],this.sCount=[],this.bsCount=[],this.blkIndent=0,this.line=0,this.lineMax=0,this.tight=!1,this.ddIndent=-1,this.listIndent=-1,this.parentType="root",this.level=0;const u=this.src;for(let i=0,o=0,s=0,l=0,a=u.length,c=!1;o<a;o++){const f=u.charCodeAt(o);if(!c)if(F(f)){s++,f===9?l+=4-l%4:l++;continue}else c=!0;(f===10||o===a-1)&&(f!==10&&o++,this.bMarks.push(i),this.eMarks.push(o),this.tShift.push(s),this.sCount.push(l),this.bsCount.push(0),c=!1,s=0,l=0,i=o+1)}this.bMarks.push(u.length),this.eMarks.push(u.length),this.tShift.push(0),this.sCount.push(0),this.bsCount.push(0),this.lineMax=this.bMarks.length-1}De.prototype.push=function(t,e,n){const r=new pe(t,e,n);return r.block=!0,n<0&&this.level--,r.level=this.level,n>0&&this.level++,this.tokens.push(r),r};De.prototype.isEmpty=function(e){return this.bMarks[e]+this.tShift[e]>=this.eMarks[e]};De.prototype.skipEmptyLines=function(e){for(let n=this.lineMax;e<n&&!(this.bMarks[e]+this.tShift[e]<this.eMarks[e]);e++);return e};De.prototype.skipSpaces=function(e){for(let n=this.src.length;e<n;e++){const r=this.src.charCodeAt(e);if(!F(r))break}return e};De.prototype.skipSpacesBack=function(e,n){if(e<=n)return e;for(;e>n;)if(!F(this.src.charCodeAt(--e)))return e+1;return e};De.prototype.skipChars=function(e,n){for(let r=this.src.length;e<r&&this.src.charCodeAt(e)===n;e++);return e};De.prototype.skipCharsBack=function(e,n,r){if(e<=r)return e;for(;e>r;)if(n!==this.src.charCodeAt(--e))return e+1;return e};De.prototype.getLines=function(e,n,r,u){if(e>=n)return"";const i=new Array(n-e);for(let o=0,s=e;s<n;s++,o++){let l=0;const a=this.bMarks[s];let c=a,f;for(s+1<n||u?f=this.eMarks[s]+1:f=this.eMarks[s];c<f&&l<r;){const d=this.src.charCodeAt(c);if(F(d))d===9?l+=4-(l+this.bsCount[s])%4:l++;else if(c-a<this.tShift[s])l++;else break;c++}l>r?i[o]=new Array(l-r+1).join(" ")+this.src.slice(c,f):i[o]=this.src.slice(c,f)}return i.join("")};De.prototype.Token=pe;const w0=65536;function dr(t,e){const n=t.bMarks[e]+t.tShift[e],r=t.eMarks[e];return t.src.slice(n,r)}function Li(t){const e=[],n=t.length;let r=0,u=t.charCodeAt(r),i=!1,o=0,s="";for(;r<n;)u===124&&(i?(s+=t.substring(o,r-1),o=r):(e.push(s+t.substring(o,r)),s="",o=r+1)),i=u===92,r++,u=t.charCodeAt(r);return e.push(s+t.substring(o)),e}function E0(t,e,n,r){if(e+2>n)return!1;let u=e+1;if(t.sCount[u]<t.blkIndent||t.sCount[u]-t.blkIndent>=4)return!1;let i=t.bMarks[u]+t.tShift[u];if(i>=t.eMarks[u])return!1;const o=t.src.charCodeAt(i++);if(o!==124&&o!==45&&o!==58||i>=t.eMarks[u])return!1;const s=t.src.charCodeAt(i++);if(s!==124&&s!==45&&s!==58&&!F(s)||o===45&&F(s))return!1;for(;i<t.eMarks[u];){const D=t.src.charCodeAt(i);if(D!==124&&D!==45&&D!==58&&!F(D))return!1;i++}let l=dr(t,e+1),a=l.split("|");const c=[];for(let D=0;D<a.length;D++){const E=a[D].trim();if(!E){if(D===0||D===a.length-1)continue;return!1}if(!/^:?-+:?$/.test(E))return!1;E.charCodeAt(E.length-1)===58?c.push(E.charCodeAt(0)===58?"center":"right"):E.charCodeAt(0)===58?c.push("left"):c.push("")}if(l=dr(t,e).trim(),l.indexOf("|")===-1||t.sCount[e]-t.blkIndent>=4)return!1;a=Li(l),a.length&&a[0]===""&&a.shift(),a.length&&a[a.length-1]===""&&a.pop();const f=a.length;if(f===0||f!==c.length)return!1;if(r)return!0;const d=t.parentType;t.parentType="table";const p=t.md.block.ruler.getRules("blockquote"),h=t.push("table_open","table",1),m=[e,0];h.map=m;const g=t.push("thead_open","thead",1);g.map=[e,e+1];const b=t.push("tr_open","tr",1);b.map=[e,e+1];for(let D=0;D<a.length;D++){const E=t.push("th_open","th",1);c[D]&&(E.attrs=[["style","text-align:"+c[D]]]);const S=t.push("inline","",0);S.content=a[D].trim(),S.children=[],t.push("th_close","th",-1)}t.push("tr_close","tr",-1),t.push("thead_close","thead",-1);let y,C=0;for(u=e+2;u<n&&!(t.sCount[u]<t.blkIndent);u++){let D=!1;for(let S=0,N=p.length;S<N;S++)if(p[S](t,u,n,!0)){D=!0;break}if(D||(l=dr(t,u).trim(),!l)||t.sCount[u]-t.blkIndent>=4||(a=Li(l),a.length&&a[0]===""&&a.shift(),a.length&&a[a.length-1]===""&&a.pop(),C+=f-a.length,C>w0))break;if(u===e+2){const S=t.push("tbody_open","tbody",1);S.map=y=[e+2,0]}const E=t.push("tr_open","tr",1);E.map=[u,u+1];for(let S=0;S<f;S++){const N=t.push("td_open","td",1);c[S]&&(N.attrs=[["style","text-align:"+c[S]]]);const _=t.push("inline","",0);_.content=a[S]?a[S].trim():"",_.children=[],t.push("td_close","td",-1)}t.push("tr_close","tr",-1)}return y&&(t.push("tbody_close","tbody",-1),y[1]=u),t.push("table_close","table",-1),m[1]=u,t.parentType=d,t.line=u,!0}function _0(t,e,n){if(t.sCount[e]-t.blkIndent<4)return!1;let r=e+1,u=r;for(;r<n;){if(t.isEmpty(r)){r++;continue}if(t.sCount[r]-t.blkIndent>=4){r++,u=r;continue}break}t.line=u;const i=t.push("code_block","code",0);return i.content=t.getLines(e,u,4+t.blkIndent,!1)+`
`,i.map=[e,t.line],!0}function S0(t,e,n,r){let u=t.bMarks[e]+t.tShift[e],i=t.eMarks[e];if(t.sCount[e]-t.blkIndent>=4||u+3>i)return!1;const o=t.src.charCodeAt(u);if(o!==126&&o!==96)return!1;let s=u;u=t.skipChars(u,o);let l=u-s;if(l<3)return!1;const a=t.src.slice(s,u),c=t.src.slice(u,i);if(o===96&&c.indexOf(String.fromCharCode(o))>=0)return!1;if(r)return!0;let f=e,d=!1;for(;f++,!(f>=n||(u=s=t.bMarks[f]+t.tShift[f],i=t.eMarks[f],u<i&&t.sCount[f]<t.blkIndent));)if(t.src.charCodeAt(u)===o&&!(t.sCount[f]-t.blkIndent>=4)&&(u=t.skipChars(u,o),!(u-s<l)&&(u=t.skipSpaces(u),!(u<i)))){d=!0;break}l=t.sCount[e],t.line=f+(d?1:0);const p=t.push("fence","code",0);return p.info=c,p.content=t.getLines(e+1,f,l,!0),p.markup=a,p.map=[e,t.line],!0}function A0(t,e,n,r){let u=t.bMarks[e]+t.tShift[e],i=t.eMarks[e];const o=t.lineMax;if(t.sCount[e]-t.blkIndent>=4||t.src.charCodeAt(u)!==62)return!1;if(r)return!0;const s=[],l=[],a=[],c=[],f=t.md.block.ruler.getRules("blockquote"),d=t.parentType;t.parentType="blockquote";let p=!1,h;for(h=e;h<n;h++){const C=t.sCount[h]<t.blkIndent;if(u=t.bMarks[h]+t.tShift[h],i=t.eMarks[h],u>=i)break;if(t.src.charCodeAt(u++)===62&&!C){let E=t.sCount[h]+1,S,N;t.src.charCodeAt(u)===32?(u++,E++,N=!1,S=!0):t.src.charCodeAt(u)===9?(S=!0,(t.bsCount[h]+E)%4===3?(u++,E++,N=!1):N=!0):S=!1;let _=E;for(s.push(t.bMarks[h]),t.bMarks[h]=u;u<i;){const O=t.src.charCodeAt(u);if(F(O))O===9?_+=4-(_+t.bsCount[h]+(N?1:0))%4:_++;else break;u++}p=u>=i,l.push(t.bsCount[h]),t.bsCount[h]=t.sCount[h]+1+(S?1:0),a.push(t.sCount[h]),t.sCount[h]=_-E,c.push(t.tShift[h]),t.tShift[h]=u-t.bMarks[h];continue}if(p)break;let D=!1;for(let E=0,S=f.length;E<S;E++)if(f[E](t,h,n,!0)){D=!0;break}if(D){t.lineMax=h,t.blkIndent!==0&&(s.push(t.bMarks[h]),l.push(t.bsCount[h]),c.push(t.tShift[h]),a.push(t.sCount[h]),t.sCount[h]-=t.blkIndent);break}s.push(t.bMarks[h]),l.push(t.bsCount[h]),c.push(t.tShift[h]),a.push(t.sCount[h]),t.sCount[h]=-1}const m=t.blkIndent;t.blkIndent=0;const g=t.push("blockquote_open","blockquote",1);g.markup=">";const b=[e,0];g.map=b,t.md.block.tokenize(t,e,h);const y=t.push("blockquote_close","blockquote",-1);y.markup=">",t.lineMax=o,t.parentType=d,b[1]=t.line;for(let C=0;C<c.length;C++)t.bMarks[C+e]=s[C],t.tShift[C+e]=c[C],t.sCount[C+e]=a[C],t.bsCount[C+e]=l[C];return t.blkIndent=m,!0}function M0(t,e,n,r){const u=t.eMarks[e];if(t.sCount[e]-t.blkIndent>=4)return!1;let i=t.bMarks[e]+t.tShift[e];const o=t.src.charCodeAt(i++);if(o!==42&&o!==45&&o!==95)return!1;let s=1;for(;i<u;){const a=t.src.charCodeAt(i++);if(a!==o&&!F(a))return!1;a===o&&s++}if(s<3)return!1;if(r)return!0;t.line=e+1;const l=t.push("hr","hr",0);return l.map=[e,t.line],l.markup=Array(s+1).join(String.fromCharCode(o)),!0}function qi(t,e){const n=t.eMarks[e];let r=t.bMarks[e]+t.tShift[e];const u=t.src.charCodeAt(r++);if(u!==42&&u!==45&&u!==43)return-1;if(r<n){const i=t.src.charCodeAt(r);if(!F(i))return-1}return r}function Vi(t,e){const n=t.bMarks[e]+t.tShift[e],r=t.eMarks[e];let u=n;if(u+1>=r)return-1;let i=t.src.charCodeAt(u++);if(i<48||i>57)return-1;for(;;){if(u>=r)return-1;if(i=t.src.charCodeAt(u++),i>=48&&i<=57){if(u-n>=10)return-1;continue}if(i===41||i===46)break;return-1}return u<r&&(i=t.src.charCodeAt(u),!F(i))?-1:u}function T0(t,e){const n=t.level+2;for(let r=e+2,u=t.tokens.length-2;r<u;r++)t.tokens[r].level===n&&t.tokens[r].type==="paragraph_open"&&(t.tokens[r+2].hidden=!0,t.tokens[r].hidden=!0,r+=2)}function O0(t,e,n,r){let u,i,o,s,l=e,a=!0;if(t.sCount[l]-t.blkIndent>=4||t.listIndent>=0&&t.sCount[l]-t.listIndent>=4&&t.sCount[l]<t.blkIndent)return!1;let c=!1;r&&t.parentType==="paragraph"&&t.sCount[l]>=t.blkIndent&&(c=!0);let f,d,p;if((p=Vi(t,l))>=0){if(f=!0,o=t.bMarks[l]+t.tShift[l],d=Number(t.src.slice(o,p-1)),c&&d!==1)return!1}else if((p=qi(t,l))>=0)f=!1;else return!1;if(c&&t.skipSpaces(p)>=t.eMarks[l])return!1;if(r)return!0;const h=t.src.charCodeAt(p-1),m=t.tokens.length;f?(s=t.push("ordered_list_open","ol",1),d!==1&&(s.attrs=[["start",d]])):s=t.push("bullet_list_open","ul",1);const g=[l,0];s.map=g,s.markup=String.fromCharCode(h);let b=!1;const y=t.md.block.ruler.getRules("list"),C=t.parentType;for(t.parentType="list";l<n;){i=p,u=t.eMarks[l];const D=t.sCount[l]+p-(t.bMarks[l]+t.tShift[l]);let E=D;for(;i<u;){const it=t.src.charCodeAt(i);if(it===9)E+=4-(E+t.bsCount[l])%4;else if(it===32)E++;else break;i++}const S=i;let N;S>=u?N=1:N=E-D,N>4&&(N=1);const _=D+N;s=t.push("list_item_open","li",1),s.markup=String.fromCharCode(h);const O=[l,0];s.map=O,f&&(s.info=t.src.slice(o,p-1));const I=t.tight,St=t.tShift[l],El=t.sCount[l],_l=t.listIndent;if(t.listIndent=t.blkIndent,t.blkIndent=_,t.tight=!0,t.tShift[l]=S-t.bMarks[l],t.sCount[l]=E,S>=u&&t.isEmpty(l+1)?t.line=Math.min(t.line+2,n):t.md.block.tokenize(t,l,n,!0),(!t.tight||b)&&(a=!1),b=t.line-l>1&&t.isEmpty(t.line-1),t.blkIndent=t.listIndent,t.listIndent=_l,t.tShift[l]=St,t.sCount[l]=El,t.tight=I,s=t.push("list_item_close","li",-1),s.markup=String.fromCharCode(h),l=t.line,O[1]=l,l>=n||t.sCount[l]<t.blkIndent||t.sCount[l]-t.blkIndent>=4)break;let _u=!1;for(let it=0,Sl=y.length;it<Sl;it++)if(y[it](t,l,n,!0)){_u=!0;break}if(_u)break;if(f){if(p=Vi(t,l),p<0)break;o=t.bMarks[l]+t.tShift[l]}else if(p=qi(t,l),p<0)break;if(h!==t.src.charCodeAt(p-1))break}return f?s=t.push("ordered_list_close","ol",-1):s=t.push("bullet_list_close","ul",-1),s.markup=String.fromCharCode(h),g[1]=l,t.line=l,t.parentType=C,a&&T0(t,m),!0}function F0(t,e,n,r){let u=t.bMarks[e]+t.tShift[e],i=t.eMarks[e],o=e+1;if(t.sCount[e]-t.blkIndent>=4||t.src.charCodeAt(u)!==91)return!1;function s(y){const C=t.lineMax;if(y>=C||t.isEmpty(y))return null;let D=!1;if(t.sCount[y]-t.blkIndent>3&&(D=!0),t.sCount[y]<0&&(D=!0),!D){const N=t.md.block.ruler.getRules("reference"),_=t.parentType;t.parentType="reference";let O=!1;for(let I=0,St=N.length;I<St;I++)if(N[I](t,y,C,!0)){O=!0;break}if(t.parentType=_,O)return null}const E=t.bMarks[y]+t.tShift[y],S=t.eMarks[y];return t.src.slice(E,S+1)}let l=t.src.slice(u,i+1);i=l.length;let a=-1;for(u=1;u<i;u++){const y=l.charCodeAt(u);if(y===91)return!1;if(y===93){a=u;break}else if(y===10){const C=s(o);C!==null&&(l+=C,i=l.length,o++)}else if(y===92&&(u++,u<i&&l.charCodeAt(u)===10)){const C=s(o);C!==null&&(l+=C,i=l.length,o++)}}if(a<0||l.charCodeAt(a+1)!==58)return!1;for(u=a+2;u<i;u++){const y=l.charCodeAt(u);if(y===10){const C=s(o);C!==null&&(l+=C,i=l.length,o++)}else if(!F(y))break}const c=t.md.helpers.parseLinkDestination(l,u,i);if(!c.ok)return!1;const f=t.md.normalizeLink(c.str);if(!t.md.validateLink(f))return!1;u=c.pos;const d=u,p=o,h=u;for(;u<i;u++){const y=l.charCodeAt(u);if(y===10){const C=s(o);C!==null&&(l+=C,i=l.length,o++)}else if(!F(y))break}let m=t.md.helpers.parseLinkTitle(l,u,i);for(;m.can_continue;){const y=s(o);if(y===null)break;l+=y,u=i,i=l.length,o++,m=t.md.helpers.parseLinkTitle(l,u,i,m)}let g;for(u<i&&h!==u&&m.ok?(g=m.str,u=m.pos):(g="",u=d,o=p);u<i;){const y=l.charCodeAt(u);if(!F(y))break;u++}if(u<i&&l.charCodeAt(u)!==10&&g)for(g="",u=d,o=p;u<i;){const y=l.charCodeAt(u);if(!F(y))break;u++}if(u<i&&l.charCodeAt(u)!==10)return!1;const b=Jn(l.slice(1,a));return b?(r||(typeof t.env.references>"u"&&(t.env.references={}),typeof t.env.references[b]>"u"&&(t.env.references[b]={title:g,href:f}),t.line=o),!0):!1}const N0=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],v0="[a-zA-Z_:][a-zA-Z0-9:._-]*",I0="[^\"'=<>`\\x00-\\x20]+",R0="'[^']*'",B0='"[^"]*"',z0="(?:"+I0+"|"+R0+"|"+B0+")",P0="(?:\\s+"+v0+"(?:\\s*=\\s*"+z0+")?)",vs="<[A-Za-z][A-Za-z0-9\\-]*"+P0+"*\\s*\\/?>",Is="<\\/[A-Za-z][A-Za-z0-9\\-]*\\s*>",L0="<!---?>|<!--(?:[^-]|-[^-]|--[^>])*-->",q0="<[?][\\s\\S]*?[?]>",V0="<![A-Za-z][^>]*>",$0="<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",H0=new RegExp("^(?:"+vs+"|"+Is+"|"+L0+"|"+q0+"|"+V0+"|"+$0+")"),W0=new RegExp("^(?:"+vs+"|"+Is+")"),lt=[[/^<(script|pre|style|textarea)(?=(\s|>|$))/i,/<\/(script|pre|style|textarea)>/i,!0],[/^<!--/,/-->/,!0],[/^<\?/,/\?>/,!0],[/^<![A-Z]/,/>/,!0],[/^<!\[CDATA\[/,/\]\]>/,!0],[new RegExp("^</?("+N0.join("|")+")(?=(\\s|/?>|$))","i"),/^$/,!0],[new RegExp(W0.source+"\\s*$"),/^$/,!1]];function J0(t,e,n,r){let u=t.bMarks[e]+t.tShift[e],i=t.eMarks[e];if(t.sCount[e]-t.blkIndent>=4||!t.md.options.html||t.src.charCodeAt(u)!==60)return!1;let o=t.src.slice(u,i),s=0;for(;s<lt.length&&!lt[s][0].test(o);s++);if(s===lt.length)return!1;if(r)return lt[s][2];let l=e+1;if(!lt[s][1].test(o)){for(;l<n&&!(t.sCount[l]<t.blkIndent);l++)if(u=t.bMarks[l]+t.tShift[l],i=t.eMarks[l],o=t.src.slice(u,i),lt[s][1].test(o)){o.length!==0&&l++;break}}t.line=l;const a=t.push("html_block","",0);return a.map=[e,l],a.content=t.getLines(e,l,t.blkIndent,!0),!0}function j0(t,e,n,r){let u=t.bMarks[e]+t.tShift[e],i=t.eMarks[e];if(t.sCount[e]-t.blkIndent>=4)return!1;let o=t.src.charCodeAt(u);if(o!==35||u>=i)return!1;let s=1;for(o=t.src.charCodeAt(++u);o===35&&u<i&&s<=6;)s++,o=t.src.charCodeAt(++u);if(s>6||u<i&&!F(o))return!1;if(r)return!0;i=t.skipSpacesBack(i,u);const l=t.skipCharsBack(i,35,u);l>u&&F(t.src.charCodeAt(l-1))&&(i=l),t.line=e+1;const a=t.push("heading_open","h"+String(s),1);a.markup="########".slice(0,s),a.map=[e,t.line];const c=t.push("inline","",0);c.content=t.src.slice(u,i).trim(),c.map=[e,t.line],c.children=[];const f=t.push("heading_close","h"+String(s),-1);return f.markup="########".slice(0,s),!0}function U0(t,e,n){const r=t.md.block.ruler.getRules("paragraph");if(t.sCount[e]-t.blkIndent>=4)return!1;const u=t.parentType;t.parentType="paragraph";let i=0,o,s=e+1;for(;s<n&&!t.isEmpty(s);s++){if(t.sCount[s]-t.blkIndent>3)continue;if(t.sCount[s]>=t.blkIndent){let p=t.bMarks[s]+t.tShift[s];const h=t.eMarks[s];if(p<h&&(o=t.src.charCodeAt(p),(o===45||o===61)&&(p=t.skipChars(p,o),p=t.skipSpaces(p),p>=h))){i=o===61?1:2;break}}if(t.sCount[s]<0)continue;let d=!1;for(let p=0,h=r.length;p<h;p++)if(r[p](t,s,n,!0)){d=!0;break}if(d)break}if(!i)return!1;const l=t.getLines(e,s,t.blkIndent,!1).trim();t.line=s+1;const a=t.push("heading_open","h"+String(i),1);a.markup=String.fromCharCode(o),a.map=[e,t.line];const c=t.push("inline","",0);c.content=l,c.map=[e,t.line-1],c.children=[];const f=t.push("heading_close","h"+String(i),-1);return f.markup=String.fromCharCode(o),t.parentType=u,!0}function K0(t,e,n){const r=t.md.block.ruler.getRules("paragraph"),u=t.parentType;let i=e+1;for(t.parentType="paragraph";i<n&&!t.isEmpty(i);i++){if(t.sCount[i]-t.blkIndent>3||t.sCount[i]<0)continue;let a=!1;for(let c=0,f=r.length;c<f;c++)if(r[c](t,i,n,!0)){a=!0;break}if(a)break}const o=t.getLines(e,i,t.blkIndent,!1).trim();t.line=i;const s=t.push("paragraph_open","p",1);s.map=[e,t.line];const l=t.push("inline","",0);return l.content=o,l.map=[e,t.line],l.children=[],t.push("paragraph_close","p",-1),t.parentType=u,!0}const dn=[["table",E0,["paragraph","reference"]],["code",_0],["fence",S0,["paragraph","reference","blockquote","list"]],["blockquote",A0,["paragraph","reference","blockquote","list"]],["hr",M0,["paragraph","reference","blockquote","list"]],["list",O0,["paragraph","reference","blockquote"]],["reference",F0],["html_block",J0,["paragraph","reference","blockquote"]],["heading",j0,["paragraph","reference","blockquote"]],["lheading",U0],["paragraph",K0]];function jn(){this.ruler=new te;for(let t=0;t<dn.length;t++)this.ruler.push(dn[t][0],dn[t][1],{alt:(dn[t][2]||[]).slice()})}jn.prototype.tokenize=function(t,e,n){const r=this.ruler.getRules(""),u=r.length,i=t.md.options.maxNesting;let o=e,s=!1;for(;o<n&&(t.line=o=t.skipEmptyLines(o),!(o>=n||t.sCount[o]<t.blkIndent));){if(t.level>=i){t.line=n;break}const l=t.line;let a=!1;for(let c=0;c<u;c++)if(a=r[c](t,o,n,!1),a){if(l>=t.line)throw new Error("block rule didn't increment state.line");break}if(!a)throw new Error("none of the block rules matched");t.tight=!s,t.isEmpty(t.line-1)&&(s=!0),o=t.line,o<n&&t.isEmpty(o)&&(s=!0,o++,t.line=o)}};jn.prototype.parse=function(t,e,n,r){if(!t)return;const u=new this.State(t,e,n,r);this.tokenize(u,u.line,u.lineMax)};jn.prototype.State=De;function on(t,e,n,r){this.src=t,this.env=n,this.md=e,this.tokens=r,this.tokens_meta=Array(r.length),this.pos=0,this.posMax=this.src.length,this.level=0,this.pending="",this.pendingLevel=0,this.cache={},this.delimiters=[],this._prev_delimiters=[],this.backticks={},this.backticksScanned=!1,this.linkLevel=0}on.prototype.pushPending=function(){const t=new pe("text","",0);return t.content=this.pending,t.level=this.pendingLevel,this.tokens.push(t),this.pending="",t};on.prototype.push=function(t,e,n){this.pending&&this.pushPending();const r=new pe(t,e,n);let u=null;return n<0&&(this.level--,this.delimiters=this._prev_delimiters.pop()),r.level=this.level,n>0&&(this.level++,this._prev_delimiters.push(this.delimiters),this.delimiters=[],u={delimiters:this.delimiters}),this.pendingLevel=this.level,this.tokens.push(r),this.tokens_meta.push(u),r};on.prototype.scanDelims=function(t,e){const n=this.posMax,r=this.src.charCodeAt(t),u=t>0?this.src.charCodeAt(t-1):32;let i=t;for(;i<n&&this.src.charCodeAt(i)===r;)i++;const o=i-t,s=i<n?this.src.charCodeAt(i):32,l=Zt(u)||Gt(String.fromCharCode(u)),a=Zt(s)||Gt(String.fromCharCode(s)),c=Kt(u),f=Kt(s),d=!f&&(!a||c||l),p=!c&&(!l||f||a);return{can_open:d&&(e||!p||l),can_close:p&&(e||!d||a),length:o}};on.prototype.Token=pe;function G0(t){switch(t){case 10:case 33:case 35:case 36:case 37:case 38:case 42:case 43:case 45:case 58:case 60:case 61:case 62:case 64:case 91:case 92:case 93:case 94:case 95:case 96:case 123:case 125:case 126:return!0;default:return!1}}function Z0(t,e){let n=t.pos;for(;n<t.posMax&&!G0(t.src.charCodeAt(n));)n++;return n===t.pos?!1:(e||(t.pending+=t.src.slice(t.pos,n)),t.pos=n,!0)}const Q0=/(?:^|[^a-z0-9.+-])([a-z][a-z0-9.+-]*)$/i;function Y0(t,e){if(!t.md.options.linkify||t.linkLevel>0)return!1;const n=t.pos,r=t.posMax;if(n+3>r||t.src.charCodeAt(n)!==58||t.src.charCodeAt(n+1)!==47||t.src.charCodeAt(n+2)!==47)return!1;const u=t.pending.match(Q0);if(!u)return!1;const i=u[1],o=t.md.linkify.matchAtStart(t.src.slice(n-i.length));if(!o)return!1;let s=o.url;if(s.length<=i.length)return!1;s=s.replace(/\*+$/,"");const l=t.md.normalizeLink(s);if(!t.md.validateLink(l))return!1;if(!e){t.pending=t.pending.slice(0,-i.length);const a=t.push("link_open","a",1);a.attrs=[["href",l]],a.markup="linkify",a.info="auto";const c=t.push("text","",0);c.content=t.md.normalizeLinkText(s);const f=t.push("link_close","a",-1);f.markup="linkify",f.info="auto"}return t.pos+=s.length-i.length,!0}function X0(t,e){let n=t.pos;if(t.src.charCodeAt(n)!==10)return!1;const r=t.pending.length-1,u=t.posMax;if(!e)if(r>=0&&t.pending.charCodeAt(r)===32)if(r>=1&&t.pending.charCodeAt(r-1)===32){let i=r-1;for(;i>=1&&t.pending.charCodeAt(i-1)===32;)i--;t.pending=t.pending.slice(0,i),t.push("hardbreak","br",0)}else t.pending=t.pending.slice(0,-1),t.push("softbreak","br",0);else t.push("softbreak","br",0);for(n++;n<u&&F(t.src.charCodeAt(n));)n++;return t.pos=n,!0}const yu=[];for(let t=0;t<256;t++)yu.push(0);"\\!\"#$%&'()*+,./:;<=>?@[]^_`{|}~-".split("").forEach(function(t){yu[t.charCodeAt(0)]=1});function ed(t,e){let n=t.pos;const r=t.posMax;if(t.src.charCodeAt(n)!==92||(n++,n>=r))return!1;let u=t.src.charCodeAt(n);if(u===10){for(e||t.push("hardbreak","br",0),n++;n<r&&(u=t.src.charCodeAt(n),!!F(u));)n++;return t.pos=n,!0}let i=t.src[n];if(u>=55296&&u<=56319&&n+1<r){const s=t.src.charCodeAt(n+1);s>=56320&&s<=57343&&(i+=t.src[n+1],n++)}const o="\\"+i;if(!e){const s=t.push("text_special","",0);u<256&&yu[u]!==0?s.content=i:s.content=o,s.markup=o,s.info="escape"}return t.pos=n+1,!0}function td(t,e){let n=t.pos;if(t.src.charCodeAt(n)!==96)return!1;const u=n;n++;const i=t.posMax;for(;n<i&&t.src.charCodeAt(n)===96;)n++;const o=t.src.slice(u,n),s=o.length;if(t.backticksScanned&&(t.backticks[s]||0)<=u)return e||(t.pending+=o),t.pos+=s,!0;let l=n,a;for(;(a=t.src.indexOf("`",l))!==-1;){for(l=a+1;l<i&&t.src.charCodeAt(l)===96;)l++;const c=l-a;if(c===s){if(!e){const f=t.push("code_inline","code",0);f.markup=o,f.content=t.src.slice(n,a).replace(/\n/g," ").replace(/^ (.+) $/,"$1")}return t.pos=l,!0}t.backticks[c]=a}return t.backticksScanned=!0,e||(t.pending+=o),t.pos+=s,!0}function nd(t,e){const n=t.pos,r=t.src.charCodeAt(n);if(e||r!==126)return!1;const u=t.scanDelims(t.pos,!0);let i=u.length;const o=String.fromCharCode(r);if(i<2)return!1;let s;i%2&&(s=t.push("text","",0),s.content=o,i--);for(let l=0;l<i;l+=2)s=t.push("text","",0),s.content=o+o,t.delimiters.push({marker:r,length:0,token:t.tokens.length-1,end:-1,open:u.can_open,close:u.can_close});return t.pos+=u.length,!0}function $i(t,e){let n;const r=[],u=e.length;for(let i=0;i<u;i++){const o=e[i];if(o.marker!==126||o.end===-1)continue;const s=e[o.end];n=t.tokens[o.token],n.type="s_open",n.tag="s",n.nesting=1,n.markup="~~",n.content="",n=t.tokens[s.token],n.type="s_close",n.tag="s",n.nesting=-1,n.markup="~~",n.content="",t.tokens[s.token-1].type==="text"&&t.tokens[s.token-1].content==="~"&&r.push(s.token-1)}for(;r.length;){const i=r.pop();let o=i+1;for(;o<t.tokens.length&&t.tokens[o].type==="s_close";)o++;o--,i!==o&&(n=t.tokens[o],t.tokens[o]=t.tokens[i],t.tokens[i]=n)}}function rd(t){const e=t.tokens_meta,n=t.tokens_meta.length;$i(t,t.delimiters);for(let r=0;r<n;r++)e[r]&&e[r].delimiters&&$i(t,e[r].delimiters)}const Rs={tokenize:nd,postProcess:rd};function ud(t,e){const n=t.pos,r=t.src.charCodeAt(n);if(e||r!==95&&r!==42)return!1;const u=t.scanDelims(t.pos,r===42);for(let i=0;i<u.length;i++){const o=t.push("text","",0);o.content=String.fromCharCode(r),t.delimiters.push({marker:r,length:u.length,token:t.tokens.length-1,end:-1,open:u.can_open,close:u.can_close})}return t.pos+=u.length,!0}function Hi(t,e){const n=e.length;for(let r=n-1;r>=0;r--){const u=e[r];if(u.marker!==95&&u.marker!==42||u.end===-1)continue;const i=e[u.end],o=r>0&&e[r-1].end===u.end+1&&e[r-1].marker===u.marker&&e[r-1].token===u.token-1&&e[u.end+1].token===i.token+1,s=String.fromCharCode(u.marker),l=t.tokens[u.token];l.type=o?"strong_open":"em_open",l.tag=o?"strong":"em",l.nesting=1,l.markup=o?s+s:s,l.content="";const a=t.tokens[i.token];a.type=o?"strong_close":"em_close",a.tag=o?"strong":"em",a.nesting=-1,a.markup=o?s+s:s,a.content="",o&&(t.tokens[e[r-1].token].content="",t.tokens[e[u.end+1].token].content="",r--)}}function id(t){const e=t.tokens_meta,n=t.tokens_meta.length;Hi(t,t.delimiters);for(let r=0;r<n;r++)e[r]&&e[r].delimiters&&Hi(t,e[r].delimiters)}const Bs={tokenize:ud,postProcess:id};function od(t,e){let n,r,u,i,o="",s="",l=t.pos,a=!0;if(t.src.charCodeAt(t.pos)!==91)return!1;const c=t.pos,f=t.posMax,d=t.pos+1,p=t.md.helpers.parseLinkLabel(t,t.pos,!0);if(p<0)return!1;let h=p+1;if(h<f&&t.src.charCodeAt(h)===40){for(a=!1,h++;h<f&&(n=t.src.charCodeAt(h),!(!F(n)&&n!==10));h++);if(h>=f)return!1;if(l=h,u=t.md.helpers.parseLinkDestination(t.src,h,t.posMax),u.ok){for(o=t.md.normalizeLink(u.str),t.md.validateLink(o)?h=u.pos:o="",l=h;h<f&&(n=t.src.charCodeAt(h),!(!F(n)&&n!==10));h++);if(u=t.md.helpers.parseLinkTitle(t.src,h,t.posMax),h<f&&l!==h&&u.ok)for(s=u.str,h=u.pos;h<f&&(n=t.src.charCodeAt(h),!(!F(n)&&n!==10));h++);}(h>=f||t.src.charCodeAt(h)!==41)&&(a=!0),h++}if(a){if(typeof t.env.references>"u")return!1;if(h<f&&t.src.charCodeAt(h)===91?(l=h+1,h=t.md.helpers.parseLinkLabel(t,h),h>=0?r=t.src.slice(l,h++):h=p+1):h=p+1,r||(r=t.src.slice(d,p)),i=t.env.references[Jn(r)],!i)return t.pos=c,!1;o=i.href,s=i.title}if(!e){t.pos=d,t.posMax=p;const m=t.push("link_open","a",1),g=[["href",o]];m.attrs=g,s&&g.push(["title",s]),t.linkLevel++,t.md.inline.tokenize(t),t.linkLevel--,t.push("link_close","a",-1)}return t.pos=h,t.posMax=f,!0}function sd(t,e){let n,r,u,i,o,s,l,a,c="";const f=t.pos,d=t.posMax;if(t.src.charCodeAt(t.pos)!==33||t.src.charCodeAt(t.pos+1)!==91)return!1;const p=t.pos+2,h=t.md.helpers.parseLinkLabel(t,t.pos+1,!1);if(h<0)return!1;if(i=h+1,i<d&&t.src.charCodeAt(i)===40){for(i++;i<d&&(n=t.src.charCodeAt(i),!(!F(n)&&n!==10));i++);if(i>=d)return!1;for(a=i,s=t.md.helpers.parseLinkDestination(t.src,i,t.posMax),s.ok&&(c=t.md.normalizeLink(s.str),t.md.validateLink(c)?i=s.pos:c=""),a=i;i<d&&(n=t.src.charCodeAt(i),!(!F(n)&&n!==10));i++);if(s=t.md.helpers.parseLinkTitle(t.src,i,t.posMax),i<d&&a!==i&&s.ok)for(l=s.str,i=s.pos;i<d&&(n=t.src.charCodeAt(i),!(!F(n)&&n!==10));i++);else l="";if(i>=d||t.src.charCodeAt(i)!==41)return t.pos=f,!1;i++}else{if(typeof t.env.references>"u")return!1;if(i<d&&t.src.charCodeAt(i)===91?(a=i+1,i=t.md.helpers.parseLinkLabel(t,i),i>=0?u=t.src.slice(a,i++):i=h+1):i=h+1,u||(u=t.src.slice(p,h)),o=t.env.references[Jn(u)],!o)return t.pos=f,!1;c=o.href,l=o.title}if(!e){r=t.src.slice(p,h);const m=[];t.md.inline.parse(r,t.md,t.env,m);const g=t.push("image","img",0),b=[["src",c],["alt",""]];g.attrs=b,g.children=m,g.content=r,l&&b.push(["title",l])}return t.pos=i,t.posMax=d,!0}const ld=/^([a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)$/,ad=/^([a-zA-Z][a-zA-Z0-9+.-]{1,31}):([^<>\x00-\x20]*)$/;function cd(t,e){let n=t.pos;if(t.src.charCodeAt(n)!==60)return!1;const r=t.pos,u=t.posMax;for(;;){if(++n>=u)return!1;const o=t.src.charCodeAt(n);if(o===60)return!1;if(o===62)break}const i=t.src.slice(r+1,n);if(ad.test(i)){const o=t.md.normalizeLink(i);if(!t.md.validateLink(o))return!1;if(!e){const s=t.push("link_open","a",1);s.attrs=[["href",o]],s.markup="autolink",s.info="auto";const l=t.push("text","",0);l.content=t.md.normalizeLinkText(i);const a=t.push("link_close","a",-1);a.markup="autolink",a.info="auto"}return t.pos+=i.length+2,!0}if(ld.test(i)){const o=t.md.normalizeLink("mailto:"+i);if(!t.md.validateLink(o))return!1;if(!e){const s=t.push("link_open","a",1);s.attrs=[["href",o]],s.markup="autolink",s.info="auto";const l=t.push("text","",0);l.content=t.md.normalizeLinkText(i);const a=t.push("link_close","a",-1);a.markup="autolink",a.info="auto"}return t.pos+=i.length+2,!0}return!1}function fd(t){return/^<a[>\s]/i.test(t)}function dd(t){return/^<\/a\s*>/i.test(t)}function hd(t){const e=t|32;return e>=97&&e<=122}function pd(t,e){if(!t.md.options.html)return!1;const n=t.posMax,r=t.pos;if(t.src.charCodeAt(r)!==60||r+2>=n)return!1;const u=t.src.charCodeAt(r+1);if(u!==33&&u!==63&&u!==47&&!hd(u))return!1;const i=t.src.slice(r).match(H0);if(!i)return!1;if(!e){const o=t.push("html_inline","",0);o.content=i[0],fd(o.content)&&t.linkLevel++,dd(o.content)&&t.linkLevel--}return t.pos+=i[0].length,!0}const md=/^&#((?:x[a-f0-9]{1,6}|[0-9]{1,7}));/i,gd=/^&([a-z][a-z0-9]{1,31});/i;function bd(t,e){const n=t.pos,r=t.posMax;if(t.src.charCodeAt(n)!==38||n+1>=r)return!1;if(t.src.charCodeAt(n+1)===35){const i=t.src.slice(n).match(md);if(i){if(!e){const o=i[1][0].toLowerCase()==="x"?parseInt(i[1].slice(1),16):parseInt(i[1],10),s=t.push("text_special","",0);s.content=bu(o)?Nn(o):Nn(65533),s.markup=i[0],s.info="entity"}return t.pos+=i[0].length,!0}}else{const i=t.src.slice(n).match(gd);if(i){const o=Ms(i[0]);if(o!==i[0]){if(!e){const s=t.push("text_special","",0);s.content=o,s.markup=i[0],s.info="entity"}return t.pos+=i[0].length,!0}}}return!1}function Wi(t){const e={},n=t.length;if(!n)return;let r=0,u=-2;const i=[];for(let o=0;o<n;o++){const s=t[o];if(i.push(0),(t[r].marker!==s.marker||u!==s.token-1)&&(r=o),u=s.token,s.length=s.length||0,!s.close)continue;e.hasOwnProperty(s.marker)||(e[s.marker]=[-1,-1,-1,-1,-1,-1]);const l=e[s.marker][(s.open?3:0)+s.length%3];let a=r-i[r]-1,c=a;for(;a>l;a-=i[a]+1){const f=t[a];if(f.marker===s.marker&&f.open&&f.end<0){let d=!1;if((f.close||s.open)&&(f.length+s.length)%3===0&&(f.length%3!==0||s.length%3!==0)&&(d=!0),!d){const p=a>0&&!t[a-1].open?i[a-1]+1:0;i[o]=o-a+p,i[a]=p,s.open=!1,f.end=o,f.close=!1,c=-1,u=-2;break}}}c!==-1&&(e[s.marker][(s.open?3:0)+(s.length||0)%3]=c)}}function xd(t){const e=t.tokens_meta,n=t.tokens_meta.length;Wi(t.delimiters);for(let r=0;r<n;r++)e[r]&&e[r].delimiters&&Wi(e[r].delimiters)}function yd(t){let e,n,r=0;const u=t.tokens,i=t.tokens.length;for(e=n=0;e<i;e++)u[e].nesting<0&&r--,u[e].level=r,u[e].nesting>0&&r++,u[e].type==="text"&&e+1<i&&u[e+1].type==="text"?u[e+1].content=u[e].content+u[e+1].content:(e!==n&&(u[n]=u[e]),n++);e!==n&&(u.length=n)}const hr=[["text",Z0],["linkify",Y0],["newline",X0],["escape",ed],["backticks",td],["strikethrough",Rs.tokenize],["emphasis",Bs.tokenize],["link",od],["image",sd],["autolink",cd],["html_inline",pd],["entity",bd]],pr=[["balance_pairs",xd],["strikethrough",Rs.postProcess],["emphasis",Bs.postProcess],["fragments_join",yd]];function sn(){this.ruler=new te;for(let t=0;t<hr.length;t++)this.ruler.push(hr[t][0],hr[t][1]);this.ruler2=new te;for(let t=0;t<pr.length;t++)this.ruler2.push(pr[t][0],pr[t][1])}sn.prototype.skipToken=function(t){const e=t.pos,n=this.ruler.getRules(""),r=n.length,u=t.md.options.maxNesting,i=t.cache;if(typeof i[e]<"u"){t.pos=i[e];return}let o=!1;if(t.level<u){for(let s=0;s<r;s++)if(t.level++,o=n[s](t,!0),t.level--,o){if(e>=t.pos)throw new Error("inline rule didn't increment state.pos");break}}else t.pos=t.posMax;o||t.pos++,i[e]=t.pos};sn.prototype.tokenize=function(t){const e=this.ruler.getRules(""),n=e.length,r=t.posMax,u=t.md.options.maxNesting;for(;t.pos<r;){const i=t.pos;let o=!1;if(t.level<u){for(let s=0;s<n;s++)if(o=e[s](t,!1),o){if(i>=t.pos)throw new Error("inline rule didn't increment state.pos");break}}if(o){if(t.pos>=r)break;continue}t.pending+=t.src[t.pos++]}t.pending&&t.pushPending()};sn.prototype.parse=function(t,e,n,r){const u=new this.State(t,e,n,r);this.tokenize(u);const i=this.ruler2.getRules(""),o=i.length;for(let s=0;s<o;s++)i[s](u)};sn.prototype.State=on;function kd(t){const e={};t=t||{},e.src_Any=ws.source,e.src_Cc=Es.source,e.src_Z=Ss.source,e.src_P=mu.source,e.src_ZPCc=[e.src_Z,e.src_P,e.src_Cc].join("|"),e.src_ZCc=[e.src_Z,e.src_Cc].join("|");const n="[><]";return e.src_pseudo_letter="(?:(?!"+n+"|"+e.src_ZPCc+")"+e.src_Any+")",e.src_ip4="(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)",e.src_auth="(?:(?:(?!"+e.src_ZCc+"|[@/\\[\\]()]).)+@)?",e.src_port="(?::(?:6(?:[0-4]\\d{3}|5(?:[0-4]\\d{2}|5(?:[0-2]\\d|3[0-5])))|[1-5]?\\d{1,4}))?",e.src_host_terminator="(?=$|"+n+"|"+e.src_ZPCc+")(?!"+(t["---"]?"-(?!--)|":"-|")+"_|:\\d|\\.-|\\.(?!$|"+e.src_ZPCc+"))",e.src_path="(?:[/?#](?:(?!"+e.src_ZCc+"|"+n+`|[()[\\]{}.,"'?!\\-;]).|\\[(?:(?!`+e.src_ZCc+"|\\]).)*\\]|\\((?:(?!"+e.src_ZCc+"|[)]).)*\\)|\\{(?:(?!"+e.src_ZCc+'|[}]).)*\\}|\\"(?:(?!'+e.src_ZCc+`|["]).)+\\"|\\'(?:(?!`+e.src_ZCc+"|[']).)+\\'|\\'(?="+e.src_pseudo_letter+"|[-])|\\.{2,}[a-zA-Z0-9%/&]|\\.(?!"+e.src_ZCc+"|[.]|$)|"+(t["---"]?"\\-(?!--(?:[^-]|$))(?:-*)|":"\\-+|")+",(?!"+e.src_ZCc+"|$)|;(?!"+e.src_ZCc+"|$)|\\!+(?!"+e.src_ZCc+"|[!]|$)|\\?(?!"+e.src_ZCc+"|[?]|$))+|\\/)?",e.src_email_name='[\\-;:&=\\+\\$,\\.a-zA-Z0-9_][\\-;:&=\\+\\$,\\"\\.a-zA-Z0-9_]*',e.src_xn="xn--[a-z0-9\\-]{1,59}",e.src_domain_root="(?:"+e.src_xn+"|"+e.src_pseudo_letter+"{1,63})",e.src_domain="(?:"+e.src_xn+"|(?:"+e.src_pseudo_letter+")|(?:"+e.src_pseudo_letter+"(?:-|"+e.src_pseudo_letter+"){0,61}"+e.src_pseudo_letter+"))",e.src_host="(?:(?:(?:(?:"+e.src_domain+")\\.)*"+e.src_domain+"))",e.tpl_host_fuzzy="(?:"+e.src_ip4+"|(?:(?:(?:"+e.src_domain+")\\.)+(?:%TLDS%)))",e.tpl_host_no_ip_fuzzy="(?:(?:(?:"+e.src_domain+")\\.)+(?:%TLDS%))",e.src_host_strict=e.src_host+e.src_host_terminator,e.tpl_host_fuzzy_strict=e.tpl_host_fuzzy+e.src_host_terminator,e.src_host_port_strict=e.src_host+e.src_port+e.src_host_terminator,e.tpl_host_port_fuzzy_strict=e.tpl_host_fuzzy+e.src_port+e.src_host_terminator,e.tpl_host_port_no_ip_fuzzy_strict=e.tpl_host_no_ip_fuzzy+e.src_port+e.src_host_terminator,e.tpl_host_fuzzy_test="localhost|www\\.|\\.\\d{1,3}\\.|(?:\\.(?:%TLDS%)(?:"+e.src_ZPCc+"|>|$))",e.tpl_email_fuzzy="(^|"+n+'|"|\\(|'+e.src_ZCc+")("+e.src_email_name+"@"+e.tpl_host_fuzzy_strict+")",e.tpl_link_fuzzy="(^|(?![.:/\\-_@])(?:[$+<=>^`|]|"+e.src_ZPCc+"))((?![$+<=>^`|])"+e.tpl_host_port_fuzzy_strict+e.src_path+")",e.tpl_link_no_ip_fuzzy="(^|(?![.:/\\-_@])(?:[$+<=>^`|]|"+e.src_ZPCc+"))((?![$+<=>^`|])"+e.tpl_host_port_no_ip_fuzzy_strict+e.src_path+")",e}function $r(t){return Array.prototype.slice.call(arguments,1).forEach(function(n){n&&Object.keys(n).forEach(function(r){t[r]=n[r]})}),t}function Un(t){return Object.prototype.toString.call(t)}function Cd(t){return Un(t)==="[object String]"}function Dd(t){return Un(t)==="[object Object]"}function wd(t){return Un(t)==="[object RegExp]"}function Ji(t){return Un(t)==="[object Function]"}function Ed(t){return t.replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}const zs={fuzzyLink:!0,fuzzyEmail:!0,fuzzyIP:!1};function _d(t){return Object.keys(t||{}).reduce(function(e,n){return e||zs.hasOwnProperty(n)},!1)}const Sd={"http:":{validate:function(t,e,n){const r=t.slice(e);return n.re.http||(n.re.http=new RegExp("^\\/\\/"+n.re.src_auth+n.re.src_host_port_strict+n.re.src_path,"i")),n.re.http.test(r)?r.match(n.re.http)[0].length:0}},"https:":"http:","ftp:":"http:","//":{validate:function(t,e,n){const r=t.slice(e);return n.re.no_http||(n.re.no_http=new RegExp("^"+n.re.src_auth+"(?:localhost|(?:(?:"+n.re.src_domain+")\\.)+"+n.re.src_domain_root+")"+n.re.src_port+n.re.src_host_terminator+n.re.src_path,"i")),n.re.no_http.test(r)?e>=3&&t[e-3]===":"||e>=3&&t[e-3]==="/"?0:r.match(n.re.no_http)[0].length:0}},"mailto:":{validate:function(t,e,n){const r=t.slice(e);return n.re.mailto||(n.re.mailto=new RegExp("^"+n.re.src_email_name+"@"+n.re.src_host_strict,"i")),n.re.mailto.test(r)?r.match(n.re.mailto)[0].length:0}}},Ad="a[cdefgilmnoqrstuwxz]|b[abdefghijmnorstvwyz]|c[acdfghiklmnoruvwxyz]|d[ejkmoz]|e[cegrstu]|f[ijkmor]|g[abdefghilmnpqrstuwy]|h[kmnrtu]|i[delmnoqrst]|j[emop]|k[eghimnprwyz]|l[abcikrstuvy]|m[acdeghklmnopqrstuvwxyz]|n[acefgilopruz]|om|p[aefghklmnrstwy]|qa|r[eosuw]|s[abcdeghijklmnortuvxyz]|t[cdfghjklmnortvwz]|u[agksyz]|v[aceginu]|w[fs]|y[et]|z[amw]",Md="biz|com|edu|gov|net|org|pro|web|xxx|aero|asia|coop|info|museum|name|shop|".split("|");function Td(t){t.__index__=-1,t.__text_cache__=""}function Od(t){return function(e,n){const r=e.slice(n);return t.test(r)?r.match(t)[0].length:0}}function ji(){return function(t,e){e.normalize(t)}}function vn(t){const e=t.re=kd(t.__opts__),n=t.__tlds__.slice();t.onCompile(),t.__tlds_replaced__||n.push(Ad),n.push(e.src_xn),e.src_tlds=n.join("|");function r(s){return s.replace("%TLDS%",e.src_tlds)}e.email_fuzzy=RegExp(r(e.tpl_email_fuzzy),"i"),e.link_fuzzy=RegExp(r(e.tpl_link_fuzzy),"i"),e.link_no_ip_fuzzy=RegExp(r(e.tpl_link_no_ip_fuzzy),"i"),e.host_fuzzy_test=RegExp(r(e.tpl_host_fuzzy_test),"i");const u=[];t.__compiled__={};function i(s,l){throw new Error('(LinkifyIt) Invalid schema "'+s+'": '+l)}Object.keys(t.__schemas__).forEach(function(s){const l=t.__schemas__[s];if(l===null)return;const a={validate:null,link:null};if(t.__compiled__[s]=a,Dd(l)){wd(l.validate)?a.validate=Od(l.validate):Ji(l.validate)?a.validate=l.validate:i(s,l),Ji(l.normalize)?a.normalize=l.normalize:l.normalize?i(s,l):a.normalize=ji();return}if(Cd(l)){u.push(s);return}i(s,l)}),u.forEach(function(s){t.__compiled__[t.__schemas__[s]]&&(t.__compiled__[s].validate=t.__compiled__[t.__schemas__[s]].validate,t.__compiled__[s].normalize=t.__compiled__[t.__schemas__[s]].normalize)}),t.__compiled__[""]={validate:null,normalize:ji()};const o=Object.keys(t.__compiled__).filter(function(s){return s.length>0&&t.__compiled__[s]}).map(Ed).join("|");t.re.schema_test=RegExp("(^|(?!_)(?:[><]|"+e.src_ZPCc+"))("+o+")","i"),t.re.schema_search=RegExp("(^|(?!_)(?:[><]|"+e.src_ZPCc+"))("+o+")","ig"),t.re.schema_at_start=RegExp("^"+t.re.schema_search.source,"i"),t.re.pretest=RegExp("("+t.re.schema_test.source+")|("+t.re.host_fuzzy_test.source+")|@","i"),Td(t)}function Fd(t,e){const n=t.__index__,r=t.__last_index__,u=t.__text_cache__.slice(n,r);this.schema=t.__schema__.toLowerCase(),this.index=n+e,this.lastIndex=r+e,this.raw=u,this.text=u,this.url=u}function Hr(t,e){const n=new Fd(t,e);return t.__compiled__[n.schema].normalize(n,t),n}function ie(t,e){if(!(this instanceof ie))return new ie(t,e);e||_d(t)&&(e=t,t={}),this.__opts__=$r({},zs,e),this.__index__=-1,this.__last_index__=-1,this.__schema__="",this.__text_cache__="",this.__schemas__=$r({},Sd,t),this.__compiled__={},this.__tlds__=Md,this.__tlds_replaced__=!1,this.re={},vn(this)}ie.prototype.add=function(e,n){return this.__schemas__[e]=n,vn(this),this};ie.prototype.set=function(e){return this.__opts__=$r(this.__opts__,e),this};ie.prototype.test=function(e){if(this.__text_cache__=e,this.__index__=-1,!e.length)return!1;let n,r,u,i,o,s,l,a,c;if(this.re.schema_test.test(e)){for(l=this.re.schema_search,l.lastIndex=0;(n=l.exec(e))!==null;)if(i=this.testSchemaAt(e,n[2],l.lastIndex),i){this.__schema__=n[2],this.__index__=n.index+n[1].length,this.__last_index__=n.index+n[0].length+i;break}}return this.__opts__.fuzzyLink&&this.__compiled__["http:"]&&(a=e.search(this.re.host_fuzzy_test),a>=0&&(this.__index__<0||a<this.__index__)&&(r=e.match(this.__opts__.fuzzyIP?this.re.link_fuzzy:this.re.link_no_ip_fuzzy))!==null&&(o=r.index+r[1].length,(this.__index__<0||o<this.__index__)&&(this.__schema__="",this.__index__=o,this.__last_index__=r.index+r[0].length))),this.__opts__.fuzzyEmail&&this.__compiled__["mailto:"]&&(c=e.indexOf("@"),c>=0&&(u=e.match(this.re.email_fuzzy))!==null&&(o=u.index+u[1].length,s=u.index+u[0].length,(this.__index__<0||o<this.__index__||o===this.__index__&&s>this.__last_index__)&&(this.__schema__="mailto:",this.__index__=o,this.__last_index__=s))),this.__index__>=0};ie.prototype.pretest=function(e){return this.re.pretest.test(e)};ie.prototype.testSchemaAt=function(e,n,r){return this.__compiled__[n.toLowerCase()]?this.__compiled__[n.toLowerCase()].validate(e,r,this):0};ie.prototype.match=function(e){const n=[];let r=0;this.__index__>=0&&this.__text_cache__===e&&(n.push(Hr(this,r)),r=this.__last_index__);let u=r?e.slice(r):e;for(;this.test(u);)n.push(Hr(this,r)),u=u.slice(this.__last_index__),r+=this.__last_index__;return n.length?n:null};ie.prototype.matchAtStart=function(e){if(this.__text_cache__=e,this.__index__=-1,!e.length)return null;const n=this.re.schema_at_start.exec(e);if(!n)return null;const r=this.testSchemaAt(e,n[2],n[0].length);return r?(this.__schema__=n[2],this.__index__=n.index+n[1].length,this.__last_index__=n.index+n[0].length+r,Hr(this,0)):null};ie.prototype.tlds=function(e,n){return e=Array.isArray(e)?e:[e],n?(this.__tlds__=this.__tlds__.concat(e).sort().filter(function(r,u,i){return r!==i[u-1]}).reverse(),vn(this),this):(this.__tlds__=e.slice(),this.__tlds_replaced__=!0,vn(this),this)};ie.prototype.normalize=function(e){e.schema||(e.url="http://"+e.url),e.schema==="mailto:"&&!/^mailto:/i.test(e.url)&&(e.url="mailto:"+e.url)};ie.prototype.onCompile=function(){};const mt=2147483647,be=36,ku=1,Qt=26,Nd=38,vd=700,Ps=72,Ls=128,qs="-",Id=/^xn--/,Rd=/[^\0-\x7F]/,Bd=/[\x2E\u3002\uFF0E\uFF61]/g,zd={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},mr=be-ku,xe=Math.floor,gr=String.fromCharCode;function Oe(t){throw new RangeError(zd[t])}function Pd(t,e){const n=[];let r=t.length;for(;r--;)n[r]=e(t[r]);return n}function Vs(t,e){const n=t.split("@");let r="";n.length>1&&(r=n[0]+"@",t=n[1]),t=t.replace(Bd,".");const u=t.split("."),i=Pd(u,e).join(".");return r+i}function $s(t){const e=[];let n=0;const r=t.length;for(;n<r;){const u=t.charCodeAt(n++);if(u>=55296&&u<=56319&&n<r){const i=t.charCodeAt(n++);(i&64512)==56320?e.push(((u&1023)<<10)+(i&1023)+65536):(e.push(u),n--)}else e.push(u)}return e}const Ld=t=>String.fromCodePoint(...t),qd=function(t){return t>=48&&t<58?26+(t-48):t>=65&&t<91?t-65:t>=97&&t<123?t-97:be},Ui=function(t,e){return t+22+75*(t<26)-((e!=0)<<5)},Hs=function(t,e,n){let r=0;for(t=n?xe(t/vd):t>>1,t+=xe(t/e);t>mr*Qt>>1;r+=be)t=xe(t/mr);return xe(r+(mr+1)*t/(t+Nd))},Ws=function(t){const e=[],n=t.length;let r=0,u=Ls,i=Ps,o=t.lastIndexOf(qs);o<0&&(o=0);for(let s=0;s<o;++s)t.charCodeAt(s)>=128&&Oe("not-basic"),e.push(t.charCodeAt(s));for(let s=o>0?o+1:0;s<n;){const l=r;for(let c=1,f=be;;f+=be){s>=n&&Oe("invalid-input");const d=qd(t.charCodeAt(s++));d>=be&&Oe("invalid-input"),d>xe((mt-r)/c)&&Oe("overflow"),r+=d*c;const p=f<=i?ku:f>=i+Qt?Qt:f-i;if(d<p)break;const h=be-p;c>xe(mt/h)&&Oe("overflow"),c*=h}const a=e.length+1;i=Hs(r-l,a,l==0),xe(r/a)>mt-u&&Oe("overflow"),u+=xe(r/a),r%=a,e.splice(r++,0,u)}return String.fromCodePoint(...e)},Js=function(t){const e=[];t=$s(t);const n=t.length;let r=Ls,u=0,i=Ps;for(const l of t)l<128&&e.push(gr(l));const o=e.length;let s=o;for(o&&e.push(qs);s<n;){let l=mt;for(const c of t)c>=r&&c<l&&(l=c);const a=s+1;l-r>xe((mt-u)/a)&&Oe("overflow"),u+=(l-r)*a,r=l;for(const c of t)if(c<r&&++u>mt&&Oe("overflow"),c===r){let f=u;for(let d=be;;d+=be){const p=d<=i?ku:d>=i+Qt?Qt:d-i;if(f<p)break;const h=f-p,m=be-p;e.push(gr(Ui(p+h%m,0))),f=xe(h/m)}e.push(gr(Ui(f,0))),i=Hs(u,a,s===o),u=0,++s}++u,++r}return e.join("")},Vd=function(t){return Vs(t,function(e){return Id.test(e)?Ws(e.slice(4).toLowerCase()):e})},$d=function(t){return Vs(t,function(e){return Rd.test(e)?"xn--"+Js(e):e})},js={version:"2.3.1",ucs2:{decode:$s,encode:Ld},decode:Ws,encode:Js,toASCII:$d,toUnicode:Vd},Hd={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"",highlight:null,maxNesting:100},components:{core:{},block:{},inline:{}}},Wd={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"",highlight:null,maxNesting:20},components:{core:{rules:["normalize","block","inline","text_join"]},block:{rules:["paragraph"]},inline:{rules:["text"],rules2:["balance_pairs","fragments_join"]}}},Jd={options:{html:!0,xhtmlOut:!0,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"",highlight:null,maxNesting:20},components:{core:{rules:["normalize","block","inline","text_join"]},block:{rules:["blockquote","code","fence","heading","hr","html_block","lheading","list","reference","paragraph"]},inline:{rules:["autolink","backticks","emphasis","entity","escape","html_inline","image","link","newline","text"],rules2:["balance_pairs","emphasis","fragments_join"]}}},jd={default:Hd,zero:Wd,commonmark:Jd},Ud=/^(vbscript|javascript|file|data):/,Kd=/^data:image\/(gif|png|jpeg|webp);/;function Gd(t){const e=t.trim().toLowerCase();return Ud.test(e)?Kd.test(e):!0}const Us=["http:","https:","mailto:"];function Zd(t){const e=pu(t,!0);if(e.hostname&&(!e.protocol||Us.indexOf(e.protocol)>=0))try{e.hostname=js.toASCII(e.hostname)}catch{}return un(hu(e))}function Qd(t){const e=pu(t,!0);if(e.hostname&&(!e.protocol||Us.indexOf(e.protocol)>=0))try{e.hostname=js.toUnicode(e.hostname)}catch{}return kt(hu(e),kt.defaultChars+"%")}function ce(t,e){if(!(this instanceof ce))return new ce(t,e);e||gu(t)||(e=t||{},t="default"),this.inline=new sn,this.block=new jn,this.core=new xu,this.renderer=new _t,this.linkify=new ie,this.validateLink=Gd,this.normalizeLink=Zd,this.normalizeLinkText=Qd,this.utils=Xf,this.helpers=Wn({},r0),this.options={},this.configure(t),e&&this.set(e)}ce.prototype.set=function(t){return Wn(this.options,t),this};ce.prototype.configure=function(t){const e=this;if(gu(t)){const n=t;if(t=jd[n],!t)throw new Error('Wrong `markdown-it` preset "'+n+'", check name')}if(!t)throw new Error("Wrong `markdown-it` preset, can't be empty");return t.options&&e.set(t.options),t.components&&Object.keys(t.components).forEach(function(n){t.components[n].rules&&e[n].ruler.enableOnly(t.components[n].rules),t.components[n].rules2&&e[n].ruler2.enableOnly(t.components[n].rules2)}),this};ce.prototype.enable=function(t,e){let n=[];Array.isArray(t)||(t=[t]),["core","block","inline"].forEach(function(u){n=n.concat(this[u].ruler.enable(t,!0))},this),n=n.concat(this.inline.ruler2.enable(t,!0));const r=t.filter(function(u){return n.indexOf(u)<0});if(r.length&&!e)throw new Error("MarkdownIt. Failed to enable unknown rule(s): "+r);return this};ce.prototype.disable=function(t,e){let n=[];Array.isArray(t)||(t=[t]),["core","block","inline"].forEach(function(u){n=n.concat(this[u].ruler.disable(t,!0))},this),n=n.concat(this.inline.ruler2.disable(t,!0));const r=t.filter(function(u){return n.indexOf(u)<0});if(r.length&&!e)throw new Error("MarkdownIt. Failed to disable unknown rule(s): "+r);return this};ce.prototype.use=function(t){const e=[this].concat(Array.prototype.slice.call(arguments,1));return t.apply(t,e),this};ce.prototype.parse=function(t,e){if(typeof t!="string")throw new Error("Input data should be a String");const n=new this.core.State(t,this,e);return this.core.process(n),n.tokens};ce.prototype.render=function(t,e){return e=e||{},this.renderer.render(this.parse(t,e),this.options,e)};ce.prototype.parseInline=function(t,e){const n=new this.core.State(t,this,e);return n.inlineMode=!0,this.core.process(n),n.tokens};ce.prototype.renderInline=function(t,e){return e=e||{},this.renderer.render(this.parseInline(t,e),this.options,e)};const Wr=new Ql({nodes:{doc:{content:"block+"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM(){return["p",0]}},blockquote:{content:"block+",group:"block",parseDOM:[{tag:"blockquote"}],toDOM(){return["blockquote",0]}},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM(){return["div",["hr"]]}},heading:{attrs:{level:{default:1}},content:"(text | image)*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM(t){return["h"+t.attrs.level,0]}},code_block:{content:"text*",group:"block",code:!0,defining:!0,marks:"",attrs:{params:{default:""}},parseDOM:[{tag:"pre",preserveWhitespace:"full",getAttrs:t=>({params:t.getAttribute("data-params")||""})}],toDOM(t){return["pre",t.attrs.params?{"data-params":t.attrs.params}:{},["code",0]]}},ordered_list:{content:"list_item+",group:"block",attrs:{order:{default:1},tight:{default:!1}},parseDOM:[{tag:"ol",getAttrs(t){return{order:t.hasAttribute("start")?+t.getAttribute("start"):1,tight:t.hasAttribute("data-tight")}}}],toDOM(t){return["ol",{start:t.attrs.order==1?null:t.attrs.order,"data-tight":t.attrs.tight?"true":null},0]}},bullet_list:{content:"list_item+",group:"block",attrs:{tight:{default:!1}},parseDOM:[{tag:"ul",getAttrs:t=>({tight:t.hasAttribute("data-tight")})}],toDOM(t){return["ul",{"data-tight":t.attrs.tight?"true":null},0]}},list_item:{content:"block+",defining:!0,parseDOM:[{tag:"li"}],toDOM(){return["li",0]}},text:{group:"inline"},image:{inline:!0,attrs:{src:{},alt:{default:null},title:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs(t){return{src:t.getAttribute("src"),title:t.getAttribute("title"),alt:t.getAttribute("alt")}}}],toDOM(t){return["img",t.attrs]}},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM(){return["br"]}}},marks:{em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"},{style:"font-style=normal",clearMark:t=>t.type.name=="em"}],toDOM(){return["em"]}},strong:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name=="strong"},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}],toDOM(){return["strong"]}},link:{attrs:{href:{},title:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs(t){return{href:t.getAttribute("href"),title:t.getAttribute("title")}}}],toDOM(t){return["a",t.attrs]}},code:{code:!0,parseDOM:[{tag:"code"}],toDOM(){return["code"]}}}});function Yd(t,e){if(t.isText&&e.isText&&M.sameSet(t.marks,e.marks))return t.withText(t.text+e.text)}class Xd{constructor(e,n){this.schema=e,this.tokenHandlers=n,this.stack=[{type:e.topNodeType,attrs:null,content:[],marks:M.none}]}top(){return this.stack[this.stack.length-1]}push(e){this.stack.length&&this.top().content.push(e)}addText(e){if(!e)return;let n=this.top(),r=n.content,u=r[r.length-1],i=this.schema.text(e,n.marks),o;u&&(o=Yd(u,i))?r[r.length-1]=o:r.push(i)}openMark(e){let n=this.top();n.marks=e.addToSet(n.marks)}closeMark(e){let n=this.top();n.marks=e.removeFromSet(n.marks)}parseTokens(e){for(let n=0;n<e.length;n++){let r=e[n],u=this.tokenHandlers[r.type];if(!u)throw new Error("Token type `"+r.type+"` not supported by Markdown parser");u(this,r,e,n)}}addNode(e,n,r){let u=this.top(),i=e.createAndFill(n,r,u?u.marks:[]);return i?(this.push(i),i):null}openNode(e,n){this.stack.push({type:e,attrs:n,content:[],marks:M.none})}closeNode(){let e=this.stack.pop();return this.addNode(e.type,e.attrs,e.content)}}function Tt(t,e,n,r){return t.getAttrs?t.getAttrs(e,n,r):t.attrs instanceof Function?t.attrs(e):t.attrs}function br(t,e){return t.noCloseToken||e=="code_inline"||e=="code_block"||e=="fence"}function Ki(t){return t[t.length-1]==`
`?t.slice(0,t.length-1):t}function xr(){}function eh(t,e){let n=Object.create(null);for(let r in e){let u=e[r];if(u.block){let i=t.nodeType(u.block);br(u,r)?n[r]=(o,s,l,a)=>{o.openNode(i,Tt(u,s,l,a)),o.addText(Ki(s.content)),o.closeNode()}:(n[r+"_open"]=(o,s,l,a)=>o.openNode(i,Tt(u,s,l,a)),n[r+"_close"]=o=>o.closeNode())}else if(u.node){let i=t.nodeType(u.node);n[r]=(o,s,l,a)=>o.addNode(i,Tt(u,s,l,a))}else if(u.mark){let i=t.marks[u.mark];br(u,r)?n[r]=(o,s,l,a)=>{o.openMark(i.create(Tt(u,s,l,a))),o.addText(Ki(s.content)),o.closeMark(i)}:(n[r+"_open"]=(o,s,l,a)=>o.openMark(i.create(Tt(u,s,l,a))),n[r+"_close"]=o=>o.closeMark(i))}else if(u.ignore)br(u,r)?n[r]=xr:(n[r+"_open"]=xr,n[r+"_close"]=xr);else throw new RangeError("Unrecognized parsing spec "+JSON.stringify(u))}return n.text=(r,u)=>r.addText(u.content),n.inline=(r,u)=>r.parseTokens(u.children),n.softbreak=n.softbreak||(r=>r.addText(" ")),n}class th{constructor(e,n,r){this.schema=e,this.tokenizer=n,this.tokens=r,this.tokenHandlers=eh(e,r)}parse(e,n={}){let r=new Xd(this.schema,this.tokenHandlers),u;r.parseTokens(this.tokenizer.parse(e,n));do u=r.closeNode();while(r.stack.length);return u||this.schema.topNodeType.createAndFill()}}function Gi(t,e){for(;++e<t.length;)if(t[e].type!="list_item_open")return t[e].hidden;return!1}const nh=new th(Wr,ce("commonmark",{html:!1}),{blockquote:{block:"blockquote"},paragraph:{block:"paragraph"},list_item:{block:"list_item"},bullet_list:{block:"bullet_list",getAttrs:(t,e,n)=>({tight:Gi(e,n)})},ordered_list:{block:"ordered_list",getAttrs:(t,e,n)=>({order:+t.attrGet("start")||1,tight:Gi(e,n)})},heading:{block:"heading",getAttrs:t=>({level:+t.tag.slice(1)})},code_block:{block:"code_block",noCloseToken:!0},fence:{block:"code_block",getAttrs:t=>({params:t.info||""}),noCloseToken:!0},hr:{node:"horizontal_rule"},image:{node:"image",getAttrs:t=>({src:t.attrGet("src"),title:t.attrGet("title")||null,alt:t.children[0]&&t.children[0].content||null})},hardbreak:{node:"hard_break"},em:{mark:"em"},strong:{mark:"strong"},link:{mark:"link",getAttrs:t=>({href:t.attrGet("href"),title:t.attrGet("title")||null})},code_inline:{mark:"code",noCloseToken:!0}}),rh={open:"",close:"",mixable:!0};class uh{constructor(e,n,r={}){this.nodes=e,this.marks=n,this.options=r}serialize(e,n={}){n=Object.assign({},this.options,n);let r=new sh(this.nodes,this.marks,n);return r.renderContent(e),r.out}}const ih=new uh({blockquote(t,e){t.wrapBlock("> ",null,e,()=>t.renderContent(e))},code_block(t,e){const n=e.textContent.match(/`{3,}/gm),r=n?n.sort().slice(-1)[0]+"`":"```";t.write(r+(e.attrs.params||"")+`
`),t.text(e.textContent,!1),t.write(`
`),t.write(r),t.closeBlock(e)},heading(t,e){t.write(t.repeat("#",e.attrs.level)+" "),t.renderInline(e,!1),t.closeBlock(e)},horizontal_rule(t,e){t.write(e.attrs.markup||"---"),t.closeBlock(e)},bullet_list(t,e){t.renderList(e,"  ",()=>(e.attrs.bullet||"*")+" ")},ordered_list(t,e){let n=e.attrs.order||1,r=String(n+e.childCount-1).length,u=t.repeat(" ",r+2);t.renderList(e,u,i=>{let o=String(n+i);return t.repeat(" ",r-o.length)+o+". "})},list_item(t,e){t.renderContent(e)},paragraph(t,e){t.renderInline(e),t.closeBlock(e)},image(t,e){t.write("!["+t.esc(e.attrs.alt||"")+"]("+e.attrs.src.replace(/[\(\)]/g,"\\$&")+(e.attrs.title?' "'+e.attrs.title.replace(/"/g,'\\"')+'"':"")+")")},hard_break(t,e,n,r){for(let u=r+1;u<n.childCount;u++)if(n.child(u).type!=e.type){t.write(`\\
`);return}},text(t,e){t.text(e.text,!t.inAutolink)}},{em:{open:"*",close:"*",mixable:!0,expelEnclosingWhitespace:!0},strong:{open:"**",close:"**",mixable:!0,expelEnclosingWhitespace:!0},link:{open(t,e,n,r){return t.inAutolink=oh(e,n,r),t.inAutolink?"<":"["},close(t,e,n,r){let{inAutolink:u}=t;return t.inAutolink=void 0,u?">":"]("+e.attrs.href.replace(/[\(\)"]/g,"\\$&")+(e.attrs.title?` "${e.attrs.title.replace(/"/g,'\\"')}"`:"")+")"},mixable:!0},code:{open(t,e,n,r){return Zi(n.child(r),-1)},close(t,e,n,r){return Zi(n.child(r-1),1)},escape:!1}});function Zi(t,e){let n=/`+/g,r,u=0;if(t.isText)for(;r=n.exec(t.text);)u=Math.max(u,r[0].length);let i=u>0&&e>0?" `":"`";for(let o=0;o<u;o++)i+="`";return u>0&&e<0&&(i+=" "),i}function oh(t,e,n){if(t.attrs.title||!/^\w+:/.test(t.attrs.href))return!1;let r=e.child(n);return!r.isText||r.text!=t.attrs.href||r.marks[r.marks.length-1]!=t?!1:n==e.childCount-1||!t.isInSet(e.child(n+1).marks)}class sh{constructor(e,n,r){this.nodes=e,this.marks=n,this.options=r,this.delim="",this.out="",this.closed=null,this.inAutolink=void 0,this.atBlockStart=!1,this.inTightList=!1,typeof this.options.tightLists>"u"&&(this.options.tightLists=!1),typeof this.options.hardBreakNodeName>"u"&&(this.options.hardBreakNodeName="hard_break")}flushClose(e=2){if(this.closed){if(this.atBlank()||(this.out+=`
`),e>1){let n=this.delim,r=/\s+$/.exec(n);r&&(n=n.slice(0,n.length-r[0].length));for(let u=1;u<e;u++)this.out+=n+`
`}this.closed=null}}getMark(e){let n=this.marks[e];if(!n){if(this.options.strict!==!1)throw new Error(`Mark type \`${e}\` not supported by Markdown renderer`);n=rh}return n}wrapBlock(e,n,r,u){let i=this.delim;this.write(n??e),this.delim+=e,u(),this.delim=i,this.closeBlock(r)}atBlank(){return/(^|\n)$/.test(this.out)}ensureNewLine(){this.atBlank()||(this.out+=`
`)}write(e){this.flushClose(),this.delim&&this.atBlank()&&(this.out+=this.delim),e&&(this.out+=e)}closeBlock(e){this.closed=e}text(e,n=!0){let r=e.split(`
`);for(let u=0;u<r.length;u++)this.write(),!n&&r[u][0]=="["&&/(^|[^\\])\!$/.test(this.out)&&(this.out=this.out.slice(0,this.out.length-1)+"\\!"),this.out+=n?this.esc(r[u],this.atBlockStart):r[u],u!=r.length-1&&(this.out+=`
`)}render(e,n,r){if(this.nodes[e.type.name])this.nodes[e.type.name](this,e,n,r);else{if(this.options.strict!==!1)throw new Error("Token type `"+e.type.name+"` not supported by Markdown renderer");e.type.isLeaf||(e.type.inlineContent?this.renderInline(e):this.renderContent(e),e.isBlock&&this.closeBlock(e))}}renderContent(e){e.forEach((n,r,u)=>this.render(n,e,u))}renderInline(e,n=!0){this.atBlockStart=n;let r=[],u="",i=(o,s,l)=>{let a=o?o.marks:[];o&&o.type.name===this.options.hardBreakNodeName&&(a=a.filter(m=>{if(l+1==e.childCount)return!1;let g=e.child(l+1);return m.isInSet(g.marks)&&(!g.isText||/\S/.test(g.text))}));let c=u;if(u="",o&&o.isText&&a.some(m=>{let g=this.getMark(m.type.name);return g&&g.expelEnclosingWhitespace&&!m.isInSet(r)})){let[m,g,b]=/^(\s*)(.*)$/m.exec(o.text);g&&(c+=g,o=b?o.withText(b):null,o||(a=r))}if(o&&o.isText&&a.some(m=>{let g=this.getMark(m.type.name);return g&&g.expelEnclosingWhitespace&&(l==e.childCount-1||!m.isInSet(e.child(l+1).marks))})){let[m,g,b]=/^(.*?)(\s*)$/m.exec(o.text);b&&(u=b,o=g?o.withText(g):null,o||(a=r))}let f=a.length?a[a.length-1]:null,d=f&&this.getMark(f.type.name).escape===!1,p=a.length-(d?1:0);e:for(let m=0;m<p;m++){let g=a[m];if(!this.getMark(g.type.name).mixable)break;for(let b=0;b<r.length;b++){let y=r[b];if(!this.getMark(y.type.name).mixable)break;if(g.eq(y)){m>b?a=a.slice(0,b).concat(g).concat(a.slice(b,m)).concat(a.slice(m+1,p)):b>m&&(a=a.slice(0,m).concat(a.slice(m+1,b)).concat(g).concat(a.slice(b,p)));continue e}}}let h=0;for(;h<Math.min(r.length,p)&&a[h].eq(r[h]);)++h;for(;h<r.length;)this.text(this.markString(r.pop(),!1,e,l),!1);if(c&&this.text(c),o){for(;r.length<p;){let m=a[r.length];r.push(m),this.text(this.markString(m,!0,e,l),!1),this.atBlockStart=!1}d&&o.isText?this.text(this.markString(f,!0,e,l)+o.text+this.markString(f,!1,e,l+1),!1):this.render(o,e,l),this.atBlockStart=!1}o!=null&&o.isText&&o.nodeSize>0&&(this.atBlockStart=!1)};e.forEach(i),i(null,0,e.childCount),this.atBlockStart=!1}renderList(e,n,r){this.closed&&this.closed.type==e.type?this.flushClose(3):this.inTightList&&this.flushClose(1);let u=typeof e.attrs.tight<"u"?e.attrs.tight:this.options.tightLists,i=this.inTightList;this.inTightList=u,e.forEach((o,s,l)=>{l&&u&&this.flushClose(1),this.wrapBlock(n,r(l),e,()=>this.render(o,e,l))}),this.inTightList=i}esc(e,n=!1){return e=e.replace(/[`*\\~\[\]_]/g,(r,u)=>r=="_"&&u>0&&u+1<e.length&&e[u-1].match(/\w/)&&e[u+1].match(/\w/)?r:"\\"+r),n&&(e=e.replace(/^(\+[ ]|[\-*>])/,"\\$&").replace(/^(\s*)(#{1,6})(\s|$)/,"$1\\$2$3").replace(/^(\s*\d+)\.\s/,"$1\\. ")),this.options.escapeExtraCharacters&&(e=e.replace(this.options.escapeExtraCharacters,"\\$&")),e}quote(e){let n=e.indexOf('"')==-1?'""':e.indexOf("'")==-1?"''":"()";return n[0]+e+n[1]}repeat(e,n){let r="";for(let u=0;u<n;u++)r+=e;return r}markString(e,n,r,u){let i=this.getMark(e.type.name),o=n?i.open:i.close;return typeof o=="string"?o:o(this,e,r,u)}getEnclosingWhitespace(e){return{leading:(e.match(/^(\s+)/)||[void 0])[0],trailing:(e.match(/(\s+)$/)||[void 0])[0]}}}var $e={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},In={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},lh=typeof navigator<"u"&&/Mac/.test(navigator.platform),ah=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var H=0;H<10;H++)$e[48+H]=$e[96+H]=String(H);for(var H=1;H<=24;H++)$e[H+111]="F"+H;for(var H=65;H<=90;H++)$e[H]=String.fromCharCode(H+32),In[H]=String.fromCharCode(H);for(var yr in $e)In.hasOwnProperty(yr)||(In[yr]=$e[yr]);function ch(t){var e=lh&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||ah&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",n=!e&&t.key||(t.shiftKey?In:$e)[t.keyCode]||t.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}const fh=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),dh=typeof navigator<"u"&&/Win/.test(navigator.platform);function hh(t){let e=t.split(/-(?!$)/),n=e[e.length-1];n=="Space"&&(n=" ");let r,u,i,o;for(let s=0;s<e.length-1;s++){let l=e[s];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))u=!0;else if(/^s(hift)?$/i.test(l))i=!0;else if(/^mod$/i.test(l))fh?o=!0:u=!0;else throw new Error("Unrecognized modifier name: "+l)}return r&&(n="Alt-"+n),u&&(n="Ctrl-"+n),o&&(n="Meta-"+n),i&&(n="Shift-"+n),n}function ph(t){let e=Object.create(null);for(let n in t)e[hh(n)]=t[n];return e}function kr(t,e,n=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n&&e.shiftKey&&(t="Shift-"+t),t}function Qi(t){return new ut({props:{handleKeyDown:Ks(t)}})}function Ks(t){let e=ph(t);return function(n,r){let u=ch(r),i,o=e[kr(u,r)];if(o&&o(n.state,n.dispatch,n))return!0;if(u.length==1&&u!=" "){if(r.shiftKey){let s=e[kr(u,r,!1)];if(s&&s(n.state,n.dispatch,n))return!0}if((r.altKey||r.metaKey||r.ctrlKey)&&!(dh&&r.ctrlKey&&r.altKey)&&(i=$e[r.keyCode])&&i!=u){let s=e[kr(i,r)];if(s&&s(n.state,n.dispatch,n))return!0}}return!1}}var Rn=200,q=function(){};q.prototype.append=function(e){return e.length?(e=q.from(e),!this.length&&e||e.length<Rn&&this.leafAppend(e)||this.length<Rn&&e.leafPrepend(this)||this.appendInner(e)):this};q.prototype.prepend=function(e){return e.length?q.from(e).append(this):this};q.prototype.appendInner=function(e){return new mh(this,e)};q.prototype.slice=function(e,n){return e===void 0&&(e=0),n===void 0&&(n=this.length),e>=n?q.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,n))};q.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};q.prototype.forEach=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length),n<=r?this.forEachInner(e,n,r,0):this.forEachInvertedInner(e,n,r,0)};q.prototype.map=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length);var u=[];return this.forEach(function(i,o){return u.push(e(i,o))},n,r),u};q.from=function(e){return e instanceof q?e:e&&e.length?new Gs(e):q.empty};var Gs=function(t){function e(r){t.call(this),this.values=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(u,i){return u==0&&i==this.length?this:new e(this.values.slice(u,i))},e.prototype.getInner=function(u){return this.values[u]},e.prototype.forEachInner=function(u,i,o,s){for(var l=i;l<o;l++)if(u(this.values[l],s+l)===!1)return!1},e.prototype.forEachInvertedInner=function(u,i,o,s){for(var l=i-1;l>=o;l--)if(u(this.values[l],s+l)===!1)return!1},e.prototype.leafAppend=function(u){if(this.length+u.length<=Rn)return new e(this.values.concat(u.flatten()))},e.prototype.leafPrepend=function(u){if(this.length+u.length<=Rn)return new e(u.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e}(q);q.empty=new Gs([]);var mh=function(t){function e(n,r){t.call(this),this.left=n,this.right=r,this.length=n.length+r.length,this.depth=Math.max(n.depth,r.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},e.prototype.forEachInner=function(r,u,i,o){var s=this.left.length;if(u<s&&this.left.forEachInner(r,u,Math.min(i,s),o)===!1||i>s&&this.right.forEachInner(r,Math.max(u-s,0),Math.min(this.length,i)-s,o+s)===!1)return!1},e.prototype.forEachInvertedInner=function(r,u,i,o){var s=this.left.length;if(u>s&&this.right.forEachInvertedInner(r,u-s,Math.max(i,s)-s,o+s)===!1||i<s&&this.left.forEachInvertedInner(r,Math.min(u,s),i,o)===!1)return!1},e.prototype.sliceInner=function(r,u){if(r==0&&u==this.length)return this;var i=this.left.length;return u<=i?this.left.slice(r,u):r>=i?this.right.slice(r-i,u-i):this.left.slice(r,i).append(this.right.slice(0,u-i))},e.prototype.leafAppend=function(r){var u=this.right.leafAppend(r);if(u)return new e(this.left,u)},e.prototype.leafPrepend=function(r){var u=this.left.leafPrepend(r);if(u)return new e(u,this.right)},e.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new e(this.left,new e(this.right,r)):new e(this,r)},e}(q);const gh=500;class fe{constructor(e,n){this.items=e,this.eventCount=n}popEvent(e,n){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let u,i;n&&(u=this.remapping(r,this.items.length),i=u.maps.length);let o=e.tr,s,l,a=[],c=[];return this.items.forEach((f,d)=>{if(!f.step){u||(u=this.remapping(r,d+1),i=u.maps.length),i--,c.push(f);return}if(u){c.push(new me(f.map));let p=f.step.map(u.slice(i)),h;p&&o.maybeStep(p).doc&&(h=o.mapping.maps[o.mapping.maps.length-1],a.push(new me(h,void 0,void 0,a.length+c.length))),i--,h&&u.appendMap(h,i)}else o.maybeStep(f.step);if(f.selection)return s=u?f.selection.map(u.slice(i)):f.selection,l=new fe(this.items.slice(0,r).append(c.reverse().concat(a)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:o,selection:s}}addTransform(e,n,r,u){let i=[],o=this.eventCount,s=this.items,l=!u&&s.length?s.get(s.length-1):null;for(let c=0;c<e.steps.length;c++){let f=e.steps[c].invert(e.docs[c]),d=new me(e.mapping.maps[c],f,n),p;(p=l&&l.merge(d))&&(d=p,c?i.pop():s=s.slice(0,s.length-1)),i.push(d),n&&(o++,n=void 0),u||(l=d)}let a=o-r.depth;return a>xh&&(s=bh(s,a),o-=a),new fe(s.append(i),o)}remapping(e,n){let r=new Ht;return this.items.forEach((u,i)=>{let o=u.mirrorOffset!=null&&i-u.mirrorOffset>=e?r.maps.length-u.mirrorOffset:void 0;r.appendMap(u.map,o)},e,n),r}addMaps(e){return this.eventCount==0?this:new fe(this.items.append(e.map(n=>new me(n))),this.eventCount)}rebased(e,n){if(!this.eventCount)return this;let r=[],u=Math.max(0,this.items.length-n),i=e.mapping,o=e.steps.length,s=this.eventCount;this.items.forEach(d=>{d.selection&&s--},u);let l=n;this.items.forEach(d=>{let p=i.getMirror(--l);if(p==null)return;o=Math.min(o,p);let h=i.maps[p];if(d.step){let m=e.steps[p].invert(e.docs[p]),g=d.selection&&d.selection.map(i.slice(l+1,p));g&&s++,r.push(new me(h,m,g))}else r.push(new me(h))},u);let a=[];for(let d=n;d<o;d++)a.push(new me(i.maps[d]));let c=this.items.slice(0,u).append(a).append(r),f=new fe(c,s);return f.emptyItemCount()>gh&&(f=f.compress(this.items.length-r.length)),f}emptyItemCount(){let e=0;return this.items.forEach(n=>{n.step||e++}),e}compress(e=this.items.length){let n=this.remapping(0,e),r=n.maps.length,u=[],i=0;return this.items.forEach((o,s)=>{if(s>=e)u.push(o),o.selection&&i++;else if(o.step){let l=o.step.map(n.slice(r)),a=l&&l.getMap();if(r--,a&&n.appendMap(a,r),l){let c=o.selection&&o.selection.map(n.slice(r));c&&i++;let f=new me(a.invert(),l,c),d,p=u.length-1;(d=u.length&&u[p].merge(f))?u[p]=d:u.push(f)}}else o.map&&r--},this.items.length,0),new fe(q.from(u.reverse()),i)}}fe.empty=new fe(q.empty,0);function bh(t,e){let n;return t.forEach((r,u)=>{if(r.selection&&e--==0)return n=u,!1}),t.slice(n)}class me{constructor(e,n,r,u){this.map=e,this.step=n,this.selection=r,this.mirrorOffset=u}merge(e){if(this.step&&e.step&&!e.selection){let n=e.step.merge(this.step);if(n)return new me(n.getMap().invert(),n,this.selection)}}}class Fe{constructor(e,n,r,u,i){this.done=e,this.undone=n,this.prevRanges=r,this.prevTime=u,this.prevComposition=i}}const xh=20;function yh(t,e,n,r){let u=n.getMeta(Xe),i;if(u)return u.historyState;n.getMeta(Dh)&&(t=new Fe(t.done,t.undone,null,0,-1));let o=n.getMeta("appendedTransaction");if(n.steps.length==0)return t;if(o&&o.getMeta(Xe))return o.getMeta(Xe).redo?new Fe(t.done.addTransform(n,void 0,r,yn(e)),t.undone,Yi(n.mapping.maps),t.prevTime,t.prevComposition):new Fe(t.done,t.undone.addTransform(n,void 0,r,yn(e)),null,t.prevTime,t.prevComposition);if(n.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let s=n.getMeta("composition"),l=t.prevTime==0||!o&&t.prevComposition!=s&&(t.prevTime<(n.time||0)-r.newGroupDelay||!kh(n,t.prevRanges)),a=o?Cr(t.prevRanges,n.mapping):Yi(n.mapping.maps);return new Fe(t.done.addTransform(n,l?e.selection.getBookmark():void 0,r,yn(e)),fe.empty,a,n.time,s??t.prevComposition)}else return(i=n.getMeta("rebased"))?new Fe(t.done.rebased(n,i),t.undone.rebased(n,i),Cr(t.prevRanges,n.mapping),t.prevTime,t.prevComposition):new Fe(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),Cr(t.prevRanges,n.mapping),t.prevTime,t.prevComposition)}function kh(t,e){if(!e)return!1;if(!t.docChanged)return!0;let n=!1;return t.mapping.maps[0].forEach((r,u)=>{for(let i=0;i<e.length;i+=2)r<=e[i+1]&&u>=e[i]&&(n=!0)}),n}function Yi(t){let e=[];for(let n=t.length-1;n>=0&&e.length==0;n--)t[n].forEach((r,u,i,o)=>e.push(i,o));return e}function Cr(t,e){if(!t)return null;let n=[];for(let r=0;r<t.length;r+=2){let u=e.map(t[r],1),i=e.map(t[r+1],-1);u<=i&&n.push(u,i)}return n}function Ch(t,e,n){let r=yn(e),u=Xe.get(e).spec.config,i=(n?t.undone:t.done).popEvent(e,r);if(!i)return null;let o=i.selection.resolve(i.transform.doc),s=(n?t.done:t.undone).addTransform(i.transform,e.selection.getBookmark(),u,r),l=new Fe(n?s:i.remaining,n?i.remaining:s,null,0,-1);return i.transform.setSelection(o).setMeta(Xe,{redo:n,historyState:l})}let Dr=!1,Xi=null;function yn(t){let e=t.plugins;if(Xi!=e){Dr=!1,Xi=e;for(let n=0;n<e.length;n++)if(e[n].spec.historyPreserveItems){Dr=!0;break}}return Dr}const Xe=new Vo("history"),Dh=new Vo("closeHistory");function wh(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new ut({key:Xe,state:{init(){return new Fe(fe.empty,fe.empty,null,0,-1)},apply(e,n,r){return yh(n,r,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,n){let r=n.inputType,u=r=="historyUndo"?Bn:r=="historyRedo"?Yt:null;return u?(n.preventDefault(),u(e.state,e.dispatch)):!1}}}})}function Zs(t,e){return(n,r)=>{let u=Xe.getState(n);if(!u||(t?u.undone:u.done).eventCount==0)return!1;if(r){let i=Ch(u,n,t);i&&r(e?i.scrollIntoView():i)}return!0}}const Bn=Zs(!1,!0),Yt=Zs(!0,!0),Qs=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function Eh(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("backward",t):n.parentOffset>0)?null:n}const _h=(t,e,n)=>{let r=Eh(t,n);if(!r)return!1;let u=Ys(r);if(!u){let o=r.blockRange(),s=o&&en(o);return s==null?!1:(e&&e(t.tr.lift(o,s).scrollIntoView()),!0)}let i=u.nodeBefore;if(tl(t,u,e,-1))return!0;if(r.parent.content.size==0&&(Dt(i,"end")||w.isSelectable(i)))for(let o=r.depth;;o--){let s=nu(t.doc,r.before(o),r.after(o),k.empty);if(s&&s.slice.size<s.to-s.from){if(e){let l=t.tr.step(s);l.setSelection(Dt(i,"end")?A.findFrom(l.doc.resolve(l.mapping.map(u.pos,-1)),-1):w.create(l.doc,u.pos-i.nodeSize)),e(l.scrollIntoView())}return!0}if(o==1||r.node(o-1).childCount>1)break}return i.isAtom&&u.depth==r.depth-1?(e&&e(t.tr.delete(u.pos-i.nodeSize,u.pos).scrollIntoView()),!0):!1};function Dt(t,e,n=!1){for(let r=t;r;r=e=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&r.childCount!=1)return!1}return!1}const Sh=(t,e,n)=>{let{$head:r,empty:u}=t.selection,i=r;if(!u)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):r.parentOffset>0)return!1;i=Ys(r)}let o=i&&i.nodeBefore;return!o||!w.isSelectable(o)?!1:(e&&e(t.tr.setSelection(w.create(t.doc,i.pos-o.nodeSize)).scrollIntoView()),!0)};function Ys(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function Ah(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)?null:n}const Mh=(t,e,n)=>{let r=Ah(t,n);if(!r)return!1;let u=Xs(r);if(!u)return!1;let i=u.nodeAfter;if(tl(t,u,e,1))return!0;if(r.parent.content.size==0&&(Dt(i,"start")||w.isSelectable(i))){let o=nu(t.doc,r.before(),r.after(),k.empty);if(o&&o.slice.size<o.to-o.from){if(e){let s=t.tr.step(o);s.setSelection(Dt(i,"start")?A.findFrom(s.doc.resolve(s.mapping.map(u.pos)),1):w.create(s.doc,s.mapping.map(u.pos))),e(s.scrollIntoView())}return!0}}return i.isAtom&&u.depth==r.depth-1?(e&&e(t.tr.delete(u.pos,u.pos+i.nodeSize).scrollIntoView()),!0):!1},Th=(t,e,n)=>{let{$head:r,empty:u}=t.selection,i=r;if(!u)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)return!1;i=Xs(r)}let o=i&&i.nodeAfter;return!o||!w.isSelectable(o)?!1:(e&&e(t.tr.setSelection(w.create(t.doc,i.pos)).scrollIntoView()),!0)};function Xs(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}const Jr=(t,e)=>{let n=t.selection,r=n instanceof w,u;if(r){if(n.node.isTextblock||!Et(t.doc,n.from))return!1;u=n.from}else if(u=vo(t.doc,n.from,-1),u==null)return!1;if(e){let i=t.tr.join(u);r&&i.setSelection(w.create(i.doc,u-t.doc.resolve(u).nodeBefore.nodeSize)),e(i.scrollIntoView())}return!0},Oh=(t,e)=>{let n=t.selection,r;if(n instanceof w){if(n.node.isTextblock||!Et(t.doc,n.to))return!1;r=n.to}else if(r=vo(t.doc,n.to,1),r==null)return!1;return e&&e(t.tr.join(r).scrollIntoView()),!0},jr=(t,e)=>{let{$from:n,$to:r}=t.selection,u=n.blockRange(r),i=u&&en(u);return i==null?!1:(e&&e(t.tr.lift(u,i).scrollIntoView()),!0)},Fh=(t,e)=>{let{$head:n,$anchor:r}=t.selection;return!n.parent.type.spec.code||!n.sameParent(r)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function Cu(t){for(let e=0;e<t.edgeCount;e++){let{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const el=(t,e)=>{let{$head:n,$anchor:r}=t.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let u=n.node(-1),i=n.indexAfter(-1),o=Cu(u.contentMatchAt(i));if(!o||!u.canReplaceWith(i,i,o))return!1;if(e){let s=n.after(),l=t.tr.replaceWith(s,s,o.createAndFill());l.setSelection(A.near(l.doc.resolve(s),1)),e(l.scrollIntoView())}return!0},Nh=(t,e)=>{let n=t.selection,{$from:r,$to:u}=n;if(n instanceof re||r.parent.inlineContent||u.parent.inlineContent)return!1;let i=Cu(u.parent.contentMatchAt(u.indexAfter()));if(!i||!i.isTextblock)return!1;if(e){let o=(!r.parentOffset&&u.index()<u.parent.childCount?r:u).pos,s=t.tr.insert(o,i.createAndFill());s.setSelection(T.create(s.doc,o+1)),e(s.scrollIntoView())}return!0},vh=(t,e)=>{let{$cursor:n}=t.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let i=n.before();if(dt(t.doc,i))return e&&e(t.tr.split(i).scrollIntoView()),!0}let r=n.blockRange(),u=r&&en(r);return u==null?!1:(e&&e(t.tr.lift(r,u).scrollIntoView()),!0)};function Ih(t){return(e,n)=>{let{$from:r,$to:u}=e.selection;if(e.selection instanceof w&&e.selection.node.isBlock)return!r.parentOffset||!dt(e.doc,r.pos)?!1:(n&&n(e.tr.split(r.pos).scrollIntoView()),!0);if(!r.depth)return!1;let i=[],o,s,l=!1,a=!1;for(let p=r.depth;;p--)if(r.node(p).isBlock){l=r.end(p)==r.pos+(r.depth-p),a=r.start(p)==r.pos-(r.depth-p),s=Cu(r.node(p-1).contentMatchAt(r.indexAfter(p-1))),i.unshift(l&&s?{type:s}:null),o=p;break}else{if(p==1)return!1;i.unshift(null)}let c=e.tr;(e.selection instanceof T||e.selection instanceof re)&&c.deleteSelection();let f=c.mapping.map(r.pos),d=dt(c.doc,f,i.length,i);if(d||(i[0]=s?{type:s}:null,d=dt(c.doc,f,i.length,i)),!d)return!1;if(c.split(f,i.length,i),!l&&a&&r.node(o).type!=s){let p=c.mapping.map(r.before(o)),h=c.doc.resolve(p);s&&r.node(o-1).canReplaceWith(h.index(),h.index()+1,s)&&c.setNodeMarkup(c.mapping.map(r.before(o)),s)}return n&&n(c.scrollIntoView()),!0}}const Rh=Ih(),Ur=(t,e)=>{let{$from:n,to:r}=t.selection,u,i=n.sharedDepth(r);return i==0?!1:(u=n.before(i),e&&e(t.tr.setSelection(w.create(t.doc,u))),!0)},Bh=(t,e)=>(e&&e(t.tr.setSelection(new re(t.doc))),!0);function zh(t,e,n){let r=e.nodeBefore,u=e.nodeAfter,i=e.index();return!r||!u||!r.type.compatibleContent(u.type)?!1:!r.content.size&&e.parent.canReplace(i-1,i)?(n&&n(t.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(i,i+1)||!(u.isTextblock||Et(t.doc,e.pos))?!1:(n&&n(t.tr.join(e.pos).scrollIntoView()),!0)}function tl(t,e,n,r){let u=e.nodeBefore,i=e.nodeAfter,o,s,l=u.type.spec.isolating||i.type.spec.isolating;if(!l&&zh(t,e,n))return!0;let a=!l&&e.parent.canReplace(e.index(),e.index()+1);if(a&&(o=(s=u.contentMatchAt(u.childCount)).findWrapping(i.type))&&s.matchType(o[0]||i.type).validEnd){if(n){let p=e.pos+i.nodeSize,h=x.empty;for(let b=o.length-1;b>=0;b--)h=x.from(o[b].create(null,h));h=x.from(u.copy(h));let m=t.tr.step(new W(e.pos-1,p,e.pos,p,new k(h,1,0),o.length,!0)),g=m.doc.resolve(p+2*o.length);g.nodeAfter&&g.nodeAfter.type==u.type&&Et(m.doc,g.pos)&&m.join(g.pos),n(m.scrollIntoView())}return!0}let c=i.type.spec.isolating||r>0&&l?null:A.findFrom(e,1),f=c&&c.$from.blockRange(c.$to),d=f&&en(f);if(d!=null&&d>=e.depth)return n&&n(t.tr.lift(f,d).scrollIntoView()),!0;if(a&&Dt(i,"start",!0)&&Dt(u,"end")){let p=u,h=[];for(;h.push(p),!p.isTextblock;)p=p.lastChild;let m=i,g=1;for(;!m.isTextblock;m=m.firstChild)g++;if(p.canReplace(p.childCount,p.childCount,m.content)){if(n){let b=x.empty;for(let C=h.length-1;C>=0;C--)b=x.from(h[C].copy(b));let y=t.tr.step(new W(e.pos-h.length,e.pos+i.nodeSize,e.pos+g,e.pos+i.nodeSize-g,new k(b,h.length,0),0,!0));n(y.scrollIntoView())}return!0}}return!1}function nl(t){return function(e,n){let r=e.selection,u=t<0?r.$from:r.$to,i=u.depth;for(;u.node(i).isInline;){if(!i)return!1;i--}return u.node(i).isTextblock?(n&&n(e.tr.setSelection(T.create(e.doc,t<0?u.start(i):u.end(i)))),!0):!1}}const Ph=nl(-1),Lh=nl(1);function Kr(t,e=null){return function(n,r){let{$from:u,$to:i}=n.selection,o=u.blockRange(i),s=o&&tu(o,t,e);return s?(r&&r(n.tr.wrap(o,s).scrollIntoView()),!0):!1}}function kn(t,e=null){return function(n,r){let u=!1;for(let i=0;i<n.selection.ranges.length&&!u;i++){let{$from:{pos:o},$to:{pos:s}}=n.selection.ranges[i];n.doc.nodesBetween(o,s,(l,a)=>{if(u)return!1;if(!(!l.isTextblock||l.hasMarkup(t,e)))if(l.type==t)u=!0;else{let c=n.doc.resolve(a),f=c.index();u=c.parent.canReplaceWith(f,f+1,t)}})}if(!u)return!1;if(r){let i=n.tr;for(let o=0;o<n.selection.ranges.length;o++){let{$from:{pos:s},$to:{pos:l}}=n.selection.ranges[o];i.setBlockType(s,l,t,e)}r(i.scrollIntoView())}return!0}}function qh(t,e,n,r){for(let u=0;u<e.length;u++){let{$from:i,$to:o}=e[u],s=i.depth==0?t.inlineContent&&t.type.allowsMarkType(n):!1;if(t.nodesBetween(i.pos,o.pos,(l,a)=>{if(s)return!1;s=l.inlineContent&&l.type.allowsMarkType(n)}),s)return!0}return!1}function de(t,e=null,n){return function(r,u){let{empty:i,$cursor:o,ranges:s}=r.selection;if(i&&!o||!qh(r.doc,s,t))return!1;if(u)if(o)t.isInSet(r.storedMarks||o.marks())?u(r.tr.removeStoredMark(t)):u(r.tr.addStoredMark(t.create(e)));else{let l,a=r.tr;l=!s.some(c=>r.doc.rangeHasMark(c.$from.pos,c.$to.pos,t));for(let c=0;c<s.length;c++){let{$from:f,$to:d}=s[c];if(!l)a.removeMark(f.pos,d.pos,t);else{let p=f.pos,h=d.pos,m=f.nodeAfter,g=d.nodeBefore,b=m&&m.isText?/^\s*/.exec(m.text)[0].length:0,y=g&&g.isText?/\s*$/.exec(g.text)[0].length:0;p+b<h&&(p+=b,h-=y),a.addMark(p,h,t.create(e))}}u(a.scrollIntoView())}return!0}}function Kn(...t){return function(e,n,r){for(let u=0;u<t.length;u++)if(t[u](e,n,r))return!0;return!1}}let wr=Kn(Qs,_h,Sh),eo=Kn(Qs,Mh,Th);const _e={Enter:Kn(Fh,Nh,vh,Rh),"Mod-Enter":el,Backspace:wr,"Mod-Backspace":wr,"Shift-Backspace":wr,Delete:eo,"Mod-Delete":eo,"Mod-a":Bh},rl={"Ctrl-h":_e.Backspace,"Alt-Backspace":_e["Mod-Backspace"],"Ctrl-d":_e.Delete,"Ctrl-Alt-Backspace":_e["Mod-Delete"],"Alt-Delete":_e["Mod-Delete"],"Alt-d":_e["Mod-Delete"],"Ctrl-a":Ph,"Ctrl-e":Lh};for(let t in _e)rl[t]=_e[t];const Vh=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform?os.platform()=="darwin":!1,$h=Vh?rl:_e;function Hh(t={}){return new ut({view(e){return new Wh(e,t)}})}class Wh{constructor(e,n){var r;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(r=n.width)!==null&&r!==void 0?r:1,this.color=n.color===!1?void 0:n.color||"black",this.class=n.class,this.handlers=["dragover","dragend","drop","dragleave"].map(u=>{let i=o=>{this[u](o)};return e.dom.addEventListener(u,i),{name:u,handler:i}})}destroy(){this.handlers.forEach(({name:e,handler:n})=>this.editorView.dom.removeEventListener(e,n))}update(e,n){this.cursorPos!=null&&n.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),n=!e.parent.inlineContent,r,u=this.editorView.dom,i=u.getBoundingClientRect(),o=i.width/u.offsetWidth,s=i.height/u.offsetHeight;if(n){let f=e.nodeBefore,d=e.nodeAfter;if(f||d){let p=this.editorView.nodeDOM(this.cursorPos-(f?f.nodeSize:0));if(p){let h=p.getBoundingClientRect(),m=f?h.bottom:h.top;f&&d&&(m=(m+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let g=this.width/2*s;r={left:h.left,right:h.right,top:m-g,bottom:m+g}}}}if(!r){let f=this.editorView.coordsAtPos(this.cursorPos),d=this.width/2*o;r={left:f.left-d,right:f.left+d,top:f.top,bottom:f.bottom}}let l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n);let a,c;if(!l||l==document.body&&getComputedStyle(l).position=="static")a=-pageXOffset,c=-pageYOffset;else{let f=l.getBoundingClientRect(),d=f.width/l.offsetWidth,p=f.height/l.offsetHeight;a=f.left-l.scrollLeft*d,c=f.top-l.scrollTop*p}this.element.style.left=(r.left-a)/o+"px",this.element.style.top=(r.top-c)/s+"px",this.element.style.width=(r.right-r.left)/o+"px",this.element.style.height=(r.bottom-r.top)/s+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let n=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),r=n&&n.inside>=0&&this.editorView.state.doc.nodeAt(n.inside),u=r&&r.type.spec.disableDropCursor,i=typeof u=="function"?u(this.editorView,n,e):u;if(n&&!i){let o=n.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let s=Io(this.editorView.state.doc,o,this.editorView.dragging.slice);s!=null&&(o=s)}this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}class v extends A{constructor(e){super(e,e)}map(e,n){let r=e.resolve(n.map(this.head));return v.valid(r)?new v(r):A.near(r)}content(){return k.empty}eq(e){return e instanceof v&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new v(e.resolve(n.pos))}getBookmark(){return new Du(this.anchor)}static valid(e){let n=e.parent;if(n.isTextblock||!Jh(e)||!jh(e))return!1;let r=n.type.spec.allowGapCursor;if(r!=null)return r;let u=n.contentMatchAt(e.index()).defaultType;return u&&u.isTextblock}static findGapCursorFrom(e,n,r=!1){e:for(;;){if(!r&&v.valid(e))return e;let u=e.pos,i=null;for(let o=e.depth;;o--){let s=e.node(o);if(n>0?e.indexAfter(o)<s.childCount:e.index(o)>0){i=s.child(n>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;u+=n;let l=e.doc.resolve(u);if(v.valid(l))return l}for(;;){let o=n>0?i.firstChild:i.lastChild;if(!o){if(i.isAtom&&!i.isText&&!w.isSelectable(i)){e=e.doc.resolve(u+i.nodeSize*n),r=!1;continue e}break}i=o,u+=n;let s=e.doc.resolve(u);if(v.valid(s))return s}return null}}}v.prototype.visible=!1;v.findFrom=v.findGapCursorFrom;A.jsonID("gapcursor",v);class Du{constructor(e){this.pos=e}map(e){return new Du(e.map(this.pos))}resolve(e){let n=e.resolve(this.pos);return v.valid(n)?new v(n):A.near(n)}}function Jh(t){for(let e=t.depth;e>=0;e--){let n=t.index(e),r=t.node(e);if(n==0){if(r.type.spec.isolating)return!0;continue}for(let u=r.child(n-1);;u=u.lastChild){if(u.childCount==0&&!u.inlineContent||u.isAtom||u.type.spec.isolating)return!0;if(u.inlineContent)return!1}}return!0}function jh(t){for(let e=t.depth;e>=0;e--){let n=t.indexAfter(e),r=t.node(e);if(n==r.childCount){if(r.type.spec.isolating)return!0;continue}for(let u=r.child(n);;u=u.firstChild){if(u.childCount==0&&!u.inlineContent||u.isAtom||u.type.spec.isolating)return!0;if(u.inlineContent)return!1}}return!0}function Uh(){return new ut({props:{decorations:Qh,createSelectionBetween(t,e,n){return e.pos==n.pos&&v.valid(n)?new v(n):null},handleClick:Gh,handleKeyDown:Kh,handleDOMEvents:{beforeinput:Zh}}})}const Kh=Ks({ArrowLeft:hn("horiz",-1),ArrowRight:hn("horiz",1),ArrowUp:hn("vert",-1),ArrowDown:hn("vert",1)});function hn(t,e){const n=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(r,u,i){let o=r.selection,s=e>0?o.$to:o.$from,l=o.empty;if(o instanceof T){if(!i.endOfTextblock(n)||s.depth==0)return!1;l=!1,s=r.doc.resolve(e>0?s.after():s.before())}let a=v.findGapCursorFrom(s,e,l);return a?(u&&u(r.tr.setSelection(new v(a))),!0):!1}}function Gh(t,e,n){if(!t||!t.editable)return!1;let r=t.state.doc.resolve(e);if(!v.valid(r))return!1;let u=t.posAtCoords({left:n.clientX,top:n.clientY});return u&&u.inside>-1&&w.isSelectable(t.state.doc.nodeAt(u.inside))?!1:(t.dispatch(t.state.tr.setSelection(new v(r))),!0)}function Zh(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof v))return!1;let{$from:n}=t.state.selection,r=n.parent.contentMatchAt(n.index()).findWrapping(t.state.schema.nodes.text);if(!r)return!1;let u=x.empty;for(let o=r.length-1;o>=0;o--)u=x.from(r[o].createAndFill(null,u));let i=t.state.tr.replace(n.pos,n.pos,new k(u,0,0));return i.setSelection(T.near(i.doc.resolve(n.pos+1))),t.dispatch(i),!1}function Qh(t){if(!(t.selection instanceof v))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",B.create(t.doc,[le.widget(t.selection.head,e,{key:"gapcursor"})])}function ue(){var t=arguments[0];typeof t=="string"&&(t=document.createElement(t));var e=1,n=arguments[1];if(n&&typeof n=="object"&&n.nodeType==null&&!Array.isArray(n)){for(var r in n)if(Object.prototype.hasOwnProperty.call(n,r)){var u=n[r];typeof u=="string"?t.setAttribute(r,u):u!=null&&(t[r]=u)}e++}for(;e<arguments.length;e++)ul(t,arguments[e]);return t}function ul(t,e){if(typeof e=="string")t.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)t.appendChild(e);else if(Array.isArray(e))for(var n=0;n<e.length;n++)ul(t,e[n]);else throw new RangeError("Unsupported child node: "+e)}const zt="http://www.w3.org/2000/svg",Yh="http://www.w3.org/1999/xlink",Gr="ProseMirror-icon";function Xh(t){let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n)|0;return e}function ep(t,e){let n=(t.nodeType==9?t:t.ownerDocument)||document,r=n.createElement("div");if(r.className=Gr,e.path){let{path:u,width:i,height:o}=e,s="pm-icon-"+Xh(u).toString(16);n.getElementById(s)||tp(t,s,e);let l=r.appendChild(n.createElementNS(zt,"svg"));l.style.width=i/o+"em",l.appendChild(n.createElementNS(zt,"use")).setAttributeNS(Yh,"href",/([^#]*)/.exec(n.location.toString())[1]+"#"+s)}else if(e.dom)r.appendChild(e.dom.cloneNode(!0));else{let{text:u,css:i}=e;r.appendChild(n.createElement("span")).textContent=u||"",i&&(r.firstChild.style.cssText=i)}return r}function tp(t,e,n){let[r,u]=t.nodeType==9?[t,t.body]:[t.ownerDocument||document,t],i=r.getElementById(Gr+"-collection");i||(i=r.createElementNS(zt,"svg"),i.id=Gr+"-collection",i.style.display="none",u.insertBefore(i,u.firstChild));let o=r.createElementNS(zt,"symbol");o.id=e,o.setAttribute("viewBox","0 0 "+n.width+" "+n.height),o.appendChild(r.createElementNS(zt,"path")).setAttribute("d",n.path),i.appendChild(o)}const X="ProseMirror-menu";class Y{constructor(e){this.spec=e}render(e){let n=this.spec,r=n.render?n.render(e):n.icon?ep(e.root,n.icon):n.label?ue("div",null,Xt(e,n.label)):null;if(!r)throw new RangeError("MenuItem without icon or label property");if(n.title){const i=typeof n.title=="function"?n.title(e.state):n.title;r.setAttribute("title",Xt(e,i))}n.class&&r.classList.add(n.class),n.css&&(r.style.cssText+=n.css),r.addEventListener("mousedown",i=>{i.preventDefault(),r.classList.contains(X+"-disabled")||n.run(e.state,e.dispatch,e,i)});function u(i){if(n.select){let s=n.select(i);if(r.style.display=s?"":"none",!s)return!1}let o=!0;if(n.enable&&(o=n.enable(i)||!1,Zr(r,X+"-disabled",!o)),n.active){let s=o&&n.active(i)||!1;Zr(r,X+"-active",s)}return!0}return{dom:r,update:u}}}function Xt(t,e){return t._props.translate?t._props.translate(e):e}let Pt={time:0,node:null};function il(t){Pt.time=Date.now(),Pt.node=t.target}function ol(t){return Date.now()-100<Pt.time&&Pt.node&&t.contains(Pt.node)}class zn{constructor(e,n={}){this.options=n,this.options=n||{},this.content=Array.isArray(e)?e:[e]}render(e){let n=sl(this.content,e),r=e.dom.ownerDocument.defaultView||window,u=ue("div",{class:X+"-dropdown "+(this.options.class||""),style:this.options.css},Xt(e,this.options.label||""));this.options.title&&u.setAttribute("title",Xt(e,this.options.title));let i=ue("div",{class:X+"-dropdown-wrap"},u),o=null,s=null,l=()=>{o&&o.close()&&(o=null,r.removeEventListener("mousedown",s))};u.addEventListener("mousedown",c=>{c.preventDefault(),il(c),o?l():(o=this.expand(i,n.dom),r.addEventListener("mousedown",s=()=>{ol(i)||l()}))});function a(c){let f=n.update(c);return i.style.display=f?"":"none",f}return{dom:i,update:a}}expand(e,n){let r=ue("div",{class:X+"-dropdown-menu "+(this.options.class||"")},n),u=!1;function i(){return u?!1:(u=!0,e.removeChild(r),!0)}return e.appendChild(r),{close:i,node:r}}}function sl(t,e){let n=[],r=[];for(let u=0;u<t.length;u++){let{dom:i,update:o}=t[u].render(e);n.push(ue("div",{class:X+"-dropdown-item"},i)),r.push(o)}return{dom:n,update:ll(r,n)}}function ll(t,e){return n=>{let r=!1;for(let u=0;u<t.length;u++){let i=t[u](n);e[u].style.display=i?"":"none",i&&(r=!0)}return r}}class al{constructor(e,n={}){this.options=n,this.content=Array.isArray(e)?e:[e]}render(e){let n=sl(this.content,e),r=e.dom.ownerDocument.defaultView||window,u=ue("div",{class:X+"-submenu-label"},Xt(e,this.options.label||"")),i=ue("div",{class:X+"-submenu-wrap"},u,ue("div",{class:X+"-submenu"},n.dom)),o=null;u.addEventListener("mousedown",l=>{l.preventDefault(),il(l),Zr(i,X+"-submenu-wrap-active",!1),o||r.addEventListener("mousedown",o=()=>{ol(i)||(i.classList.remove(X+"-submenu-wrap-active"),r.removeEventListener("mousedown",o),o=null)})});function s(l){let a=n.update(l);return i.style.display=a?"":"none",a}return{dom:i,update:s}}}function to(t,e){let n=document.createDocumentFragment(),r=[],u=[];for(let o=0;o<e.length;o++){let s=e[o],l=[],a=[];for(let c=0;c<s.length;c++){let{dom:f,update:d}=s[c].render(t),p=ue("span",{class:X+"item"},f);n.appendChild(p),a.push(p),l.push(d)}l.length&&(r.push(ll(l,a)),o<e.length-1&&u.push(n.appendChild(np())))}function i(o){let s=!1,l=!1;for(let a=0;a<r.length;a++){let c=r[a](o);a&&(u[a-1].style.display=l&&c?"":"none"),l=c,c&&(s=!0)}return s}return{dom:n,update:i}}function np(){return ue("span",{class:X+"separator"})}const z={join:{width:800,height:900,path:"M0 75h800v125h-800z M0 825h800v-125h-800z M250 400h100v-100h100v100h100v100h-100v100h-100v-100h-100z"},lift:{width:1024,height:1024,path:"M219 310v329q0 7-5 12t-12 5q-8 0-13-5l-164-164q-5-5-5-13t5-13l164-164q5-5 13-5 7 0 12 5t5 12zM1024 749v109q0 7-5 12t-12 5h-987q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h987q7 0 12 5t5 12zM1024 530v109q0 7-5 12t-12 5h-621q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h621q7 0 12 5t5 12zM1024 310v109q0 7-5 12t-12 5h-621q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h621q7 0 12 5t5 12zM1024 91v109q0 7-5 12t-12 5h-987q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h987q7 0 12 5t5 12z"},selectParentNode:{text:"",css:"font-weight: bold"},undo:{width:1024,height:1024,path:"M761 1024c113-206 132-520-313-509v253l-384-384 384-384v248c534-13 594 472 313 775z"},redo:{width:1024,height:1024,path:"M576 248v-248l384 384-384 384v-253c-446-10-427 303-313 509-280-303-221-789 313-775z"},strong:{width:805,height:1024,path:"M317 869q42 18 80 18 214 0 214-191 0-65-23-102-15-25-35-42t-38-26-46-14-48-6-54-1q-41 0-57 5 0 30-0 90t-0 90q0 4-0 38t-0 55 2 47 6 38zM309 442q24 4 62 4 46 0 81-7t62-25 42-51 14-81q0-40-16-70t-45-46-61-24-70-8q-28 0-74 7 0 28 2 86t2 86q0 15-0 45t-0 45q0 26 0 39zM0 950l1-53q8-2 48-9t60-15q4-6 7-15t4-19 3-18 1-21 0-19v-37q0-561-12-585-2-4-12-8t-25-6-28-4-27-2-17-1l-2-47q56-1 194-6t213-5q13 0 39 0t38 0q40 0 78 7t73 24 61 40 42 59 16 78q0 29-9 54t-22 41-36 32-41 25-48 22q88 20 146 76t58 141q0 57-20 102t-53 74-78 48-93 27-100 8q-25 0-75-1t-75-1q-60 0-175 6t-132 6z"},em:{width:585,height:1024,path:"M0 949l9-48q3-1 46-12t63-21q16-20 23-57 0-4 35-165t65-310 29-169v-14q-13-7-31-10t-39-4-33-3l10-58q18 1 68 3t85 4 68 1q27 0 56-1t69-4 56-3q-2 22-10 50-17 5-58 16t-62 19q-4 10-8 24t-5 22-4 26-3 24q-15 84-50 239t-44 203q-1 5-7 33t-11 51-9 47-3 32l0 10q9 2 105 17-1 25-9 56-6 0-18 0t-18 0q-16 0-49-5t-49-5q-78-1-117-1-29 0-81 5t-69 6z"},code:{width:896,height:1024,path:"M608 192l-96 96 224 224-224 224 96 96 288-320-288-320zM288 192l-288 320 288 320 96-96-224-224 224-224-96-96z"},link:{width:951,height:1024,path:"M832 694q0-22-16-38l-118-118q-16-16-38-16-24 0-41 18 1 1 10 10t12 12 8 10 7 14 2 15q0 22-16 38t-38 16q-8 0-15-2t-14-7-10-8-12-12-10-10q-18 17-18 41 0 22 16 38l117 118q15 15 38 15 22 0 38-14l84-83q16-16 16-38zM430 292q0-22-16-38l-117-118q-16-16-38-16-22 0-38 15l-84 83q-16 16-16 38 0 22 16 38l118 118q15 15 38 15 24 0 41-17-1-1-10-10t-12-12-8-10-7-14-2-15q0-22 16-38t38-16q8 0 15 2t14 7 10 8 12 12 10 10q18-17 18-41zM941 694q0 68-48 116l-84 83q-47 47-116 47-69 0-116-48l-117-118q-47-47-47-116 0-70 50-119l-50-50q-49 50-118 50-68 0-116-48l-118-118q-48-48-48-116t48-116l84-83q47-47 116-47 69 0 116 48l117 118q47 47 47 116 0 70-50 119l50 50q49-50 118-50 68 0 116 48l118 118q48 48 48 116z"},bulletList:{width:768,height:896,path:"M0 512h128v-128h-128v128zM0 256h128v-128h-128v128zM0 768h128v-128h-128v128zM256 512h512v-128h-512v128zM256 256h512v-128h-512v128zM256 768h512v-128h-512v128z"},orderedList:{width:768,height:896,path:"M320 512h448v-128h-448v128zM320 768h448v-128h-448v128zM320 128v128h448v-128h-448zM79 384h78v-256h-36l-85 23v50l43-2v185zM189 590c0-36-12-78-96-78-33 0-64 6-83 16l1 66c21-10 42-15 67-15s32 11 32 28c0 26-30 58-110 112v50h192v-67l-91 2c49-30 87-66 87-113l1-1z"},blockquote:{width:640,height:896,path:"M0 448v256h256v-256h-128c0 0 0-128 128-128v-128c0 0-256 0-256 256zM640 320v-128c0 0-256 0-256 256v256h256v-256h-128c0 0 0-128 128-128z"}},cl=new Y({title:"Join with above block",run:Jr,select:t=>Jr(t),icon:z.join}),fl=new Y({title:"Lift out of enclosing block",run:jr,select:t=>jr(t),icon:z.lift}),dl=new Y({title:"Select parent node",run:Ur,select:t=>Ur(t),icon:z.selectParentNode});let hl=new Y({title:"Undo last change",run:Bn,enable:t=>Bn(t),icon:z.undo}),pl=new Y({title:"Redo last undone change",run:Yt,enable:t=>Yt(t),icon:z.redo});function ml(t,e){let n={run(r,u){return Kr(t,e.attrs)(r,u)},select(r){return Kr(t,e.attrs)(r)}};for(let r in e)n[r]=e[r];return new Y(n)}function gt(t,e){let n=kn(t,e.attrs),r={run:n,enable(u){return n(u)},active(u){let{$from:i,to:o,node:s}=u.selection;return s?s.hasMarkup(t,e.attrs):o<=i.end()&&i.parent.hasMarkup(t,e.attrs)}};for(let u in e)r[u]=e[u];return new Y(r)}function Zr(t,e,n){n?t.classList.add(e):t.classList.remove(e)}const pn="ProseMirror-menubar";function rp(){if(typeof navigator>"u")return!1;let t=navigator.userAgent;return!/Edge\/\d/.test(t)&&/AppleWebKit/.test(t)&&/Mobile\/\w+/.test(t)}function up(t){return new ut({view(e){return new ip(e,t)}})}class ip{constructor(e,n){this.editorView=e,this.options=n,this.spacer=null,this.maxHeight=0,this.widthForMaxHeight=0,this.floating=!1,this.scrollHandler=null,this.root=e.root,this.wrapper=ue("div",{class:pn+"-wrapper"}),this.menu=this.wrapper.appendChild(ue("div",{class:pn})),this.menu.className=pn,e.dom.parentNode&&e.dom.parentNode.replaceChild(this.wrapper,e.dom),this.wrapper.appendChild(e.dom);let{dom:r,update:u}=to(this.editorView,this.options.content);if(this.contentUpdate=u,this.menu.appendChild(r),this.update(),n.floating&&!rp()){this.updateFloat();let i=lp(this.wrapper);this.scrollHandler=o=>{let s=this.editorView.root;(s.body||s).contains(this.wrapper)?this.updateFloat(o.target.getBoundingClientRect?o.target:void 0):i.forEach(l=>l.removeEventListener("scroll",this.scrollHandler))},i.forEach(o=>o.addEventListener("scroll",this.scrollHandler))}}update(){if(this.editorView.root!=this.root){let{dom:e,update:n}=to(this.editorView,this.options.content);this.contentUpdate=n,this.menu.replaceChild(e,this.menu.firstChild),this.root=this.editorView.root}this.contentUpdate(this.editorView.state),this.floating?this.updateScrollCursor():(this.menu.offsetWidth!=this.widthForMaxHeight&&(this.widthForMaxHeight=this.menu.offsetWidth,this.maxHeight=0),this.menu.offsetHeight>this.maxHeight&&(this.maxHeight=this.menu.offsetHeight,this.menu.style.minHeight=this.maxHeight+"px"))}updateScrollCursor(){let e=this.editorView.root.getSelection();if(!e.focusNode)return;let n=e.getRangeAt(0).getClientRects(),r=n[op(e)?0:n.length-1];if(!r)return;let u=this.menu.getBoundingClientRect();if(r.top<u.bottom&&r.bottom>u.top){let i=sp(this.wrapper);i&&(i.scrollTop-=u.bottom-r.top)}}updateFloat(e){let n=this.wrapper,r=n.getBoundingClientRect(),u=e?Math.max(0,e.getBoundingClientRect().top):0;if(this.floating)if(r.top>=u||r.bottom<this.menu.offsetHeight+10)this.floating=!1,this.menu.style.position=this.menu.style.left=this.menu.style.top=this.menu.style.width="",this.menu.style.display="",this.spacer.parentNode.removeChild(this.spacer),this.spacer=null;else{let i=(n.offsetWidth-n.clientWidth)/2;this.menu.style.left=r.left+i+"px",this.menu.style.display=r.top>(this.editorView.dom.ownerDocument.defaultView||window).innerHeight?"none":"",e&&(this.menu.style.top=u+"px")}else if(r.top<u&&r.bottom>=this.menu.offsetHeight+10){this.floating=!0;let i=this.menu.getBoundingClientRect();this.menu.style.left=i.left+"px",this.menu.style.width=i.width+"px",e&&(this.menu.style.top=u+"px"),this.menu.style.position="fixed",this.spacer=ue("div",{class:pn+"-spacer",style:`height: ${i.height}px`}),n.insertBefore(this.spacer,this.menu)}}destroy(){this.wrapper.parentNode&&this.wrapper.parentNode.replaceChild(this.editorView.dom,this.wrapper)}}function op(t){return t.anchorNode==t.focusNode?t.anchorOffset>t.focusOffset:t.anchorNode.compareDocumentPosition(t.focusNode)==Node.DOCUMENT_POSITION_FOLLOWING}function sp(t){for(let e=t.parentNode;e;e=e.parentNode)if(e.scrollHeight>e.clientHeight)return e}function lp(t){let e=[t.ownerDocument.defaultView||window];for(let n=t.parentNode;n;n=n.parentNode)e.push(n);return e}function Pn(t,e=null){return function(n,r){let{$from:u,$to:i}=n.selection,o=u.blockRange(i);if(!o)return!1;let s=r?n.tr:null;return ap(s,o,t,e)?(r&&r(s.scrollIntoView()),!0):!1}}function ap(t,e,n,r=null){let u=!1,i=e,o=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(n)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let l=o.resolve(e.start-2);i=new En(l,l,e.depth),e.endIndex<e.parent.childCount&&(e=new En(e.$from,o.resolve(e.$to.end(e.depth)),e.depth)),u=!0}let s=tu(i,n,r,e);return s?(t&&cp(t,e,s,u,n),!0):!1}function cp(t,e,n,r,u){let i=x.empty;for(let c=n.length-1;c>=0;c--)i=x.from(n[c].type.create(n[c].attrs,i));t.step(new W(e.start-(r?2:0),e.end,e.start,e.end,new k(i,0,0),n.length,!0));let o=0;for(let c=0;c<n.length;c++)n[c].type==u&&(o=c+1);let s=n.length-o,l=e.start+n.length-(r?2:0),a=e.parent;for(let c=e.startIndex,f=e.endIndex,d=!0;c<f;c++,d=!1)!d&&dt(t.doc,l,s)&&(t.split(l,s),l+=2*s),l+=a.child(c).nodeSize;return t}function fp(t,e){return function(n,r){let{$from:u,$to:i,node:o}=n.selection;if(o&&o.isBlock||u.depth<2||!u.sameParent(i))return!1;let s=u.node(-1);if(s.type!=t)return!1;if(u.parent.content.size==0&&u.node(-1).childCount==u.indexAfter(-1)){if(u.depth==3||u.node(-3).type!=t||u.index(-2)!=u.node(-2).childCount-1)return!1;if(r){let f=x.empty,d=u.index(-1)?1:u.index(-2)?2:3;for(let b=u.depth-d;b>=u.depth-3;b--)f=x.from(u.node(b).copy(f));let p=u.indexAfter(-1)<u.node(-2).childCount?1:u.indexAfter(-2)<u.node(-3).childCount?2:3;f=f.append(x.from(t.createAndFill()));let h=u.before(u.depth-(d-1)),m=n.tr.replace(h,u.after(-p),new k(f,4-d,0)),g=-1;m.doc.nodesBetween(h,m.doc.content.size,(b,y)=>{if(g>-1)return!1;b.isTextblock&&b.content.size==0&&(g=y+1)}),g>-1&&m.setSelection(A.near(m.doc.resolve(g))),r(m.scrollIntoView())}return!0}let l=i.pos==u.end()?s.contentMatchAt(0).defaultType:null,a=n.tr.delete(u.pos,i.pos),c=l?[null,{type:l}]:void 0;return dt(a.doc,u.pos,2,c)?(r&&r(a.split(u.pos,2,c).scrollIntoView()),!0):!1}}function dp(t){return function(e,n){let{$from:r,$to:u}=e.selection,i=r.blockRange(u,o=>o.childCount>0&&o.firstChild.type==t);return i?n?r.node(i.depth-1).type==t?hp(e,n,t,i):pp(e,n,i):!0:!1}}function hp(t,e,n,r){let u=t.tr,i=r.end,o=r.$to.end(r.depth);i<o&&(u.step(new W(i-1,o,i,o,new k(x.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new En(u.doc.resolve(r.$from.pos),u.doc.resolve(o),r.depth));const s=en(r);if(s==null)return!1;u.lift(r,s);let l=u.doc.resolve(u.mapping.map(i,-1)-1);return Et(u.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&u.join(l.pos),e(u.scrollIntoView()),!0}function pp(t,e,n){let r=t.tr,u=n.parent;for(let p=n.end,h=n.endIndex-1,m=n.startIndex;h>m;h--)p-=u.child(h).nodeSize,r.delete(p-1,p+1);let i=r.doc.resolve(n.start),o=i.nodeAfter;if(r.mapping.map(n.end)!=n.start+i.nodeAfter.nodeSize)return!1;let s=n.startIndex==0,l=n.endIndex==u.childCount,a=i.node(-1),c=i.index(-1);if(!a.canReplace(c+(s?0:1),c+1,o.content.append(l?x.empty:x.from(u))))return!1;let f=i.pos,d=f+o.nodeSize;return r.step(new W(f-(s?1:0),d+(l?1:0),f+1,d-1,new k((s?x.empty:x.from(u.copy(x.empty))).append(l?x.empty:x.from(u.copy(x.empty))),s?0:1,l?0:1),s?0:1)),e(r.scrollIntoView()),!0}function mp(t){return function(e,n){let{$from:r,$to:u}=e.selection,i=r.blockRange(u,a=>a.childCount>0&&a.firstChild.type==t);if(!i)return!1;let o=i.startIndex;if(o==0)return!1;let s=i.parent,l=s.child(o-1);if(l.type!=t)return!1;if(n){let a=l.lastChild&&l.lastChild.type==s.type,c=x.from(a?t.create():null),f=new k(x.from(t.create(null,x.from(s.type.create(null,c)))),a?3:1,0),d=i.start,p=i.end;n(e.tr.step(new W(d-(a?3:1),p,d,p,f,1,!0)).scrollIntoView())}return!0}}class We{constructor(e,n,r={}){this.match=e,this.match=e,this.handler=typeof n=="string"?gp(n):n,this.undoable=r.undoable!==!1,this.inCode=r.inCode||!1,this.inCodeMark=r.inCodeMark!==!1}}function gp(t){return function(e,n,r,u){let i=t;if(n[1]){let o=n[0].lastIndexOf(n[1]);i+=n[0].slice(o+n[1].length),r+=o;let s=r-u;s>0&&(i=n[0].slice(o-s,o)+i,r=u)}return e.tr.insertText(i,r,u)}}const bp=500;function xp({rules:t}){let e=new ut({state:{init(){return null},apply(n,r){let u=n.getMeta(this);return u||(n.selectionSet||n.docChanged?null:r)}},props:{handleTextInput(n,r,u,i){return no(n,r,u,i,t,e)},handleDOMEvents:{compositionend:n=>{setTimeout(()=>{let{$cursor:r}=n.state.selection;r&&no(n,r.pos,r.pos,"",t,e)})}}},isInputRules:!0});return e}function no(t,e,n,r,u,i){if(t.composing)return!1;let o=t.state,s=o.doc.resolve(e),l=s.parent.textBetween(Math.max(0,s.parentOffset-bp),s.parentOffset,null,"")+r;for(let a=0;a<u.length;a++){let c=u[a];if(!c.inCodeMark&&s.marks().some(p=>p.type.spec.code))continue;if(s.parent.type.spec.code){if(!c.inCode)continue}else if(c.inCode==="only")continue;let f=c.match.exec(l),d=f&&f[0].length>=r.length&&c.handler(o,f,e-(f[0].length-r.length),n);if(d)return c.undoable&&d.setMeta(i,{transform:d,from:e,to:n,text:r}),t.dispatch(d),!0}return!1}const yp=(t,e)=>{let n=t.plugins;for(let r=0;r<n.length;r++){let u=n[r],i;if(u.spec.isInputRules&&(i=u.getState(t))){if(e){let o=t.tr,s=i.transform;for(let l=s.steps.length-1;l>=0;l--)o.step(s.steps[l].invert(s.docs[l]));if(i.text){let l=o.doc.resolve(i.from).marks();o.replaceWith(i.from,i.to,t.schema.text(i.text,l))}else o.delete(i.from,i.to);e(o)}return!0}}return!1},kp=new We(/--$/,"",{inCodeMark:!1}),Cp=new We(/\.\.\.$/,"",{inCodeMark:!1}),Dp=new We(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,"",{inCodeMark:!1}),wp=new We(/"$/,"",{inCodeMark:!1}),Ep=new We(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,"",{inCodeMark:!1}),_p=new We(/'$/,"",{inCodeMark:!1}),Sp=[Dp,wp,Ep,_p];function wu(t,e,n=null,r){return new We(t,(u,i,o,s)=>{let l=n instanceof Function?n(i):n,a=u.tr.delete(o,s),c=a.doc.resolve(o),f=c.blockRange(),d=f&&tu(f,e,l);if(!d)return null;a.wrap(f,d);let p=a.doc.resolve(o-1).nodeBefore;return p&&p.type==e&&Et(a.doc,o-1)&&(!r||r(i,p))&&a.join(o-1),a})}function gl(t,e,n=null){return new We(t,(r,u,i,o)=>{let s=r.doc.resolve(i),l=n instanceof Function?n(u):n;return s.node(-1).canReplaceWith(s.index(-1),s.indexAfter(-1),e)?r.tr.delete(i,o).setBlockType(i,i,e,l):null})}const mn="ProseMirror-prompt";function bl(t){let e=document.body.appendChild(document.createElement("div"));e.className=mn;let n=d=>{e.contains(d.target)||r()};setTimeout(()=>window.addEventListener("mousedown",n),50);let r=()=>{window.removeEventListener("mousedown",n),e.parentNode&&e.parentNode.removeChild(e)},u=[];for(let d in t.fields)u.push(t.fields[d].render());let i=document.createElement("button");i.type="submit",i.className=mn+"-submit",i.textContent="OK";let o=document.createElement("button");o.type="button",o.className=mn+"-cancel",o.textContent="Cancel",o.addEventListener("click",r);let s=e.appendChild(document.createElement("form"));t.title&&(s.appendChild(document.createElement("h5")).textContent=t.title),u.forEach(d=>{s.appendChild(document.createElement("div")).appendChild(d)});let l=s.appendChild(document.createElement("div"));l.className=mn+"-buttons",l.appendChild(i),l.appendChild(document.createTextNode(" ")),l.appendChild(o);let a=e.getBoundingClientRect();e.style.top=(window.innerHeight-a.height)/2+"px",e.style.left=(window.innerWidth-a.width)/2+"px";let c=()=>{let d=Ap(t.fields,u);d&&(r(),t.callback(d))};s.addEventListener("submit",d=>{d.preventDefault(),c()}),s.addEventListener("keydown",d=>{d.keyCode==27?(d.preventDefault(),r()):d.keyCode==13&&!(d.ctrlKey||d.metaKey||d.shiftKey)?(d.preventDefault(),c()):d.keyCode==9&&window.setTimeout(()=>{e.contains(document.activeElement)||r()},500)});let f=s.elements[0];f&&f.focus()}function Ap(t,e){let n=Object.create(null),r=0;for(let u in t){let i=t[u],o=e[r++],s=i.read(o),l=i.validate(s);if(l)return Mp(o,l),null;n[u]=i.clean(s)}return n}function Mp(t,e){let n=t.parentNode,r=n.appendChild(document.createElement("div"));r.style.left=t.offsetLeft+t.offsetWidth+2+"px",r.style.top=t.offsetTop-5+"px",r.className="ProseMirror-invalid",r.textContent=e,setTimeout(()=>n.removeChild(r),1500)}let Tp=class{constructor(e){this.options=e}read(e){return e.value}validateType(e){return null}validate(e){return!e&&this.options.required?"Required field":this.validateType(e)||(this.options.validate?this.options.validate(e):null)}clean(e){return this.options.clean?this.options.clean(e):e}},Lt=class extends Tp{render(){let e=document.createElement("input");return e.type="text",e.placeholder=this.options.label,e.value=this.options.value||"",e.autocomplete="off",e}};function xl(t,e){let n=t.selection.$from;for(let r=n.depth;r>=0;r--){let u=n.index(r);if(n.node(r).canReplaceWith(u,u,e))return!0}return!1}function Op(t){return new Y({title:"Insert image",label:"Image",enable(e){return xl(e,t)},run(e,n,r){let{from:u,to:i}=e.selection,o=null;e.selection instanceof w&&e.selection.node.type==t&&(o=e.selection.node.attrs),bl({title:"Insert image",fields:{src:new Lt({label:"Location",required:!0,value:o&&o.src}),title:new Lt({label:"Title",value:o&&o.title}),alt:new Lt({label:"Description",value:o?o.alt:e.doc.textBetween(u,i," ")})},callback(s){r.dispatch(r.state.tr.replaceSelectionWith(t.createAndFill(s))),r.focus()}})}})}function yl(t,e){let n={label:e.title,run:t};for(let r in e)n[r]=e[r];return!e.enable&&!e.select&&(n[e.enable?"enable":"select"]=r=>t(r)),new Y(n)}function Qr(t,e){let{from:n,$from:r,to:u,empty:i}=t.selection;return i?!!e.isInSet(t.storedMarks||r.marks()):t.doc.rangeHasMark(n,u,e)}function Er(t,e){let n={active(r){return Qr(r,t)}};for(let r in e)n[r]=e[r];return yl(de(t),n)}function Fp(t){return new Y({title:"Add or remove link",icon:z.link,active(e){return Qr(e,t)},enable(e){return!e.selection.empty},run(e,n,r){if(Qr(e,t))return de(t)(e,n),!0;bl({title:"Create a link",fields:{href:new Lt({label:"Link target",required:!0}),title:new Lt({label:"Title"})},callback(u){de(t,u)(r.state,r.dispatch),r.focus()}})}})}function ro(t,e){return yl(Pn(t,e.attrs),e)}function Np(t){let e={},n;(n=t.marks.strong)&&(e.toggleStrong=Er(n,{title:"Toggle strong style",icon:z.strong})),(n=t.marks.em)&&(e.toggleEm=Er(n,{title:"Toggle emphasis",icon:z.em})),(n=t.marks.code)&&(e.toggleCode=Er(n,{title:"Toggle code font",icon:z.code})),(n=t.marks.link)&&(e.toggleLink=Fp(n));let r;if((r=t.nodes.image)&&(e.insertImage=Op(r)),(r=t.nodes.bullet_list)&&(e.wrapBulletList=ro(r,{title:"Wrap in bullet list",icon:z.bulletList})),(r=t.nodes.ordered_list)&&(e.wrapOrderedList=ro(r,{title:"Wrap in ordered list",icon:z.orderedList})),(r=t.nodes.blockquote)&&(e.wrapBlockQuote=ml(r,{title:"Wrap in block quote",icon:z.blockquote})),(r=t.nodes.paragraph)&&(e.makeParagraph=gt(r,{title:"Change to paragraph",label:"Plain"})),(r=t.nodes.code_block)&&(e.makeCodeBlock=gt(r,{title:"Change to code block",label:"Code"})),r=t.nodes.heading)for(let i=1;i<=10;i++)e["makeHead"+i]=gt(r,{title:"Change to heading "+i,label:"Level "+i,attrs:{level:i}});if(r=t.nodes.horizontal_rule){let i=r;e.insertHorizontalRule=new Y({title:"Insert horizontal rule",label:"Horizontal rule",enable(o){return xl(o,i)},run(o,s){s(o.tr.replaceSelectionWith(i.create()))}})}let u=i=>i.filter(o=>o);return e.insertMenu=new zn(u([e.insertImage,e.insertHorizontalRule]),{label:"Insert"}),e.typeMenu=new zn(u([e.makeParagraph,e.makeCodeBlock,e.makeHead1&&new al(u([e.makeHead1,e.makeHead2,e.makeHead3,e.makeHead4,e.makeHead5,e.makeHead6]),{label:"Heading"})]),{label:"Type..."}),e.inlineMenu=[u([e.toggleStrong,e.toggleEm,e.toggleCode,e.toggleLink])],e.blockMenu=[u([e.wrapBulletList,e.wrapOrderedList,e.wrapBlockQuote,cl,fl,dl])],e.fullMenu=e.inlineMenu.concat([[e.insertMenu,e.typeMenu]],[[hl,pl]],e.blockMenu),e}const uo=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;function vp(t,e){let n={},r;function u(i,o){if(e){let s=e[i];if(s===!1)return;s&&(i=s)}n[i]=o}if(u("Mod-z",Bn),u("Shift-Mod-z",Yt),u("Backspace",yp),uo||u("Mod-y",Yt),u("Alt-ArrowUp",Jr),u("Alt-ArrowDown",Oh),u("Mod-BracketLeft",jr),u("Escape",Ur),(r=t.marks.strong)&&(u("Mod-b",de(r)),u("Mod-B",de(r))),(r=t.marks.em)&&(u("Mod-i",de(r)),u("Mod-I",de(r))),(r=t.marks.code)&&u("Mod-`",de(r)),(r=t.nodes.bullet_list)&&u("Shift-Ctrl-8",Pn(r)),(r=t.nodes.ordered_list)&&u("Shift-Ctrl-9",Pn(r)),(r=t.nodes.blockquote)&&u("Ctrl->",Kr(r)),r=t.nodes.hard_break){let i=r,o=Kn(el,(s,l)=>(l&&l(s.tr.replaceSelectionWith(i.create()).scrollIntoView()),!0));u("Mod-Enter",o),u("Shift-Enter",o),uo&&u("Ctrl-Enter",o)}if((r=t.nodes.list_item)&&(u("Enter",fp(r)),u("Mod-[",dp(r)),u("Mod-]",mp(r))),(r=t.nodes.paragraph)&&u("Shift-Ctrl-0",kn(r)),(r=t.nodes.code_block)&&u("Shift-Ctrl-\\",kn(r)),r=t.nodes.heading)for(let i=1;i<=6;i++)u("Shift-Ctrl-"+i,kn(r,{level:i}));if(r=t.nodes.horizontal_rule){let i=r;u("Mod-_",(o,s)=>(s&&s(o.tr.replaceSelectionWith(i.create()).scrollIntoView()),!0))}return n}function Ip(t){return wu(/^\s*>\s$/,t)}function Rp(t){return wu(/^(\d+)\.\s$/,t,e=>({order:+e[1]}),(e,n)=>n.childCount+n.attrs.order==+e[1])}function Bp(t){return wu(/^\s*([-+*])\s$/,t)}function zp(t){return gl(/^```$/,t)}function Pp(t,e){return gl(new RegExp("^(#{1,"+e+"})\\s$"),t,n=>({level:n[1].length}))}function Lp(t){let e=Sp.concat(Cp,kp),n;return(n=t.nodes.blockquote)&&e.push(Ip(n)),(n=t.nodes.ordered_list)&&e.push(Rp(n)),(n=t.nodes.bullet_list)&&e.push(Bp(n)),(n=t.nodes.code_block)&&e.push(zp(n)),(n=t.nodes.heading)&&e.push(Pp(n,6)),xp({rules:e})}function qp(t){let e=[Lp(t.schema),Qi(vp(t.schema,t.mapKeys)),Qi($h),Hh(),Uh()];return t.menuBar!==!1&&e.push(up({floating:t.floatingMenu!==!1,content:t.menuContent||Np(t.schema).fullMenu})),t.history!==!1&&e.push(wh()),e.concat(new ut({props:{attributes:{class:"ProseMirror-example-setup-style"}}}))}const gn="ProseMirror-prompt";function kl(t){let e=document.body.appendChild(document.createElement("div"));e.className=gn;let n=d=>{e.contains(d.target)||r()};setTimeout(()=>window.addEventListener("mousedown",n),50);let r=()=>{window.removeEventListener("mousedown",n),e.parentNode&&e.parentNode.removeChild(e)},u=[];for(let d in t.fields)u.push(t.fields[d].render());let i=document.createElement("button");i.type="submit",i.className=gn+"-submit",i.textContent="OK";let o=document.createElement("button");o.type="button",o.className=gn+"-cancel",o.textContent="Cancel",o.addEventListener("click",r);let s=e.appendChild(document.createElement("form"));s.className="flex flex-col gap-2",t.title&&(s.appendChild(document.createElement("h5")).textContent=t.title),u.forEach(d=>{s.appendChild(document.createElement("div")).appendChild(d)});let l=s.appendChild(document.createElement("div"));l.className=gn+"-buttons",l.appendChild(i),l.appendChild(document.createTextNode(" ")),l.appendChild(o);let a=e.getBoundingClientRect();e.style.top=(window.innerHeight-a.height)/2+"px",e.style.left=(window.innerWidth-a.width)/2+"px";let c=()=>{let d=Vp(t.fields,u);d&&(r(),t.callback(d))};s.addEventListener("submit",d=>{d.preventDefault(),c()}),s.addEventListener("keydown",d=>{d.keyCode==27?(d.preventDefault(),r()):d.keyCode==13&&!(d.ctrlKey||d.metaKey||d.shiftKey)?(d.preventDefault(),c()):d.keyCode==9&&window.setTimeout(()=>{e.contains(document.activeElement)||r()},500)});let f=s.elements[0];f&&f.focus()}function Vp(t,e){let n=Object.create(null),r=0;for(let u in t){let i=t[u],o=e[r++],s=i.read(o),l=i.validate(s);if(l)return $p(o,l),null;if(o.files){n[u]=o.files;continue}n[u]=i.clean(s)}return n}function $p(t,e){let n=t.parentNode,r=n.appendChild(document.createElement("div"));r.style.left=t.offsetLeft+t.offsetWidth+2+"px",r.style.top=t.offsetTop-5+"px",r.className="ProseMirror-invalid",r.textContent=e,setTimeout(()=>n.removeChild(r),1500)}class Eu{constructor(e){this.options=e}read(e){return e.value}validateType(e){return null}validate(e){return!e&&this.options.required?"Required field":this.validateType(e)||(this.options.validate?this.options.validate(e):null)}clean(e){return this.options.clean?this.options.clean(e):e}}class io extends Eu{render(){let e=document.createElement("input");return e.type="text",e.placeholder=this.options.label,e.value=this.options.value||"",e.autocomplete="off",e}}class Hp extends Eu{render(){let e=document.createElement("input");return e.type="file",e}}class Cl extends Eu{render(){let e=document.createElement("input");return e.type="submit",e.className="bg-gray border border-gray-200 text-black font-bold px-2 py-1",e}}function Dl(t,e){let n=t.selection.$from;for(let r=n.depth;r>=0;r--){let u=n.index(r);if(n.node(r).canReplaceWith(u,u,e))return!0}return!1}function Wp(t,e){return new Y({title:"Insert image",label:"Image",enable(n){return Dl(n,t)},run(n,r,u){let{from:i,to:o}=n.selection;n.selection instanceof w&&n.selection.node.type==t&&n.selection.node.attrs,kl({title:"Insert image",fields:{file:new Hp({label:"File",required:!0}),submit:new Cl({label:"Upload",required:!1})},callback(s){const l=new FormData;l.append("image",s.file[0]),fetch("/auth/admin/images/",{method:"POST",body:l}).then(async a=>{if(a.ok){let c=await a.json();console.log(c),u.dispatch(u.state.tr.replaceSelectionWith(e.node("image",{src:`https://morpho-images.s3.us-east-1.amazonaws.com/${c.imgurl}`})))}else console.log(await a.json())})}})}})}function wl(t,e){let n={label:e.title,run:t};for(let r in e)n[r]=e[r];return!e.enable&&!e.select&&(n[e.enable?"enable":"select"]=r=>t(r)),new Y(n)}function Yr(t,e){let{from:n,$from:r,to:u,empty:i}=t.selection;return i?!!e.isInSet(t.storedMarks||r.marks()):t.doc.rangeHasMark(n,u,e)}function _r(t,e){let n={active(r){return Yr(r,t)}};for(let r in e)n[r]=e[r];return wl(de(t),n)}function Jp(t){return new Y({title:"Add or remove link",icon:z.link,active(e){return Yr(e,t)},enable(e){return!e.selection.empty},run(e,n,r){if(Yr(e,t))return de(t)(e,n),!0;kl({title:"Create a link",fields:{href:new io({label:"Link target",required:!0}),title:new io({label:"Title"}),submit:new Cl({label:"Submit"})},callback(u){de(t,u)(r.state,r.dispatch),r.focus()}})}})}function oo(t,e){return wl(Pn(t,e.attrs),e)}function jp(t){let e={},n;(n=t.marks.strong)&&(e.toggleStrong=_r(n,{title:"Toggle strong style",icon:z.strong})),(n=t.marks.em)&&(e.toggleEm=_r(n,{title:"Toggle emphasis",icon:z.em})),(n=t.marks.code)&&(e.toggleCode=_r(n,{title:"Toggle code font",icon:z.code})),(n=t.marks.link)&&(e.toggleLink=Jp(n));let r;if((r=t.nodes.image)&&(e.insertImage=Wp(r,t)),(r=t.nodes.bullet_list)&&(e.wrapBulletList=oo(r,{title:"Wrap in bullet list",icon:z.bulletList})),(r=t.nodes.ordered_list)&&(e.wrapOrderedList=oo(r,{title:"Wrap in ordered list",icon:z.orderedList})),(r=t.nodes.blockquote)&&(e.wrapBlockQuote=ml(r,{title:"Wrap in block quote",icon:z.blockquote})),(r=t.nodes.paragraph)&&(e.makeParagraph=gt(r,{title:"Change to paragraph",label:"Plain"})),(r=t.nodes.code_block)&&(e.makeCodeBlock=gt(r,{title:"Change to code block",label:"Code"})),r=t.nodes.heading)for(let i=1;i<=10;i++)e["makeHead"+i]=gt(r,{title:"Change to heading "+i,label:"Level "+i,attrs:{level:i}});if(r=t.nodes.horizontal_rule){let i=r;e.insertHorizontalRule=new Y({title:"Insert horizontal rule",label:"Horizontal rule",enable(o){return Dl(o,i)},run(o,s){s(o.tr.replaceSelectionWith(i.create()))}})}let u=i=>i.filter(o=>o);return e.insertMenu=new zn(u([e.insertImage,e.insertHorizontalRule]),{label:"Insert"}),e.typeMenu=new zn(u([e.makeParagraph,e.makeCodeBlock,e.makeHead1&&new al(u([e.makeHead1,e.makeHead2,e.makeHead3,e.makeHead4,e.makeHead5,e.makeHead6]),{label:"Heading"})]),{label:"Type..."}),e.inlineMenu=[u([e.toggleStrong,e.toggleEm,e.toggleCode,e.toggleLink])],e.blockMenu=[u([e.wrapBulletList,e.wrapOrderedList,e.wrapBlockQuote,cl,fl,dl])],e.fullMenu=e.inlineMenu.concat([[e.insertMenu,e.typeMenu]],[[hl,pl]],e.blockMenu),e}function Up(t){let e,n,r;return{c(){e=Ou("div"),n=vl(),r=Ou("div"),this.h()},l(u){e=Mu(u,"DIV",{class:!0}),Tu(e).forEach(At),n=Nl(u),r=Mu(u,"DIV",{class:!0}),Tu(r).forEach(At),this.h()},h(){Au(e,"class","hidden"),Au(r,"class","w-full bg-white min-h-content p-2 m-1")},m(u,i){Zn(u,e,i),t[3](e),Zn(u,n,i),Zn(u,r,i),t[4](r)},p:Gn,i:Gn,o:Gn,d(u){u&&(At(e),At(n),At(r)),t[3](null),t[4](null)}}}function Kp(t,e,n){let{text:r}=e,u,i;class o{constructor(f,d){Su(this,"view");this.view=new Ds(f,{...d})}get content(){return ih.serialize(this.view.state.doc)}focus(){this.view.focus()}destroy(){this.view.destroy()}}let s;Il(()=>{s=new o(i,{state:ft.create({doc:nh.parse(r),plugins:[...qp({schema:Wr,menuContent:[...jp(Wr).fullMenu,[]]})]}),dispatchTransaction:c=>{const f=s.view.state.apply(c);s.view.updateState(f),n(2,r=s.content)}}),s.view.dom.className="editable-content",s.view.dom.spellcheck=!1});function l(c){Fu[c?"unshift":"push"](()=>{u=c,n(0,u)})}function a(c){Fu[c?"unshift":"push"](()=>{i=c,n(1,i)})}return t.$$set=c=>{"text"in c&&n(2,r=c.text)},[u,i,r,l,a]}class e1 extends Tl{constructor(e){super(),Ol(this,e,Kp,Up,Fl,{text:2})}}export{e1 as P};
